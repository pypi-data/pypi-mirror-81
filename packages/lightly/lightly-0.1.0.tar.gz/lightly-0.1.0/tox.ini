[tox]
# we install the package manually later
skipsdist=True

[testenv:cuda]
# test the full package on the gpu

# suppress warnings              
whitelist_externals = make
                      pip

setenv = LIGHTLY_SERVER_LOCATION = https://api-dev.whattolabel.com 

deps = pytest
       pytest-xdist
       responses

commands = 
           pip install torch==1.5.1+cu101 torchvision==0.6.1+cu101 -f https://download.pytorch.org/whl/torch_stable.html
           pip install .
           make test
           # TODO: add tests for cli/upload/etc so we only have to run tests
           # temporary fix (run lightly-magic and see if it works):
           lightly-magic input_dir='/home/pwirth/checklist_datasets/monkeys/monkeys_dataset' trainer.max_epochs=1 loader.batch_size=100 trainer.gpus=1

[testenv:cpu]
# test the full package on the gpu

# suppress warnings              
whitelist_externals = make
                      pip

setenv = LIGHTLY_SERVER_LOCATION = https://api-dev.whattolabel.com 
         CUDA_VISIBLE_DEVICES = -1

deps = pytest
       pytest-xdist
       responses

commands = 
           pip install torch==1.5.1+cu101 torchvision==0.6.1+cu101 -f https://download.pytorch.org/whl/torch_stable.html
           pip install .
           make test
           # TODO: add tests for cli/upload/etc so we only have to run tests
           # temporary fix (run lightly-magic and see if it works):
           lightly-magic input_dir='/home/pwirth/checklist_datasets/monkeys/monkeys_dataset' trainer.max_epochs=1 loader.batch_size=100 trainer.gpus=1


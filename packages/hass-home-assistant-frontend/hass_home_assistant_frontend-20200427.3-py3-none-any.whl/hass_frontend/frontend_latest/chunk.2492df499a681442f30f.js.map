{"version":3,"sources":["webpack:///./src/common/search/search-input.ts","webpack:///./src/panels/lovelace/common/compute-unused-entities.ts","webpack:///./src/panels/lovelace/editor/card-editor/hui-card-picker.ts","webpack:///./src/panels/lovelace/editor/get-card-stub-config.ts"],"names":["customElement","_LitElement","[object Object]","args","super","_initialize","this","property","type","Boolean","attribute","shadowRoot","querySelector","focus","html","classMap","no-underline","noUnderline","autofocus","filter","_filterInputChanged","noLabelFloat","_clearSearch","async","value","fireEvent","String","e","_filterChanged","target","css","LitElement","__webpack_require__","d","__webpack_exports__","computeUsedEntities","calcUnusedEntities","computeUnusedEntities","EXCLUDED_DOMAINS","addFromAction","entities","actionConfig","action","service_data","entity_id","entityIds","Array","isArray","entityId","add","addEntityId","entity","camera_image","tap_action","hold_action","addEntities","obj","forEach","card","cards","elements","badges","badge","config","Set","views","view","hass","usedEntities","unusedEntities","Object","keys","states","has","includes","split","previewCards","nonPreviewCards","_decorate","F","kind","decorators","key","memoizeOne","cardElements","map","cardElement","fuse","Fuse","caseSensitive","minMatchCharLength","threshold","search","lovelace","_unusedEntities","_usedEntities","_filter","_handleSearchChange","_filterCards","_cards","element","_cardPicked","localize","changedProps","oldHass","get","language","eid","UNAVAILABLE_STATES","state","_loadCards","name","description","concat","noElement","customCards","length","ccard","isCustom","until","_renderCardElement","ev","detail","requestUpdate","static","currentTarget","cardConfig","createCardElement","addEventListener","stopPropagation","parentElement","replaceChild","_createCardElement","once","customCard","getCustomCardEntry","undefined","CUSTOM_TYPE_PREFIX","entitiesFallback","elClass","getCardElementClass","getStubConfig","classStubConfig","assign","getCardStubConfig","preview","tagName"],"mappings":"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","file":"chunk.2492df499a681442f30f.js","sourcesContent":["import \"@polymer/paper-icon-button/paper-icon-button\";\nimport \"@polymer/paper-input/paper-input\";\nimport {\n  css,\n  CSSResult,\n  customElement,\n  LitElement,\n  property,\n} from \"lit-element\";\nimport { html, TemplateResult } from \"lit-html\";\nimport { classMap } from \"lit-html/directives/class-map\";\nimport \"../../components/ha-icon\";\nimport { fireEvent } from \"../dom/fire_event\";\n\n@customElement(\"search-input\")\nclass SearchInput extends LitElement {\n  @property() public filter?: string;\n\n  @property({ type: Boolean, attribute: \"no-label-float\" })\n  public noLabelFloat? = false;\n\n  @property({ type: Boolean, attribute: \"no-underline\" })\n  public noUnderline = false;\n\n  @property({ type: Boolean })\n  public autofocus = false;\n\n  public focus() {\n    this.shadowRoot!.querySelector(\"paper-input\")!.focus();\n  }\n\n  protected render(): TemplateResult {\n    return html`\n      <style>\n        .no-underline:not(.focused) {\n          --paper-input-container-underline: {\n            display: none;\n            height: 0;\n          }\n        }\n      </style>\n      <paper-input\n        class=${classMap({ \"no-underline\": this.noUnderline })}\n        .autofocus=${this.autofocus}\n        label=\"Search\"\n        .value=${this.filter}\n        @value-changed=${this._filterInputChanged}\n        .noLabelFloat=${this.noLabelFloat}\n      >\n        <ha-icon icon=\"hass:magnify\" slot=\"prefix\" class=\"prefix\"></ha-icon>\n        ${this.filter &&\n        html`\n          <paper-icon-button\n            slot=\"suffix\"\n            class=\"suffix\"\n            @click=${this._clearSearch}\n            icon=\"hass:close\"\n            alt=\"Clear\"\n            title=\"Clear\"\n          ></paper-icon-button>\n        `}\n      </paper-input>\n    `;\n  }\n\n  private async _filterChanged(value: string) {\n    fireEvent(this, \"value-changed\", { value: String(value) });\n  }\n\n  private async _filterInputChanged(e) {\n    this._filterChanged(e.target.value);\n  }\n\n  private async _clearSearch() {\n    this._filterChanged(\"\");\n  }\n\n  static get styles(): CSSResult {\n    return css`\n      ha-icon {\n        margin: 8px;\n      }\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"search-input\": SearchInput;\n  }\n}\n","import { ActionConfig, LovelaceConfig } from \"../../../data/lovelace\";\nimport { HomeAssistant } from \"../../../types\";\n\nexport const EXCLUDED_DOMAINS = [\"zone\", \"persistent_notification\"];\n\nconst addFromAction = (entities: Set<string>, actionConfig: ActionConfig) => {\n  if (\n    actionConfig.action !== \"call-service\" ||\n    !actionConfig.service_data ||\n    !actionConfig.service_data.entity_id\n  ) {\n    return;\n  }\n  let entityIds = actionConfig.service_data.entity_id;\n  if (!Array.isArray(entityIds)) {\n    entityIds = [entityIds];\n  }\n  for (const entityId of entityIds) {\n    entities.add(entityId);\n  }\n};\n\nconst addEntityId = (entities: Set<string>, entity) => {\n  if (typeof entity === \"string\") {\n    entities.add(entity);\n    return;\n  }\n\n  if (entity.entity) {\n    entities.add(entity.entity);\n  }\n  if (entity.camera_image) {\n    entities.add(entity.camera_image);\n  }\n  if (entity.tap_action) {\n    addFromAction(entities, entity.tap_action);\n  }\n  if (entity.hold_action) {\n    addFromAction(entities, entity.hold_action);\n  }\n};\n\nconst addEntities = (entities: Set<string>, obj) => {\n  if (obj.entity) {\n    addEntityId(entities, obj.entity);\n  }\n  if (obj.entities && Array.isArray(obj.entities)) {\n    obj.entities.forEach((entity) => addEntityId(entities, entity));\n  }\n  if (obj.card) {\n    addEntities(entities, obj.card);\n  }\n  if (obj.cards && Array.isArray(obj.cards)) {\n    obj.cards.forEach((card) => addEntities(entities, card));\n  }\n  if (obj.elements && Array.isArray(obj.elements)) {\n    obj.elements.forEach((card) => addEntities(entities, card));\n  }\n  if (obj.badges && Array.isArray(obj.badges)) {\n    obj.badges.forEach((badge) => addEntityId(entities, badge));\n  }\n};\n\nexport const computeUsedEntities = (config: LovelaceConfig): Set<string> => {\n  const entities = new Set<string>();\n  config.views.forEach((view) => addEntities(entities, view));\n  return entities;\n};\n\nexport const calcUnusedEntities = (\n  hass: HomeAssistant,\n  usedEntities: Set<string>\n): Set<string> => {\n  const unusedEntities: Set<string> = new Set();\n\n  for (const entity of Object.keys(hass.states)) {\n    if (\n      !usedEntities.has(entity) &&\n      !EXCLUDED_DOMAINS.includes(entity.split(\".\", 1)[0])\n    ) {\n      unusedEntities.add(entity);\n    }\n  }\n\n  return unusedEntities;\n};\n\nexport const computeUnusedEntities = (\n  hass: HomeAssistant,\n  config: LovelaceConfig\n): Set<string> => {\n  const usedEntities = computeUsedEntities(config);\n  const unusedEntities = calcUnusedEntities(hass, usedEntities);\n  return unusedEntities;\n};\n","import * as Fuse from \"fuse.js\";\nimport {\n  css,\n  CSSResult,\n  customElement,\n  html,\n  LitElement,\n  property,\n  PropertyValues,\n  TemplateResult,\n} from \"lit-element\";\nimport { classMap } from \"lit-html/directives/class-map\";\nimport { until } from \"lit-html/directives/until\";\nimport memoizeOne from \"memoize-one\";\nimport { fireEvent } from \"../../../../common/dom/fire_event\";\nimport \"../../../../common/search/search-input\";\nimport { UNAVAILABLE_STATES } from \"../../../../data/entity\";\nimport { LovelaceCardConfig, LovelaceConfig } from \"../../../../data/lovelace\";\nimport {\n  CustomCardEntry,\n  customCards,\n  CUSTOM_TYPE_PREFIX,\n  getCustomCardEntry,\n} from \"../../../../data/lovelace_custom_cards\";\nimport { HomeAssistant } from \"../../../../types\";\nimport {\n  calcUnusedEntities,\n  computeUsedEntities,\n} from \"../../common/compute-unused-entities\";\nimport { createCardElement } from \"../../create-element/create-card-element\";\nimport { LovelaceCard } from \"../../types\";\nimport { getCardStubConfig } from \"../get-card-stub-config\";\nimport { CardPickTarget } from \"../types\";\n\ninterface Card {\n  type: string;\n  name?: string;\n  description?: string;\n  noElement?: boolean;\n  isCustom?: boolean;\n}\n\ninterface CardElement {\n  card: Card;\n  element: TemplateResult;\n}\n\nconst previewCards: string[] = [\n  \"alarm-panel\",\n  \"button\",\n  \"entities\",\n  \"entity\",\n  \"gauge\",\n  \"glance\",\n  \"history-graph\",\n  \"light\",\n  \"map\",\n  \"markdown\",\n  \"media-control\",\n  \"picture\",\n  \"picture-elements\",\n  \"picture-entity\",\n  \"picture-glance\",\n  \"plant-status\",\n  \"sensor\",\n  \"thermostat\",\n  \"weather-forecast\",\n];\n\nconst nonPreviewCards: string[] = [\n  \"conditional\",\n  \"entity-filter\",\n  \"horizontal-stack\",\n  \"iframe\",\n  \"vertical-stack\",\n  \"shopping-list\",\n];\n\n@customElement(\"hui-card-picker\")\nexport class HuiCardPicker extends LitElement {\n  @property() public hass?: HomeAssistant;\n\n  @property() private _cards: CardElement[] = [];\n\n  public lovelace?: LovelaceConfig;\n\n  public cardPicked?: (cardConf: LovelaceCardConfig) => void;\n\n  private _filter?: string;\n\n  private _unusedEntities?: string[];\n\n  private _usedEntities?: string[];\n\n  private _filterCards = memoizeOne(\n    (cardElements: CardElement[], filter?: string): CardElement[] => {\n      if (filter) {\n        let cards = cardElements.map(\n          (cardElement: CardElement) => cardElement.card\n        );\n        const options: Fuse.FuseOptions<Card> = {\n          keys: [\"type\", \"name\", \"description\"],\n          caseSensitive: false,\n          minMatchCharLength: 2,\n          threshold: 0.2,\n        };\n        const fuse = new Fuse(cards, options);\n        cards = fuse.search(filter);\n        cardElements = cardElements.filter((cardElement: CardElement) =>\n          cards.includes(cardElement.card)\n        );\n      }\n      return cardElements;\n    }\n  );\n\n  protected render(): TemplateResult {\n    if (\n      !this.hass ||\n      !this.lovelace ||\n      !this._unusedEntities ||\n      !this._usedEntities\n    ) {\n      return html``;\n    }\n\n    return html`\n      <search-input\n        .filter=${this._filter}\n        no-label-float\n        @value-changed=${this._handleSearchChange}\n      ></search-input>\n      <div class=\"cards-container\">\n        ${this._filterCards(this._cards, this._filter).map(\n          (cardElement: CardElement) => cardElement.element\n        )}\n      </div>\n      <div class=\"cards-container\">\n        <div\n          class=\"card\"\n          @click=\"${this._cardPicked}\"\n          .config=\"${{ type: \"\" }}\"\n        >\n          <div class=\"preview description\">\n            ${this.hass!.localize(\n              `ui.panel.lovelace.editor.card.generic.manual_description`\n            )}\n          </div>\n          <div class=\"card-header\">\n            ${this.hass!.localize(\n              `ui.panel.lovelace.editor.card.generic.manual`\n            )}\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  protected shouldUpdate(changedProps: PropertyValues): boolean {\n    const oldHass = changedProps.get(\"hass\") as HomeAssistant | undefined;\n    if (!oldHass) {\n      return true;\n    }\n\n    if (oldHass.language !== this.hass!.language) {\n      return true;\n    }\n\n    return false;\n  }\n\n  protected firstUpdated(): void {\n    if (!this.hass || !this.lovelace) {\n      return;\n    }\n\n    const usedEntities = computeUsedEntities(this.lovelace);\n    const unusedEntities = calcUnusedEntities(this.hass, usedEntities);\n\n    this._usedEntities = [...usedEntities].filter(\n      (eid) =>\n        this.hass!.states[eid] &&\n        !UNAVAILABLE_STATES.includes(this.hass!.states[eid].state)\n    );\n    this._unusedEntities = [...unusedEntities].filter(\n      (eid) =>\n        this.hass!.states[eid] &&\n        !UNAVAILABLE_STATES.includes(this.hass!.states[eid].state)\n    );\n\n    this._loadCards();\n  }\n\n  private _loadCards() {\n    let cards: Card[] = previewCards\n      .map((type: string) => ({\n        type,\n        name: this.hass!.localize(`ui.panel.lovelace.editor.card.${type}.name`),\n        description: this.hass!.localize(\n          `ui.panel.lovelace.editor.card.${type}.description`\n        ),\n      }))\n      .concat(\n        nonPreviewCards.map((type: string) => ({\n          type,\n          name: this.hass!.localize(\n            `ui.panel.lovelace.editor.card.${type}.name`\n          ),\n          description: this.hass!.localize(\n            `ui.panel.lovelace.editor.card.${type}.description`\n          ),\n          noElement: true,\n        }))\n      );\n    if (customCards.length > 0) {\n      cards = cards.concat(\n        customCards.map((ccard: CustomCardEntry) => ({\n          type: ccard.type,\n          name: ccard.name,\n          description: ccard.description,\n          noElement: true,\n          isCustom: true,\n        }))\n      );\n    }\n    this._cards = cards.map((card: Card) => ({\n      card: card,\n      element: html`${until(\n        this._renderCardElement(card),\n        html`\n          <div class=\"card spinner\">\n            <paper-spinner active alt=\"Loading\"></paper-spinner>\n          </div>\n        `\n      )}`,\n    }));\n  }\n\n  private _handleSearchChange(ev: CustomEvent) {\n    this._filter = ev.detail.value;\n    this.requestUpdate();\n  }\n\n  static get styles(): CSSResult[] {\n    return [\n      css`\n        .cards-container {\n          display: grid;\n          grid-gap: 8px 8px;\n          grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n          margin-top: 20px;\n        }\n\n        .card {\n          height: 100%;\n          max-width: 500px;\n          display: flex;\n          flex-direction: column;\n          border-radius: 4px;\n          border: 1px solid var(--divider-color);\n          background: var(--primary-background-color, #fafafa);\n          cursor: pointer;\n          box-sizing: border-box;\n          position: relative;\n        }\n\n        .card-header {\n          color: var(--ha-card-header-color, --primary-text-color);\n          font-family: var(--ha-card-header-font-family, inherit);\n          font-size: 16px;\n          letter-spacing: -0.012em;\n          line-height: 20px;\n          padding: 12px 16px;\n          display: block;\n          text-align: center;\n          background: var(\n            --ha-card-background,\n            var(--paper-card-background-color, white)\n          );\n          border-radius: 0 0 4px 4px;\n          border-top: 1px solid var(--divider-color);\n        }\n\n        .preview {\n          pointer-events: none;\n          margin: 20px;\n          flex-grow: 1;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n        }\n\n        .preview > :first-child {\n          zoom: 0.6;\n          display: block;\n          width: 100%;\n        }\n\n        .description {\n          text-align: center;\n        }\n\n        .spinner {\n          align-items: center;\n          justify-content: center;\n        }\n\n        .overlay {\n          position: absolute;\n          width: 100%;\n          height: 100%;\n          z-index: 1;\n        }\n      `,\n    ];\n  }\n\n  private _cardPicked(ev: Event): void {\n    const config: LovelaceCardConfig = (ev.currentTarget! as CardPickTarget)\n      .config;\n\n    fireEvent(this, \"config-changed\", { config });\n  }\n\n  private _createCardElement(cardConfig: LovelaceCardConfig) {\n    const element = createCardElement(cardConfig) as LovelaceCard;\n    element.hass = this.hass;\n    element.addEventListener(\n      \"ll-rebuild\",\n      (ev) => {\n        ev.stopPropagation();\n        element.parentElement!.replaceChild(\n          this._createCardElement(cardConfig),\n          element\n        );\n      },\n      { once: true }\n    );\n    return element;\n  }\n\n  private async _renderCardElement(card: Card): Promise<TemplateResult> {\n    let { type } = card;\n    const { noElement, isCustom, name, description } = card;\n    const customCard = isCustom ? getCustomCardEntry(type) : undefined;\n    if (isCustom) {\n      type = `${CUSTOM_TYPE_PREFIX}${type}`;\n    }\n\n    let element: LovelaceCard | undefined;\n    let cardConfig: LovelaceCardConfig = { type };\n\n    if (this.hass && this.lovelace) {\n      cardConfig = await getCardStubConfig(\n        this.hass,\n        type,\n        this._unusedEntities!,\n        this._usedEntities!\n      );\n\n      if (!noElement || customCard?.preview) {\n        element = this._createCardElement(cardConfig);\n      }\n    }\n\n    return html`\n      <div class=\"card\">\n        <div\n          class=\"overlay\"\n          @click=${this._cardPicked}\n          .config=${cardConfig}\n        ></div>\n        <div\n          class=\"preview ${classMap({\n            description: !element || element.tagName === \"HUI-ERROR-CARD\",\n          })}\"\n        >\n          ${element && element.tagName !== \"HUI-ERROR-CARD\"\n            ? element\n            : customCard\n            ? customCard.description ||\n              this.hass!.localize(\n                `ui.panel.lovelace.editor.cardpicker.no_description`\n              )\n            : description}\n        </div>\n        <div class=\"card-header\">\n          ${customCard\n            ? `${this.hass!.localize(\n                \"ui.panel.lovelace.editor.cardpicker.custom_card\"\n              )}: ${customCard.name || customCard.type}`\n            : name}\n        </div>\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"hui-card-picker\": HuiCardPicker;\n  }\n}\n","import { LovelaceCardConfig } from \"../../../data/lovelace\";\nimport { HomeAssistant } from \"../../../types\";\nimport { getCardElementClass } from \"../create-element/create-card-element\";\n\nexport const getCardStubConfig = async (\n  hass: HomeAssistant,\n  type: string,\n  entities: string[],\n  entitiesFallback: string[]\n): Promise<LovelaceCardConfig> => {\n  let cardConfig: LovelaceCardConfig = { type };\n\n  const elClass = await getCardElementClass(type);\n\n  if (elClass && elClass.getStubConfig) {\n    const classStubConfig = elClass.getStubConfig(\n      hass,\n      entities,\n      entitiesFallback\n    );\n\n    cardConfig = { ...cardConfig, ...classStubConfig };\n  }\n\n  return cardConfig;\n};\n"],"sourceRoot":""}
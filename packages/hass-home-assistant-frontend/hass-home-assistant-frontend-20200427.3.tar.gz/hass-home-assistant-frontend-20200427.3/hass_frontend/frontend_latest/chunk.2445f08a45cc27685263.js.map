{"version":3,"sources":["webpack:///./src/common/datetime/seconds_to_duration.ts","webpack:///./src/common/entity/timer_time_remaining.ts","webpack:///./src/common/datetime/duration_to_seconds.ts","webpack:///./src/panels/lovelace/entity-rows/hui-timer-entity-row.ts"],"names":["__webpack_require__","d","__webpack_exports__","secondsToDuration","leftPad","num","h","Math","floor","m","s","timerTimeRemaining","stateObj","timeRemaining","duration","parts","split","map","Number","durationToSeconds","attributes","remaining","state","now","Date","getTime","madeActive","last_changed","max","customElement","HuiTimerEntityRow","_LitElement","[object Object]","args","super","_initialize","this","property","config","Error","_config","_get","_getPrototypeOf","prototype","call","_clearInterval","entity","hass","states","_startInterval","html","_computeDisplay","localize","changedProps","has","hasConfigOrEntityChanged","oldHass","get","undefined","_interval","window","clearInterval","_calculateRemaining","setInterval","_timeRemaining","display","LitElement"],"mappings":"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","file":"chunk.2445f08a45cc27685263.js","sourcesContent":["const leftPad = (num: number) => (num < 10 ? `0${num}` : num);\n\nexport default function secondsToDuration(d: number) {\n  const h = Math.floor(d / 3600);\n  const m = Math.floor((d % 3600) / 60);\n  const s = Math.floor((d % 3600) % 60);\n\n  if (h > 0) {\n    return `${h}:${leftPad(m)}:${leftPad(s)}`;\n  }\n  if (m > 0) {\n    return `${m}:${leftPad(s)}`;\n  }\n  if (s > 0) {\n    return \"\" + s;\n  }\n  return null;\n}\n","import { HassEntity } from \"home-assistant-js-websocket\";\nimport durationToSeconds from \"../datetime/duration_to_seconds\";\n\nexport const timerTimeRemaining = (stateObj: HassEntity) => {\n  let timeRemaining = durationToSeconds(stateObj.attributes.remaining);\n\n  if (stateObj.state === \"active\") {\n    const now = new Date().getTime();\n    const madeActive = new Date(stateObj.last_changed).getTime();\n    timeRemaining = Math.max(timeRemaining - (now - madeActive) / 1000, 0);\n  }\n\n  return timeRemaining;\n};\n","export default function durationToSeconds(duration: string): number {\n  const parts = duration.split(\":\").map(Number);\n  return parts[0] * 3600 + parts[1] * 60 + parts[2];\n}\n","import { HassEntity } from \"home-assistant-js-websocket\";\nimport {\n  customElement,\n  html,\n  LitElement,\n  property,\n  PropertyValues,\n  TemplateResult,\n} from \"lit-element\";\nimport secondsToDuration from \"../../../common/datetime/seconds_to_duration\";\nimport { timerTimeRemaining } from \"../../../common/entity/timer_time_remaining\";\nimport { HomeAssistant } from \"../../../types\";\nimport { hasConfigOrEntityChanged } from \"../common/has-changed\";\nimport \"../components/hui-generic-entity-row\";\nimport \"../components/hui-warning\";\nimport { EntityConfig } from \"./types\";\n\n@customElement(\"hui-timer-entity-row\")\nclass HuiTimerEntityRow extends LitElement {\n  @property() public hass?: HomeAssistant;\n\n  @property() private _config?: EntityConfig;\n\n  @property() private _timeRemaining?: number;\n\n  private _interval?: number;\n\n  public setConfig(config: EntityConfig): void {\n    if (!config) {\n      throw new Error(\"Configuration error\");\n    }\n    this._config = config;\n  }\n\n  public disconnectedCallback(): void {\n    super.disconnectedCallback();\n    this._clearInterval();\n  }\n\n  public connectedCallback(): void {\n    super.connectedCallback();\n    if (this._config && this._config.entity) {\n      const stateObj = this.hass!.states[this._config!.entity];\n      if (stateObj) {\n        this._startInterval(stateObj);\n      }\n    }\n  }\n\n  protected render(): TemplateResult {\n    if (!this._config || !this.hass) {\n      return html``;\n    }\n\n    const stateObj = this.hass.states[this._config.entity];\n\n    if (!stateObj) {\n      return html`\n        <hui-warning\n          >${this.hass.localize(\n            \"ui.panel.lovelace.warning.entity_not_found\",\n            \"entity\",\n            this._config.entity\n          )}</hui-warning\n        >\n      `;\n    }\n\n    return html`\n      <hui-generic-entity-row .hass=${this.hass} .config=${this._config}>\n        <div class=\"text-content\">${this._computeDisplay(stateObj)}</div>\n      </hui-generic-entity-row>\n    `;\n  }\n\n  protected shouldUpdate(changedProps: PropertyValues): boolean {\n    if (changedProps.has(\"_timeRemaining\")) {\n      return true;\n    }\n\n    return hasConfigOrEntityChanged(this, changedProps);\n  }\n\n  protected updated(changedProps: PropertyValues) {\n    super.updated(changedProps);\n\n    if (changedProps.has(\"hass\")) {\n      const stateObj = this.hass!.states[this._config!.entity];\n      const oldHass = changedProps.get(\"hass\") as this[\"hass\"];\n      const oldStateObj = oldHass\n        ? oldHass.states[this._config!.entity]\n        : undefined;\n\n      if (oldStateObj !== stateObj) {\n        this._startInterval(stateObj);\n      } else if (!stateObj) {\n        this._clearInterval();\n      }\n    }\n  }\n\n  private _clearInterval(): void {\n    if (this._interval) {\n      window.clearInterval(this._interval);\n      this._interval = undefined;\n    }\n  }\n\n  private _startInterval(stateObj: HassEntity): void {\n    this._clearInterval();\n    this._calculateRemaining(stateObj);\n\n    if (stateObj.state === \"active\") {\n      this._interval = window.setInterval(\n        () => this._calculateRemaining(stateObj),\n        1000\n      );\n    }\n  }\n\n  private _calculateRemaining(stateObj: HassEntity): void {\n    this._timeRemaining = timerTimeRemaining(stateObj);\n  }\n\n  private _computeDisplay(stateObj: HassEntity): string | null {\n    if (!stateObj) {\n      return null;\n    }\n\n    if (stateObj.state === \"idle\" || this._timeRemaining === 0) {\n      return this.hass!.localize(\"state.timer.\" + stateObj.state);\n    }\n\n    let display = secondsToDuration(this._timeRemaining || 0);\n\n    if (stateObj.state === \"paused\") {\n      display += ` (${this.hass!.localize(\"state.timer.paused\")})`;\n    }\n\n    return display;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"hui-timer-entity-row\": HuiTimerEntityRow;\n  }\n}\n"],"sourceRoot":""}
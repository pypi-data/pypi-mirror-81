define(["@jupyter-widgets/base"],(function(e){return function(e){var t={};function i(s){if(t[s])return t[s].exports;var l=t[s]={i:s,l:!1,exports:{}};return e[s].call(l.exports,l,l.exports,i),l.l=!0,l.exports}return i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)i.d(s,l,function(t){return e[t]}.bind(null,l));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=5)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(6);t.MODULE_VERSION=s.version},function(t,i){t.exports=e},function(e,t,i){"use strict";var s,l=function(){return void 0===s&&(s=Boolean(window&&document&&document.all&&!window.atob)),s},a=function(){var e={};return function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}e[t]=i}return e[t]}}(),r=[];function o(e){for(var t=-1,i=0;i<r.length;i++)if(r[i].identifier===e){t=i;break}return t}function n(e,t){for(var i={},s=[],l=0;l<e.length;l++){var a=e[l],n=t.base?a[0]+t.base:a[0],c=i[n]||0,h="".concat(n," ").concat(c);i[n]=c+1;var d=o(h),_={css:a[1],media:a[2],sourceMap:a[3]};-1!==d?(r[d].references++,r[d].updater(_)):r.push({identifier:h,updater:b(_,t),references:1}),s.push(h)}return s}function c(e){var t=document.createElement("style"),s=e.attributes||{};if(void 0===s.nonce){var l=i.nc;l&&(s.nonce=l)}if(Object.keys(s).forEach((function(e){t.setAttribute(e,s[e])})),"function"==typeof e.insert)e.insert(t);else{var r=a(e.insert||"head");if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(t)}return t}var h,d=(h=[],function(e,t){return h[e]=t,h.filter(Boolean).join("\n")});function _(e,t,i,s){var l=i?"":s.media?"@media ".concat(s.media," {").concat(s.css,"}"):s.css;if(e.styleSheet)e.styleSheet.cssText=d(t,l);else{var a=document.createTextNode(l),r=e.childNodes;r[t]&&e.removeChild(r[t]),r.length?e.insertBefore(a,r[t]):e.appendChild(a)}}function u(e,t,i){var s=i.css,l=i.media,a=i.sourceMap;if(l?e.setAttribute("media",l):e.removeAttribute("media"),a&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),e.styleSheet)e.styleSheet.cssText=s;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(s))}}var p=null,m=0;function b(e,t){var i,s,l;if(t.singleton){var a=m++;i=p||(p=c(t)),s=_.bind(null,i,a,!1),l=_.bind(null,i,a,!0)}else i=c(t),s=u.bind(null,i,t),l=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(i)};return s(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;s(e=t)}else l()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=l());var i=n(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var s=0;s<i.length;s++){var l=o(i[s]);r[l].references--}for(var a=n(e,t),c=0;c<i.length;c++){var h=o(i[c]);0===r[h].references&&(r[h].updater(),r.splice(h,1))}i=a}}}},function(e,t,i){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i=function(e,t){var i=e[1]||"",s=e[3];if(!s)return i;if(t&&"function"==typeof btoa){var l=(r=s,o=btoa(unescape(encodeURIComponent(JSON.stringify(r)))),n="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(o),"/*# ".concat(n," */")),a=s.sources.map((function(e){return"/*# sourceURL=".concat(s.sourceRoot||"").concat(e," */")}));return[i].concat(a).concat([l]).join("\n")}var r,o,n;return[i].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(i,"}"):i})).join("")},t.i=function(e,i,s){"string"==typeof e&&(e=[[null,e,""]]);var l={};if(s)for(var a=0;a<this.length;a++){var r=this[a][0];null!=r&&(l[r]=!0)}for(var o=0;o<e.length;o++){var n=[].concat(e[o]);s&&l[n[0]]||(i&&(n[2]?n[2]="".concat(i," and ").concat(n[2]):n[2]=i),t.push(n))}},t}},function(e,t,i){var s=i(2),l=i(13);"string"==typeof(l=l.__esModule?l.default:l)&&(l=[[e.i,l,""]]);var a={insert:"head",singleton:!1};s(l,a);e.exports=l.locals||{}},function(e,t,i){"use strict";function s(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),s(i(0)),s(i(7))},function(e){e.exports=JSON.parse('{"name":"ipyregulartable","version":"0.1.1","description":"A Custom Jupyter Widget Library","keywords":["jupyter","jupyterlab","jupyterlab-extension","widgets"],"files":["lib/**/*.js","dist/*.js","css/*.css"],"homepage":"https://github.com/timkpaine/ipyregulartable","bugs":{"url":"https://github.com/timkpaine/ipyregulartable/issues"},"license":"Apache-2.0","author":{"name":"Tim Paine","email":"t.paine154@gmail.com"},"main":"lib/index.js","types":"./lib/index.d.ts","repository":{"type":"git","url":"https://github.com/timkpaine/ipyregulartable"},"scripts":{"build":"npm run build:lib && npm run build:nbextension && npm run build:labextension","build:labextension":"npm run clean:labextension && mkdirp ../ipyregulartable/labextension && cd ../ipyregulartable/labextension && npm pack ../../js","build:lib":"tsc","build:nbextension":"webpack -p","build:all":"npm run build:labextension && npm run build:nbextension","clean":"npm run clean:lib && npm run clean:nbextension","clean:lib":"rimraf lib","clean:labextension":"rimraf ../ipyregulartable/labextension","clean:nbextension":"rimraf ../ipyregulartable/nbextension/static/index.js","fix":"eslint -c .eslintrc.js --ext .ts --fix src/ tests/","lint":"eslint -c .eslintrc.js --ext .ts src/ tests/","prepack":"npm run build:lib","test":"jest --coverage --collectCoverageFrom=src/*.{ts}","watch":"npm-run-all -p watch:*","watch:lib":"tsc -w","watch:nbextension":"webpack --watch"},"dependencies":{"@jupyter-widgets/base":"^3.0.0","regular-table":"^0.1.5"},"devDependencies":{"@babel/preset-env":"^7.8.6","@lumino/application":"^1.6.0","@lumino/widgets":"^1.6.0","@types/expect.js":"^0.3.29","@types/jest":"^26.0.14","@types/mocha":"^5.2.5","@types/webpack-env":"^1.13.6","@typescript-eslint/eslint-plugin":"^2.33.0","@typescript-eslint/eslint-plugin-tslint":"^2.33.0","@typescript-eslint/parser":"^2.33.0","acorn":"^6.4.1","babel-jest":"^26.5.0","css-loader":"^3.2.0","eslint":"^7.0.0","eslint-plugin-import":"^2.20.2","eslint-plugin-jsdoc":"^25.4.2","eslint-plugin-prefer-arrow":"^1.2.1","eslint-plugin-unicorn":"^20.0.0","expect.js":"^0.3.1","fs-extra":"^7.0.0","isomorphic-fetch":"^2.2.1","jest":"^26.5.0","jest-transform-css":"^2.0.0","karma":"^3.0.0","karma-chrome-launcher":"^2.2.0","karma-firefox-launcher":"^1.1.0","karma-ie-launcher":"^1.0.0","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.5","karma-typescript":"^3.0.13","mkdirp":"^0.5.1","mocha":"^5.2.0","npm-run-all":"^4.1.3","rimraf":"^2.6.2","source-map-loader":"^0.2.4","style-loader":"^1.0.0","ts-jest":"^26.4.1","ts-loader":"^5.2.1","tslint":"^6.0.0","typescript":"~3.8.0","webpack":"^4.20.2","webpack-cli":"^3.1.2"},"resolutions":{"acorn":"^6.4.1","kind-of":"^6.0.3","minimist":"^0.2.1"},"jupyterlab":{"extension":"lib/plugin"}}')},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i(8);t.RegularTableModel=s.RegularTableModel;var l=i(9);t.RegularTableView=l.RegularTableView,i(4)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(1),l=i(0);class a extends s.DOMWidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:a.modelName,_model_module:a.modelModule,_model_module_version:a.modelModuleVersion,_view_name:a.viewName,_view_module:a.viewModule,_view_module_version:a.viewModuleVersion,height:200,_data:{},_editable:!1})}}t.RegularTableModel=a,a.serializers=Object.assign({},s.DOMWidgetModel.serializers),a.modelName="RegularTableModel",a.modelModule="ipyregulartable",a.modelModuleVersion=l.MODULE_VERSION,a.viewName="RegularTableView",a.viewModule="ipyregulartable",a.viewModuleVersion=l.MODULE_VERSION},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(1);i(10),i(11),i(4);class l extends s.DOMWidgetView{constructor(){super(...arguments),this.resolve=void 0,this.reject=void 0,this.editable_resolve=void 0,this.editable_target=void 0,this.selected={x:0,y:0},this.rows=0,this.columns=0}render(){this.model.on("msg:custom",this._handle_msg,this),this.el.classList.add("ipyregulartable"),this.el.style.height=this.model.get("height")+"px",this.model.on("change:height",this._handle_height,this),this.displayed.then(()=>{this._render(),this.table.draw()})}_handle_data(){if(void 0!==this.resolve&&this.model.get("_data")){const e=this.model.get("_data");this.resolve(e),this.rows=e.num_rows,this.columns=e.num_columns,this.resolve=void 0,this.reject=void 0}else this.reject(),this.resolve=void 0,this.reject=void 0}_handle_editable(){if(void 0!==this.editable_resolve&&this.model.get("_editable")){this.editable_resolve(!0),this.editable_resolve=void 0;const e=this.editable_target;!0===this.model.get("_editable")&&(e.setAttribute("contenteditable","true"),e.addEventListener("focusout",()=>{const t=this.table.getMeta(e);"true"===e.getAttribute("contenteditable")&&this.send({event:"write",value:[t.x,t.y,e.textContent]}),e.setAttribute("contenteditable","false")}),e.addEventListener("keydown",t=>{if(13===t.keyCode&&!t.shiftKey){t.preventDefault(),t.stopPropagation();const i=this.table.getMeta(e);"true"===e.getAttribute("contenteditable")&&this.send({event:"write",value:[i.x,i.y,e.textContent]}),e.setAttribute("contenteditable","false")}})),this.editable_target=void 0}else this.editable_resolve(!1),this.editable_resolve=void 0,this.editable_target=void 0}_handle_height(){this.el.style.height=this.model.get("height")+"px",this._handle_draw()}_handle_msg(e){"draw"===e.type?this._handle_draw():"data"===e.type?this._handle_data():"editable"===e.type&&this._handle_editable()}_handle_draw(){this.table.draw()}_render(){this.table=document.createElement("regular-table"),this.el.appendChild(this.table),this.table.setDataListener((e,t,i,s)=>new Promise((l,a)=>{void 0!==this.resolve&&(this.reject(),this.resolve=void 0,this.reject=void 0),this.resolve=l,this.reject=a,this.send({event:"dataslice",value:[e,t,i,s]})})),this.table.addEventListener("click",e=>{const t=this.table.getMeta(e.target);this.selected.x=t.x,this.selected.y=t.y,this.updateFocus(),this.send({event:"click",value:[t.x,t.y]})}),this.table.addEventListener("dblclick",e=>{const t=this.table.getMeta(e.target);return e.preventDefault(),e.stopPropagation(),new Promise(i=>{void 0!==this.editable_resolve&&(this.editable_resolve(!1),this.editable_resolve=void 0,this.editable_target=void 0),this.editable_resolve=i,this.editable_target=e.target,this.send({event:"editable",value:[t.x,t.y]})})}),this.table.addEventListener("keydown",e=>{switch(e.keyCode){case 9:e.preventDefault(),e.shiftKey?this.moveSelection(-1,0):this.moveSelection(1,0);break;case 37:e.preventDefault(),this.moveSelection(-1,0);break;case 38:e.preventDefault(),this.moveSelection(0,-1);break;case 39:e.preventDefault(),this.moveSelection(1,0);break;case 40:e.preventDefault(),this.moveSelection(0,1)}}),this.table.addEventListener("keyup",e=>{this.updateFocus(),e.preventDefault()})}moveSelection(e,t){const i=this.findActive();if(!i)return;const s=this.table.getMeta(i);"true"===i.getAttribute("contenteditable")&&i.setAttribute("contenteditable","false");0!==e&&(s.x+e<this.columns&&0<=s.x+e&&(this.selected.x=s.x+e),s.x1<=this.selected.x+4?this.table.scrollToCell(s.x0+2,s.y0,this.columns,this.rows):this.selected.x-4<s.x0&&(0<s.x0-1?this.table.scrollToCell(s.x0-1,s.y0,this.columns,this.rows):this.table.scrollToCell(0,s.y0,this.columns,this.rows))),0!==t&&(s.y+t<this.rows&&0<=s.y+t&&(this.selected.y=s.y+t),s.y1<=this.selected.y+4?this.table.scrollToCell(s.x0,s.y0+1,this.columns,this.rows):this.selected.y-4+2<s.y0&&(0<s.y0-1?this.table.scrollToCell(s.x0,s.y0-1,this.columns,this.rows):this.table.scrollToCell(s.x0,0,this.columns,this.rows)))}findActive(){const e=this.table.querySelectorAll("td");for(const t of e){const e=this.table.getMeta(t);if(e.x===this.selected.x&&e.y===this.selected.y)return t}}updateFocus(){const e=this.table.querySelectorAll("td");for(const t of e){const e=this.table.getMeta(t);e.x===this.selected.x&&e.y===this.selected.y?(t.focus(),t.classList.add("highlight")):t.classList.remove("highlight")}}}t.RegularTableView=l},function(e,t){const i=new WeakMap,s=navigator.userAgent.toLowerCase().indexOf("firefox")>-1?5e6:1e7;function l(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function a(e,t,i,s,l){var a={};return Object.keys(s).forEach((function(e){a[e]=s[e]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=i.slice().reverse().reduce((function(i,s){return s(e,t,i)||i}),a),l&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(l):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}class r{constructor(e,t,i){this._column_sizes=e,this._container=t,this.table=i,this.cells=[],this.rows=[]}num_rows(){return this.cells.length}_set_metadata(e,t){i.set(e,t)}_get_or_create_metadata(e){if(void 0===e)return{};if(i.has(e))return i.get(e);{const t={};return i.set(e,t),t}}_replace_cell(e,t,i){const{tr:s,row_container:l}=this._get_row(t);let a=l[i];return a&&(s.removeChild(a),l.splice(i,1,void 0)),a}_fetch_cell(e,t){if(e<0||t<0)return;const{row_container:i}=this._get_row(e);return i[t]}_get_cell(e="TD",t,i){const{tr:s,row_container:l}=this._get_row(t);let a=l[i];if(a||(i<l.length?(a=l[i]=document.createElement(e),s.insertBefore(a,l.slice(i+1).find(e=>e))):(a=l[i]=document.createElement(e),s.appendChild(a))),a.tagName!==e){const l=document.createElement(e);s.replaceChild(l,a),this.cells[t].splice(i,1,l),a=l}return a}_get_row(e){let t=this.rows[e];t||(t=this.rows[e]=document.createElement("tr"),this.table.appendChild(t));let i=this.cells[e];return i||(i=this.cells[e]=[]),{tr:t,row_container:i}}_clean_columns(e){for(let t=0;t<this.rows.length;t++){const i=this.rows[t],s=this.cells[t];this.cells[t]=s.slice(0,e[t]||e);const l=this.cells[t].filter(e=>void 0!==e).length;for(;i.children[l];)i.removeChild(i.children[l])}}_clean_rows(e){for(;this.table.children[e];)this.table.removeChild(this.table.children[e]);this.rows=this.rows.slice(0,e),this.cells=this.cells.slice(0,e)}}let o=0,n=0,c=performance.now();const h=(e,...t)=>e.map((e,i)=>[e,t[i]]).flat().filter(e=>!!e).join("");function d(e,t,i){const s=Symbol("private lock"),l=i.value;return i.value=async function(...e){if(this[s]&&(await this[s],this[s]))return void await this[s];let t;this[s]=(()=>{let e;const t=new Promise(t=>{e=t});return t.resolve=e,t})();try{t=await l.call(this,...e)}catch(e){console.error(e)}finally{const e=this[s];return this[s]=void 0,e.resolve(),t}},i}class _ extends r{constructor(...e){super(...e),l(this,"_group_header_cache",[]),l(this,"_offset_cache",[])}_draw_group_th(e,t,i){const s=this._get_cell("TH",t,e[t]);return e[t]+=1,s.className="",s.removeAttribute("colspan"),s.style.minWidth="0",s.innerHTML=h` ${i} <span class="pd-column-resize"></span> `,s}_draw_group(e,t,i){const s=this._get_or_create_metadata(i);return s.column_header=e,s.value=t,s.value=t,i.className="",s}_draw_th(e,t,i,s,l){const a=this._get_or_create_metadata(i);if(a.column_header=e,a.value=t,a.size_key=l.length?l[0]:l,!(l.length>1)){const e=this._column_sizes.override[a.size_key],t=this._column_sizes.auto[a.size_key];e?(i.classList.toggle("pd-cell-clip",t>e),i.style.minWidth=e+"px",i.style.maxWidth=e+"px"):t?(i.classList.remove("pd-cell-clip"),i.style.maxWidth="",i.style.minWidth=t+"px"):(i.style.maxWidth="",i.style.maxWidth="")}return a}get_column_header(e){return this._get_cell("TH",this.rows.length-1,e)}draw(e,t,i,s,l,a,r){const o=null==t?void 0:t.length;if(0===o)return{};let n,c,h;for(let p=0;p<o;p++){if(h=t[p]?t[p]:"",this._offset_cache[p]=this._offset_cache[p]||0,p<o-1){var d,_,u;(null===(d=this._group_header_cache)||void 0===d||null===(_=d[p])||void 0===_||null===(u=_[0])||void 0===u?void 0:u.value)===h?(n=this._group_header_cache[p][1],this._group_header_cache[p][2]+=1,1===i&&(this._group_header_cache[p][0].row_header_x=l),n.setAttribute("colspan",this._group_header_cache[p][2])):(n=this._draw_group_th(this._offset_cache,p,h),c=this._draw_group(t,h,n),this._group_header_cache[p]=[c,n,1])}else{n=this._draw_group_th(this._offset_cache,p,h),c=this._draw_th(e||t,h,n,s,l);for(const[e]of this._group_header_cache)e.size_key=c.size_key;n.removeAttribute("colspan"),n.dataset.sizeKey=c.size_key}c&&(c.x=s,c.column_header_y=p,c.x0=a,c._virtual_x=r,1===i&&(c.row_header_x=l))}return this._clean_rows(this._offset_cache.length),{th:n,metadata:c}}clean(){this._clean_columns(this._offset_cache),this._offset_cache=[],this._group_header_cache=[]}}class u extends r{_draw_td(e,t,i,s,{column_name:l},{ridx_offset:a},r){const o=this._get_cell(e,t,s),n=this._get_or_create_metadata(o);n.y=t+a,n.size_key=r,"TD"===e&&(n.column_header=l);const c=this._column_sizes.override[n.size_key];if(c){const e=this._column_sizes.auto[n.size_key];o.classList.toggle("pd-cell-clip",e>c),o.style.minWidth=c+"px",o.style.maxWidth=c+"px"}else o.classList.remove("pd-cell-clip"),o.style.minWidth="",o.style.maxWidth="";return i instanceof HTMLElement?(o.textContent="",o.appendChild(i)):o.textContent=i,n.value=i,{td:o,metadata:n}}draw(e,t,i,s=!1,l,a,r,o){const{cidx:n,column_data:c,row_headers:h}=t;let d,{row_height:_}=i;const u=[],p=[];let m=0;const b=[];for(let v=0;v<(s?i.row_headers_length:1);v++){m=0;for(const f of c){var g;const c=null==h?void 0:h[m];let w;if(s){const e=f[v],s=this._fetch_cell(m-(u[v]||1),n+v),l=this._get_or_create_metadata(s),r=this._fetch_cell(m,n+v-(b[m]||1)),o=this._get_or_create_metadata(r);!r||o.value!==e&&void 0!==e||r.hasAttribute("rowspan")?s&&l.value===e&&!s.hasAttribute("colspan")?(u[v]=u[v]?u[v]+1:2,s.setAttribute("rowspan",u[v]),this._replace_cell(void 0,m,n+v)):(w=this._draw_td("TH",m,e,n+v,t,i,v),w.td.style.display="",w.td.removeAttribute("rowspan"),w.td.removeAttribute("colspan"),w.metadata.row_header=f,w.metadata.row_header_x=v,w.metadata.x0=a,w.metadata.y0=i.ridx_offset,w.metadata.y1=i.y1,w.metadata._virtual_x=v,u[v]=1,b[m]=1,p[v]=w):(b[m]=b[m]?b[m]+1:2,r.setAttribute("colspan",b[m]),this._replace_cell(void 0,m,n+v)),m++}else w=this._draw_td("TD",m++,f,n,t,i,r),w.metadata.x=l,w.metadata.x0=a,w.metadata.x1=i.x1,w.metadata.row_header=c||{test:2},w.metadata.y0=i.ridx_offset,w.metadata.y1=i.y1,w.metadata.dx=l-a,w.metadata.dy=w.metadata.y-w.metadata.y0,w.metadata._virtual_x=o,p[0]=w;if(d=w?w.metadata:d,_=_||(null===(g=w)||void 0===g?void 0:g.td.offsetHeight),m*_>e)break}}return this._clean_rows(m),{tds:p,ridx:m,metadata:d,row_height:_}}clean({ridx:e,cidx:t}){this._clean_rows(e),this._clean_columns(t)}}class p{constructor(e,t,i){this.clear(i);const[s]=i.children,[l,a]=s.children;this.table=s,this._column_sizes=t,this.header=new _(t,e,l),this.body=new u(t,e,a),this.fragment=document.createDocumentFragment()}num_columns(){var e;return this.header._get_row(Math.max(0,(null===(e=this.header.rows)||void 0===e?void 0:e.length)-1||0)).row_container.length}clear(e){e.innerHTML=h` <table cellspacing="0"> <thead></thead> <tbody></tbody> </table> `}autosize_cells(e){for(;e.length>0;){const[t,i]=e.pop();let s;const l=getComputedStyle(t);"border-box"!==l.boxSizing?(s=t.clientWidth,s-=parseFloat(l.paddingLeft),s-=parseFloat(l.paddingRight)):s=t.offsetWidth,this._column_sizes.row_height=this._column_sizes.row_height||t.offsetHeight,this._column_sizes.indices[i.size_key]=s;const a=this._column_sizes.override.hasOwnProperty(i.size_key);s&&!a&&(this._column_sizes.auto[i.size_key]=s),"0px"===t.style.minWidth&&(t.style.minWidth=s+"px")}}async draw(e,t,i,s,l,a){var r,o,n,c;const{width:h,height:d}=e,{view:_,config:u}=t;let{data:p,row_headers:m,column_headers:b}=await _(l.start_col,l.start_row,l.end_col,l.end_row);const{start_row:g=0,start_col:v=0,end_col:f=0,end_row:w=0}=l;m&&(this._row_headers_length=m.reduce((e,t)=>Math.max(e,t.length),0),m=m.map(e=>(e.length=this._row_headers_length,e))),t.config.column_pivots=Array.from(Array((null==b||null===(r=b[0])||void 0===r?void 0:r.length)-1||0).keys()),t.config.row_pivots=Array.from(Array((null===(o=m)||void 0===o||null===(n=o[0])||void 0===n?void 0:n.length)||0).keys());const y={viewport_width:0,selected_id:i,ridx_offset:g,x0:v,x1:f,y1:w,row_height:this._column_sizes.row_height,row_headers_length:this._row_headers_length};let x,k=0,z=[],M=!0;if((null===(c=m)||void 0===c?void 0:c.length)>0){const e=u.row_pivots.join(","),i={column_name:e,cidx:0,column_data:m,row_headers:m,first_col:M},l=k+v;x=this.body.draw(d,i,{...y,x0:0},!0,void 0,void 0,l,k);const a=[];for(let i=0;i<t.config.row_pivots.length;i++)a.push(this.header.draw(e,Array(t.config.column_pivots.length+1).fill(""),1,void 0,i,v,i));if(M=!1,y.viewport_width+=a.reduce((e,{th:t},i)=>e+(this._column_sizes.indices[i]||t.offsetWidth),0),y.row_height=y.row_height||x.row_height,k=m[0].length,!s)for(let e=0;e<t.config.row_pivots.length;e++){const{td:t,metadata:i}=x.tds[e]||{},{th:s,metadata:l}=a[e];z.push([s||t,l||i])}}try{let e=0;const t=a-l.start_col;for(;e<t;){if(!p[e]){let t=Math.max(l.end_col,0);l.start_col=t,l.end_col=t+1;const i=await _(l.start_col,l.start_row,l.end_col,l.end_row);var j;p[e]=i.data[0],b&&(b[e]=null===(j=i.column_headers)||void 0===j?void 0:j[0])}const t=(null==b?void 0:b[e])||"",i={column_name:t,cidx:k,column_data:p[e],row_headers:m,first_col:M},a=e+v,r=k+v,o=this.header.draw(void 0,t,void 0,a,r,v,k);if(x=this.body.draw(d,i,y,!1,a,v,r,k),M=!1,y.viewport_width+=this._column_sizes.indices[k+v]||x.tds.reduce((e,t)=>{var i;return e+(null===(i=t.td)||void 0===i?void 0:i.offsetWidth)},0)||o.th.offsetWidth,y.row_height=y.row_height||x.row_height,k++,e++,!s)for(const{td:e,metadata:t}of x.tds)z.push([o.th||e,o.metadata||t]);if(y.viewport_width>h)break}return z}finally{var L;this.body.clean({ridx:(null===(L=x)||void 0===L?void 0:L.ridx)||0,cidx:k}),this.header.clean()}}}var m;function b(){return Reflect.construct(HTMLElement,[],this.__proto__.constructor)}Object.setPrototypeOf(b.prototype,HTMLElement.prototype),Object.setPrototypeOf(b,HTMLElement);let g=(a((m=class extends b{create_shadow_dom(){this.attachShadow({mode:"open"});const e="<slot></slot>";this.shadowRoot.innerHTML=h` <style> ${":host{bottom:0;overflow:scroll}:host,div.pd-virtual-panel{position:absolute;top:0;left:0;right:0}div.pd-virtual-panel{pointer-events:none}div.pd-scroll-table-clip{position:sticky;top:0;left:0;width:100%;height:100%}div.pd-tree-container{display:flex;align-items:center;height:100%}slot{position:absolute;overflow:hidden}"} </style> <div class="pd-virtual-panel"> ${this._virtual_scrolling_disabled?e:""} </div> <div class="pd-scroll-table-clip"> ${this._virtual_scrolling_disabled?"":e} </div> `;const t=document.createElement("div");t.setAttribute("tabindex","0");const[,i,s]=this.shadowRoot.children;this._sticky_container=t,this._table_clip=s;const l=document.createElement("div");l.setAttribute("style","position:absolute;z-index:-1;opacity:0;pointer-event:none;"),this.appendChild(l),this._table_staging=l,this._virtual_panel=i}_calculate_viewport(e,t,i){const{start_row:s,end_row:l}=this._calculate_row_range(e,i),{start_col:a,end_col:r}=this._calculate_column_range(t);return this._nrows=e,{start_col:a,end_col:r,start_row:s,end_row:l}}_calculate_row_range(e,t){const{height:i}=this._container_size,s=this._column_sizes.row_height||19,l=this._view_cache.config.column_pivots.length+1,a=Math.max(1,this._virtual_panel.offsetHeight-this.clientHeight),r=this.scrollTop/a,o=i/s,n=t?e:this._nrows||0,c=Math.max(0,n+(l-o));let h=Math.ceil(c*r);return{start_row:h,end_row:Math.min(Math.ceil(h+o),e)}}_calculate_column_range(e){const t=Math.max(1,this._virtual_panel.offsetWidth-this._container_size.width),i=this.scrollLeft/t,s=this._max_scroll_column(e)+.5;let l=Math.floor(s*i);return{start_col:l,end_col:l+(this.table_model.num_columns()||Math.min(e,Math.ceil(this._container_size.width/60)))+1}}_max_scroll_column(e){let t=0;if(this._view_cache.config.row_pivots.length>0)for(const e of this._column_sizes.indices.slice(0,this._view_cache.config.row_pivots.length))t+=e;let i=e;for(;t<this._container_size.width&&i>=0;)i--,t+=this._column_sizes.indices[i]||60;return Math.min(e-1,i+1)}_validate_viewport({start_col:e,end_col:t,start_row:i,end_row:s}){const l=this._start_col!==e,a=this._start_row!==i||this._end_row!==s||this._end_col!==t;return this._start_col=e,this._end_col=t,this._start_row=i,this._end_row=s,{invalid_column:l,invalid_row:a}}_swap_in(e){this.dispatchEvent(new CustomEvent("regular-table-before-update",{bubbles:!0,detail:this})),this._virtual_scrolling_disabled||(e?(this._sticky_container===this.table_model.table.parentElement&&this._sticky_container.replaceChild(this.table_model.table.cloneNode(!0),this.table_model.table),this._table_staging.appendChild(this.table_model.table)):this._sticky_container!==this.table_model.table.parentElement&&this._sticky_container.replaceChild(this.table_model.table,this._sticky_container.children[0]))}async _swap_out(e){!this._virtual_scrolling_disabled&&e&&this._sticky_container.replaceChild(this.table_model.table,this._sticky_container.children[0]);for(const e of this._style_callbacks.values())await e({detail:this})}_update_virtual_panel_width(e,t){if(e)if(this._virtual_scrolling_disabled)this._virtual_panel.style.width=this._column_sizes.indices.reduce((e,t)=>e+t,0)+"px";else{const e=Math.max(1,this._virtual_panel.offsetWidth-this._container_size.width),i=this.scrollLeft/e,s=this._max_scroll_column(t);let l=0,a=0;for(;l<s;)a+=this._column_sizes.indices[l]||60,l++;const r=this._container_size.width+a;this._virtual_panel.style.width=r+"px",this.scrollLeft=i*a}}_update_virtual_panel_height(e){const{row_height:t=19}=this._column_sizes,i=this.table_model.header.cells.length*t;let l;if(this._virtual_scrolling_disabled)l=e*t+i;else{const a=this.clientHeight/(this._table_clip.offsetHeight-i);l=Math.min(s,e*t*a)}this._virtual_panel.style.height=l+"px"}async draw(e={}){const{reset_scroll_position:t=!1,preserve_width:i=!1,invalid_viewport:s=!0,swap:l=!1}=e;t&&this.reset_scroll(),this._invalid_schema=l||this._invalid_schema;const{num_columns:a,num_rows:r}=await this._view_cache.view(0,0,0,0);this._virtual_scrolling_disabled?this._container_size={width:1/0,height:1/0}:(this._invalid_schema||s)&&(this._container_size={width:this._table_clip.clientWidth,height:this._table_clip.clientHeight});const o=this._calculate_viewport(r,a,t),{invalid_row:n,invalid_column:c}=this._validate_viewport(o);if(this._update_virtual_panel_height(r),this._invalid_schema||n||c||s){this._swap_in(l);const e=await this.table_model.draw(this._container_size,this._view_cache,this._selected_id,i,o,a);await this._swap_out(l),this.table_model.autosize_cells(e),i||this._update_virtual_panel_width(this._invalid_schema||c||s,a),this._invalid_schema=!1}}}).prototype,"draw",[d],Object.getOwnPropertyDescriptor(m.prototype,"draw"),m.prototype),m);var v;let f=(a((v=class extends g{register_listeners(){this.addEventListener("mousedown",this._on_click.bind(this)),this.addEventListener("dblclick",this._on_dblclick.bind(this)),this.addEventListener("scroll",this._on_scroll.bind(this),{passive:!1}),this._register_glitch_scroll_listeners()}async _on_scroll(e){e.stopPropagation(),e.returnValue=!1,await this.draw({invalid_viewport:!1}),this.dispatchEvent(new CustomEvent("regular-table-scroll"))}_register_glitch_scroll_listeners(){this.addEventListener("mousewheel",this._on_mousewheel.bind(this),{passive:!1}),this.addEventListener("touchstart",this._on_touchstart.bind(this),{passive:!1}),this.addEventListener("touchmove",this._on_touchmove.bind(this),{passive:!1})}_on_mousewheel(e){if(this._virtual_scrolling_disabled)return;const{clientWidth:t,clientHeight:i,scrollTop:s,scrollLeft:l,scrollHeight:a}=this;if(e.deltaY>0&&s+i<a||e.deltaY<0&&s>0||0===e.deltaY){e.preventDefault(),e.returnValue=!1;const a=Math.max(1,this._virtual_panel.offsetHeight-i),r=Math.max(1,this._virtual_panel.offsetWidth-t);this.scrollTop=Math.min(a,s+e.deltaY),this.scrollLeft=Math.min(r,l+e.deltaX),this._on_scroll(e)}}_on_touchmove(e){if(this._virtual_scrolling_disabled)return;e.preventDefault(),e.returnValue=!1;const{clientWidth:t,clientHeight:i,scrollTop:s,scrollLeft:l}=this,a=Math.max(1,this._virtual_panel.offsetHeight-i),r=Math.max(1,this._virtual_panel.offsetWidth-t);this.scrollTop=Math.min(a,s+(this._memo_touch_startY-e.touches[0].screenY)),this.scrollLeft=Math.min(r,l+(this._memo_touch_startX-e.touches[0].screenX)),this._on_scroll(e)}_on_touchstart(e){this._memo_touch_startY=e.touches[0].screenY,this._memo_touch_startX=e.touches[0].screenX}async _on_dblclick(e){let t=e.target;for(;"TD"!==t.tagName&&"TH"!==t.tagName;)if(t=t.parentElement,!this._sticky_container.contains(t))return;const s=e.target.classList.contains("pd-column-resize"),l=i.get(t);if(s){await new Promise(setTimeout),delete this._column_sizes.override[l.size_key],delete this._column_sizes.auto[l.size_key],delete this._column_sizes.indices[l.size_key],t.style.minWidth="",t.style.maxWidth="";for(const e of this.table_model.body.cells){const t=e[l._virtual_x];t&&(t.style.minWidth="",t.style.maxWidth="",t.classList.remove("pd-cell-clip"))}await this.draw()}}async _on_click(e){if(0!==e.button)return;let t=e.target;for(;"TD"!==t.tagName&&"TH"!==t.tagName;)if(t=t.parentElement,!this._sticky_container.contains(t))return;const s=e.target.classList.contains("pd-column-resize"),l=i.get(t);s&&this._on_resize_column(e,t,l)}_on_resize_column(e,t,i){const s=e.pageX;t=this.table_model.header.get_column_header(i._virtual_x);const l=this._column_sizes.indices[i.size_key],a=e=>this._on_resize_column_move(e,t,s,l,i),r=async()=>{document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",r);const e=this._column_sizes.override[i.size_key];this._column_sizes.indices[i.size_key]=e,await this.draw()};document.addEventListener("mousemove",a),document.addEventListener("mouseup",r)}async _on_resize_column_move(e,t,i,s,l){await new Promise(setTimeout);const a=e.pageX-i,r=Math.max(1,s+a);if(this._column_sizes.override[l.size_key]=r,a<0)await this.draw({preserve_width:!0});else{t.style.minWidth=r+"px",t.style.maxWidth=r+"px";const e=this._column_sizes.auto[l.size_key];for(const t of this.table_model.body.cells){const i=t[l._virtual_x];i&&(i.style.maxWidth=i.style.minWidth=r+"px",i.classList.toggle("pd-cell-clip",e>r))}}}}).prototype,"_on_resize_column_move",[d],Object.getOwnPropertyDescriptor(v.prototype,"_on_resize_column_move"),v.prototype),v);window.customElements.define("regular-table",class extends f{connectedCallback(){this._initialized||(this.create_shadow_dom(),this.register_listeners(),this.setAttribute("tabindex","0"),this._column_sizes={auto:{},override:{},indices:[]},this._style_callbacks=new Map,this.table_model=new p(this._table_clip,this._column_sizes,this._sticky_container),this!==this._sticky_container.parentElement&&(this.appendChild(this._sticky_container),this.appendChild(this._table_staging)),this._initialized=!0)}_reset_viewport(){this._start_row=void 0,this._end_row=void 0,this._start_col=void 0,this._end_col=void 0}_reset_scroll(){this._column_sizes.indices=[],this.scrollTop=0,this.scrollLeft=0,this._reset_viewport()}_resetAutoSize(){this._column_sizes.auto={},this._column_sizes.override={},this._column_sizes.indices=[];for(const e of this.table_model.header.cells[this.table_model.header.cells.length-1])e.style.minWidth="",e.style.maxWidth=""}clear(){this.table_model=new p(this._table_clip,this._column_sizes,this._sticky_container)}addStyleListener(e){const t=this._style_callbacks.size;return this._style_callbacks.set(t,e),t}getMeta(e){if(void 0!==e){if(e instanceof HTMLElement)return i.get(e);if(e.row_header_x>=0){if(e.row_header_x<this._view_cache.config.row_pivots.length){var t;const i=null===(t=this.table_model.body.cells[e.y])||void 0===t?void 0:t[e.row_header_x];return this.getMeta(i)}}else{var s;if(!(e.column_header_y>=0))return this.getMeta(null===(s=this.table_model.body.cells[e.dy])||void 0===s?void 0:s[e.dx+this.table_model._row_headers_length]);if(e.column_header_y<this._view_cache.config.column_pivots.length){var l;const t=null===(l=this.table_model.body.cells[e.column_header_y])||void 0===l?void 0:l[e.y];return this.getMeta(t)}}}}getDrawFPS(){return function(){const e=performance.now(),t=e-c,i=o,s=1e3*n/t,l=n;return o=0,n=0,c=e,{avg:i,real_fps:s,virtual_fps:1e3/i,num_frames:l,elapsed:t}}()}async scrollToCell(e,t,i,s){const l=this._virtual_panel.offsetHeight/s;this.scrollTop=l*t,this.scrollLeft=e/(this._max_scroll_column(i)||i)*(this.scrollWidth-this.clientWidth),await this.draw()}setDataListener(e){this._invalid_schema=!0,this._view_cache={view:e,config:{row_pivots:[],column_pivots:[]},schema:{}}}})},function(e,t,i){var s=i(2),l=i(12);"string"==typeof(l=l.__esModule?l.default:l)&&(l=[[e.i,l,""]]);var a={insert:"head",singleton:!1};s(l,a);e.exports=l.locals||{}},function(e,t,i){(t=i(3)(!1)).push([e.i,"@import url(https://fonts.googleapis.com/css?family=Open+Sans);"]),t.push([e.i,"@import url(https://fonts.googleapis.com/css?family=Material+Icons);"]),t.push([e.i,"@import url(https://fonts.googleapis.com/css?family=Roboto+Mono);"]),t.push([e.i,"regular-table{padding:12px 0 0 12px;scrollbar-color:transparent transparent;scrollbar-width:thin;outline:none}regular-table:hover{scrollbar-color:rgba(0,0,0,.3) transparent}regular-table{font-family:Open Sans}regular-table div[tabindex]{outline:none}regular-table>div{position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden}regular-table th{text-align:center}regular-table thead tr:not(:last-child) th{overflow:hidden;max-width:0}regular-table tbody .pd-float,regular-table thead tr:last-child .pd-float{text-align:right}regular-table tbody .pd-integer,regular-table thead .pd-integer{text-align:right}regular-table tbody th{text-align:left}regular-table span.pd-tree-container{display:flex;align-items:center;height:100%}regular-table tbody .pd-date,regular-table tbody .pd-datetime,regular-table tbody .pd-string,regular-table thead .pd-date,regular-table thead .pd-datetime,regular-table thead .pd-string{text-align:left}regular-table thead tr:last-child th{border-bottom:1px solid #ddd}regular-table th{position:relative}regular-table tr th span.pd-tree-group{margin-left:5px;margin-right:15px;border-left:1px solid #eee;height:100%}regular-table td,regular-table th{white-space:nowrap;font-size:12px;padding:0 5px;height:19px}regular-table tr:hover td{background:#eee;opacity:1}regular-table tr:hover{color:#333}regular-table table *{box-sizing:border-box}regular-table table{position:absolute;overflow:hidden;color:#666;outline:none}regular-table span.pd-row-header-icon{color:#aaa;padding-right:4px;font-family:Material Icons}regular-table span.pd-column-header-icon{font-size:10px;padding-left:3px;display:inline-block;width:10px;font-family:Material Icons}regular-table span.pd-row-header-icon:hover{color:#1a7da1;text-shadow:0 0 3px #1a7da1}regular-table .pd-selected td{background-color:#eee}regular-table .pd-cell-clip{overflow:hidden;text-overflow:ellipsis}regular-table td span.pd-group-name,regular-table th span.pd-group-name{margin-right:-5px;padding-right:5px;padding-left:8px;flex:1;height:100%}regular-table th span.pd-group-name{text-align:left}regular-table td th span.pd-group-leaf,regular-table th span.pd-group-leaf{margin-left:16px;height:100%}regular-table .pd-column-resize{height:100%;width:10px;position:absolute;top:0;right:0;cursor:col-resize}regular-table::-webkit-scrollbar,regular-table::-webkit-scrollbar-corner{background-color:transparent;height:12px;width:12px}regular-table::-webkit-scrollbar-thumb{background-clip:content-box;background-color:transparent;border-radius:5px}regular-table::-webkit-scrollbar-thumb:horizontal{border-bottom:2px solid transparent;border-top:2px solid transparent}regular-table::-webkit-scrollbar-thumb:vertical{border-left:2px solid transparent;border-right:2px solid transparent}regular-table:hover::-webkit-scrollbar-thumb{background-color:rgba(0,0,0,.15)}regular-table::-webkit-scrollbar-thumb:hover{background-color:rgba(0,0,0,.3)}",""]),e.exports=t},function(e,t,i){(t=i(3)(!1)).push([e.i,"div.ipyregulartable {\n  min-height: 200px;\n  /* resize: both; */\n}\n\ndiv.ipyregulartable td.highlight {\n  background-color: rgba(0,0,155, 0.1);\n}\n",""]),e.exports=t}])}));
//# sourceMappingURL=index.js.map
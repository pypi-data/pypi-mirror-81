<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
	<title></title>
	<meta name="generator" content="LibreOffice 6.3.5.2 (Linux)"/>
	<meta name="author" content="Jacques"/>
	<meta name="created" content="2013-05-10T09:47:00"/>
	<meta name="changed" content="2020-09-19T16:30:15.213587919"/>
	<meta name="AppVersion" content="12.0000"/>
	<meta name="DocSecurity" content="0"/>
	<meta name="HyperlinksChanged" content="false"/>
	<meta name="LinksUpToDate" content="false"/>
	<meta name="ScaleCrop" content="false"/>
	<meta name="ShareDoc" content="false"/>
	<style type="text/css">
		@page { size: 8.27in 11.69in; margin-left: 0.98in; margin-right: 0.98in; margin-top: 0.98in; margin-bottom: 0.49in }
		p { margin-bottom: 0.1in; direction: ltr; line-height: 115%; text-align: left; orphans: 2; widows: 2; background: transparent }
		h1 { margin-top: 0.33in; margin-bottom: 0in; direction: ltr; color: #365f91; line-height: 115%; text-align: left; page-break-inside: avoid; orphans: 2; widows: 2; background: transparent; page-break-after: avoid }
		h1.western { font-family: "Cambria", serif; font-size: 14pt; font-weight: bold }
		h1.cjk { font-family: "Calibri"; font-size: 14pt; font-weight: bold }
		h1.ctl { font-family: "Droid Sans Arabic"; font-size: 14pt; font-weight: bold }
		h2 { margin-top: 0.14in; margin-bottom: 0in; direction: ltr; color: #4f81bd; line-height: 115%; text-align: left; page-break-inside: avoid; orphans: 2; widows: 2; background: transparent; page-break-after: avoid }
		h2.western { font-family: "Cambria", serif; font-size: 13pt; font-weight: bold }
		h2.cjk { font-family: "Calibri"; font-size: 13pt; font-weight: bold }
		h2.ctl { font-family: "Droid Sans Arabic"; font-size: 13pt; font-weight: bold }
		a:link { color: #0000ff; text-decoration: underline }
	</style>
</head>
<body lang="nl-NL" link="#0000ff" vlink="#800000" dir="ltr"><p lang="en-US" align="center" style="margin-bottom: 0.14in">
<font size="6" style="font-size: 28pt"><b>SimPyLC HowTo</b></font></p>
<p lang="en-US" align="center" style="margin-bottom: 0.14in">Â©
2013-2020 GEATEC engineering, www.geatec.com</p>
<p lang="en-US" align="center" style="margin-bottom: 0.14in"><font size="3" style="font-size: 12pt">Author:
Jacques de Hooge</font></p>
<p lang="en-US" align="center" style="margin-bottom: 0.14in"><font color="#943634"><font size="5" style="font-size: 20pt"><i>&quot;Simplicity
is the hallmark of the true&quot;</i></font></font></p>
<div id="Table of Contents1" dir="ltr">
	<div id="TextSection" dir="ltr"><h1 lang="en-US" class="toc-heading">
		Table of contents</h1>
		<p lang="en-US" style="margin-bottom: 0.07in"><br/>
<br/>

		</p>
	</div>
	<p style="margin-bottom: 0.07in"><a href="#_Toc508123206"><span lang="en-US">QQuickLicence
	governing the use of SimPyLC and of its generated code</span></a><a href="#_Toc508123206">	2</a></p>
	<p style="margin-bottom: 0.07in"><a href="#_Toc508123207"><span lang="en-US">Introduction</span></a><a href="#_Toc508123207">	3</a></p>
	<p style="margin-bottom: 0.07in"><a href="#_Toc508123208"><span lang="en-US">Installation</span></a><a href="#_Toc508123208">	4</a></p>
	<p style="margin-bottom: 0.07in"><a href="#_Toc508123209"><span lang="en-US">GUI
	quick reference</span></a><a href="#_Toc508123209">	5</a></p>
	<p style="margin-bottom: 0.07in"><a href="#_Toc508123210"><span lang="en-US">Putting
	together a simulation</span></a><a href="#_Toc508123210">	6</a></p>
	<p style="margin-bottom: 0.07in"><a href="#_Toc508123211"><span lang="en-US">Basic
	control elements</span></a><a href="#_Toc508123211">	7</a></p>
	<p style="margin-bottom: 0.07in"><a href="#_Toc508123212"><span lang="en-US">The
	PLC programming paradigm</span></a><a href="#_Toc508123212">	9</a></p>
	<p style="margin-bottom: 0.07in"><a href="#_Toc508123213"><span lang="en-US">PLC
	programming rules</span></a><a href="#_Toc508123213">	11</a></p>
	<p style="margin-bottom: 0.07in"><a href="#_Toc508123214"><span lang="en-US">What
	is wrong with encapsulation and control structures?</span></a><a href="#_Toc508123214">	13</a></p>
	<p style="margin-bottom: 0.07in"><a href="#_Toc508123215"><span lang="en-US">But
	what makes controlling a robot system so different?</span></a><a href="#_Toc508123215">	14</a></p>
	<p style="margin-bottom: 0.07in"><a href="#_Toc508123216"><span lang="en-US">Control
	levels</span></a><a href="#_Toc508123216">	15</a></p>
	<p style="margin-bottom: 0.07in"><a href="#_Toc508123217"><span lang="en-US">Putting
	a robot system into active operation</span></a><a href="#_Toc508123217">	16</a></p>
	<p style="margin-bottom: 0.07in"><a href="#_Toc508123218"><span lang="en-US">The
	SimPyLC simulator</span></a><a href="#_Toc508123218">	17</a></p>
	<p style="margin-bottom: 0.07in"><a href="#_Toc508123219"><span lang="en-US">Example
	of an assignment linked to elementary physics</span></a><a href="#_Toc508123219">	18</a></p>
	<p style="margin-bottom: 0.07in"><a href="#_Toc508123220"><span lang="en-US">Code
	generation for the Arduino</span></a><a href="#_Toc508123220">	19</a></p>
	<p style="margin-left: 0.15in; margin-bottom: 0.07in"><a href="#_Toc508123221"><span lang="en-US">The
	arduinoLed example</span></a><a href="#_Toc508123221">	20</a></p>
	<p style="margin-left: 0.15in; margin-bottom: 0.07in"><a href="#_Toc508123222"><span lang="en-US">The
	arduinoTraficLight example</span></a><a href="#_Toc508123222">	21</a></p>
	<p style="margin-left: 0.15in; margin-bottom: 0.07in"><a href="#_Toc508123223"><span lang="en-US">The
	arduinoStove example</span></a><a href="#_Toc508123223">	25</a></p>
	<p style="margin-bottom: 0.07in"><a href="#_Toc508123224"><span lang="en-US">Some
	timing hints and pitfalls</span></a><a href="#_Toc508123224">	29</a></p>
	<p style="margin-left: 0.15in; margin-bottom: 0.07in"><a href="#_Toc508123225"><span lang="en-US">Integration
	and differentiation</span></a><a href="#_Toc508123225">	29</a></p>
	<p style="margin-left: 0.15in; margin-bottom: 0.07in"><a href="#_Toc508123226"><span lang="en-US">Edge
	triggering for buttons and timers</span></a><a href="#_Toc508123226">	29</a></p>
	<p style="margin-bottom: 0.07in"><a href="#_Toc508123227"><span lang="en-US">Making
	a hierarchical visualistation</span></a><a href="#_Toc508123227">	31</a></p>
	<p style="margin-left: 0.15in; margin-bottom: 0.07in"><a href="#_Toc508123228"><span lang="en-US">Principle</span></a><a href="#_Toc508123228">	31</a></p>
	<p style="margin-bottom: 0.14in"><br/>
<br/>

	</p>
</div>
<h1 lang="en-US" class="western"><a name="_Toc508123206"></a>QQuickLicence
governing the use of SimPyLC and of its generated code</h1>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><br/>

</p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%">This
license governs use of the accompanying software (&quot;Software&quot;),
and your use of  the Software constitutes acceptance of this license.</p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><br/>

</p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%">You may
use the Software for any commercial or noncommercial purpose,
including distributing derivative works.</p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><br/>

</p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%">In
return, it is required that you agree:</p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><br/>

</p>
<ol>
	<li><p lang="en-US" style="margin-bottom: 0in; line-height: 100%">Not
	to remove any copyright or other notices from the Software. 
	</p>
	<li><p lang="en-US" style="margin-bottom: 0in; line-height: 100%">That
	if you distribute the Software in source code form you do so only
	under this license (i.e. you must include a complete copy of this
	license with your distribution in a plain text file named
	QQuickLicence.txt), and if you distribute the Software solely in
	object form you only do so under a license that complies with this
	license. 
	</p>
	<li><p lang="en-US" style="margin-bottom: 0in; line-height: 100%">That
	the Software comes &quot;as is&quot;, with no warranties. None
	whatsoever. This means no express, implied or statutory warranty,
	including without limitation, warranties of merchantability or
	fitness for a particular purpose or any warranty of title or
	non-infringement. Also, you must pass this disclaimer on whenever
	you distribute the Software or derivative works. 
	</p>
	<li><p lang="en-US" style="margin-bottom: 0in; line-height: 100%">That
	neither Geatec Engineering nor any contributor to the Software will
	be liable for any of those types of damages known as indirect,
	special, consequential, or incidental related to the Software or
	this license, to the maximum extent the law permits, no matter what
	legal theory it's based on. Also, you must pass this limitation of
	liability on whenever you distribute the Software or derivative
	works.</p>
	<li><p lang="en-US" style="margin-bottom: 0in; line-height: 100%">That
	you will not use or cause usage of the Software in safety-critical
	situations under any circumstances.</p>
	<li><p lang="en-US" style="margin-bottom: 0in; line-height: 100%">That
	if you sue anyone over patents that you think may apply to the
	Software for a person's use of the Software, your license to the
	Software ends automatically. 
	</p>
	<li><p lang="en-US" style="margin-bottom: 0in; line-height: 100%">That
	your rights under this License end automatically if you breach it in
	any way.</p>
	<li><p lang="en-US" style="margin-bottom: 0in; line-height: 100%">That
	all rights not expressly granted to you in this license are
	reserved.</p>
</ol>
<h1 lang="en-US" class="western" style="page-break-before: always"><a name="_Toc508123207"></a>
Introduction</h1>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<p lang="en-US" style="margin-bottom: 0.14in">This document briefly
describes the functions of the SimPyLC control simulator. Purpose of
the simulator is to allow students to get acquainted with the design
of real time controls for automated production and transportation
systems. The controlled systems may range from out of the box
assembly line robots to special purpose robot cranes and
automatically controlled transportation vehicles.</p>
<p lang="en-US" style="margin-bottom: 0.14in">Real time control of
such systems often utilize a PLC (Programmable Logic Controller). A
PLC has to perform a lot of tasks in parallel. It does so using
design patterns that are very different from the ones used in
mainstream design of non-control programs. When it comes to
performing tasks in parallel, traditionally things like interprocess
communication, threads, semaphores, queues en critical sections may
come to mind.</p>
<p lang="en-US" style="margin-bottom: 0.14in">Synchronizing tasks by
means of these facilities is error prone. Problems may range from
deadlocks, where processes are waiting for each other forever, to
race conditions, where it's unclear which action will be performed
first. Use of queues as means of interprocess communication opens the
possibility of control commands being accumulated unwantedly, taking
effect at an unexpected moment. Suddenly the system (which may be as
small as an electronics welding robot, but also as big as a container
crane) starts executing a movement, which may  be very dangerous.</p>
<p lang="en-US" style="margin-bottom: 0.14in">Safety plays a major
role in designing real time control systems. Even a small production
robot may cause harm in an environment where also human labor is
being performed. The main demand to be made on a real control system
is that the environment is being watched constantly and that actions
are not solely dictated by supervisory commands and previous program
state, but also by constant evaluation of sensor input from the
environment.</p>
<p style="margin-bottom: 0.14in"><span lang="en-US">To be able to
experiment with controlling real hardware, a code generator for the
well known Arduino processor board has been added. </span><span lang="en-US"><b>Note
that the simulator as well as the code generator may contain bugs. So
the generated code is only suitable for educational purposes and
controlled systems should be chosen not to pose any risk of damage or
injury in case of control malfunction.</b></span><span lang="en-US">
A control can be simulated in advance and when it is ready, C code
can be generated and uploaded to the Arduino.</span></p>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<h1 lang="en-US" class="western" style="page-break-before: always"><a name="_Toc508123208"></a>
Installation</h1>
<p lang="en-US" style="margin-top: 0.19in; margin-bottom: 0.19in; line-height: 100%">
<font color="#000000"><font face="Calibri, serif"><font size="2" style="font-size: 11pt">Windows:</font></font></font></p>
<ol>
	<li><p style="margin-top: 0.19in; margin-bottom: 0in; line-height: 100%">
	<font color="#000000"><span lang="en-US">Install MiniConda for
	Python 3.</span></font><font color="#000000"><span lang="en-US">8</span></font><font color="#000000"><span lang="en-US">
	from&nbsp;</span></font><a href="https://conda.io/miniconda.html"><span lang="en-US">https://conda.io/miniconda.html</span></a></p>
	<li><p style="margin-bottom: 0in; line-height: 100%"><font color="#000000">Open
	a command prompt</font></p>
	<li><p style="margin-bottom: 0in; line-height: 100%"><font color="#000000">Type
	</font><font face="Courier New, serif"><font size="2" style="font-size: 10pt"><font color="#000000"><font size="2" style="font-size: 11pt">conda
	install numpy</font></font></font></font></p>
	<li><p style="margin-bottom: 0in; line-height: 100%"><font color="#000000">Type&nbsp;</font><font face="Courier New, serif"><font size="2" style="font-size: 10pt"><font color="#000000"><font size="2" style="font-size: 11pt">conda
	install pyopengl</font></font></font></font></p>
	<li><p style="margin-bottom: 0in; line-height: 100%"><font color="#000000"><span lang="en-US">Type
	</span></font><font face="Courier New, serif"><font size="2" style="font-size: 10pt"><font color="#000000"><font size="2" style="font-size: 11pt"><span lang="en-US">python
	-m pip install simpylc</span></font></font></font></font></p>
	<li><p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><font color="#000000">Perform
	one of the following alternatives:</font></p>
	<ol>
		<li><p style="margin-bottom: 0in; line-height: 100%"><font color="#000000"><span lang="en-US">Install
		FreeGlut as explained
		on&nbsp;</span></font><a href="http://freeglut.sourceforge.net/index.php#download"><span lang="en-US">http://freeglut.sourceforge.net/index.php#download</span></a></p>
		<li><p style="margin-bottom: 0in; line-height: 100%"><font color="#000000"><span lang="en-US">Copy&nbsp;</span></font><font face="Courier New, serif"><font size="2" style="font-size: 10pt"><font color="#000000"><font size="2" style="font-size: 11pt"><span lang="en-US">SimPyLC\SimPyLC\freeglut.dll</span></font></font></font></font><font color="#000000"><span lang="en-US">&nbsp;to
		any directory in the Windows DLL path</span></font></p>
	</ol>
	<li><p style="margin-bottom: 0.19in; line-height: 100%"><font color="#000000"><span lang="en-US">Optionally
	copy&nbsp;</span></font><font face="Courier New, serif"><font size="2" style="font-size: 10pt"><font color="#000000"><font size="2" style="font-size: 11pt"><span lang="en-US">SimPyLC\SimPyLC\QuartzMS.TTF</span></font></font></font></font><font color="#000000"><span lang="en-US">&nbsp;to&nbsp;</span></font><font face="Courier New, serif"><font size="2" style="font-size: 10pt"><font color="#000000"><font size="2" style="font-size: 11pt"><span lang="en-US">C:\\Windows\\Fonts</span></font></font></font></font></p>
</ol>
<p lang="en-US" style="margin-top: 0.19in; margin-bottom: 0.19in; line-height: 100%">
<font color="#000000"><font face="Calibri, serif"><font size="2" style="font-size: 11pt">Linux:</font></font></font></p>
<ol>
	<li><p style="margin-top: 0.19in; margin-bottom: 0in; line-height: 100%">
	<font color="#000000"><span lang="en-US">Install MiniConda for
	Python 3.</span></font><font color="#000000"><span lang="en-US">8</span></font><font color="#000000"><span lang="en-US">
	from&nbsp;</span></font><a href="https://conda.io/miniconda.html"><span lang="en-US">https://conda.io/miniconda.html</span></a></p>
	<li><p style="margin-bottom: 0in; line-height: 100%"><font color="#000000">Open
	a command prompt</font></p>
	<li><p style="margin-bottom: 0in; line-height: 100%"><font color="#000000">Type</font><font face="Courier New, serif"><font size="2" style="font-size: 10pt"><font color="#000000"><font size="2" style="font-size: 11pt">
	conda install numpy</font></font></font></font></p>
	<li><p style="margin-bottom: 0in; line-height: 100%"><font color="#000000">Type&nbsp;</font><font face="Courier New, serif"><font size="2" style="font-size: 10pt"><font color="#000000"><font size="2" style="font-size: 11pt">conda
	install pyopengl</font></font></font></font></p>
	<li><p style="margin-bottom: 0in; line-height: 100%"><font color="#000000"><span lang="en-US">Type
	</span></font><font face="Courier New, serif"><font size="2" style="font-size: 10pt"><font color="#000000"><font size="2" style="font-size: 11pt"><span lang="en-US">python
	-m pip install simpylc</span></font></font></font></font></p>
	<li><p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><font color="#000000">Perform
	one of the following alternatives:</font></p>
	<ol>
		<li><p style="margin-bottom: 0in; line-height: 100%"><font color="#000000"><span lang="en-US">Install
		FreeGlut as explained
		on&nbsp;</span></font><a href="http://freeglut.sourceforge.net/index.php#download"><span lang="en-US">http://freeglut.sourceforge.net/index.php#download</span></a><font color="#000000"><span lang="en-US">.</span></font></p>
		<li><p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><font color="#000000">Type
		the following command sequence:</font></p>
		<ul>
			<li><p style="margin-bottom: 0in; line-height: 100%"><font face="Courier New, serif"><font size="2" style="font-size: 10pt"><font color="#000000"><font size="2" style="font-size: 11pt">sudo
			apt-get update</font></font></font></font></p>
			<li><p style="margin-bottom: 0in; line-height: 100%"><font face="Courier New, serif"><font size="2" style="font-size: 10pt"><font color="#000000"><font size="2" style="font-size: 11pt"><span lang="en-US">sudo
			apt-get install build-essential</span></font></font></font></font></p>
			<li><p style="margin-bottom: 0.19in; line-height: 100%"><font face="Courier New, serif"><font size="2" style="font-size: 10pt"><font color="#000000"><font size="2" style="font-size: 11pt"><span lang="en-US">sudo
			apt-get install freeglut3-dev</span></font></font></font></font></p>
		</ul>
	</ol>
</ol>
<p lang="en-US" style="margin-top: 0.19in; margin-bottom: 0.19in; line-height: 100%">
<font color="#000000"><font face="Calibri, serif"><font size="2" style="font-size: 11pt">OSX:</font></font></font></p>
<ol>
	<li><p style="margin-top: 0.19in; margin-bottom: 0in; line-height: 100%">
	<font color="#000000"><span lang="en-US">Install MiniConda for
	Python 3.</span></font><font color="#000000"><span lang="en-US">8</span></font><font color="#000000"><span lang="en-US">
	from&nbsp;</span></font><a href="https://conda.io/miniconda.html"><span lang="en-US">https://conda.io/miniconda.html</span></a></p>
	<li><p style="margin-bottom: 0in; line-height: 100%"><font color="#000000">Open
	a command prompt</font></p>
	<li><p style="margin-bottom: 0in; line-height: 100%"><font color="#000000">Type
	</font><font face="Courier New, serif"><font size="2" style="font-size: 10pt"><font color="#000000"><font size="2" style="font-size: 11pt">conda
	install numpy</font></font></font></font></p>
	<li><p style="margin-bottom: 0in; line-height: 100%"><font color="#000000">Type
	</font><font face="Courier New, serif"><font size="2" style="font-size: 10pt"><font color="#000000"><font size="2" style="font-size: 11pt">conda
	install pyopengl</font></font></font></font></p>
	<li><p style="margin-bottom: 0in; line-height: 100%"><font color="#000000"><span lang="en-US">Type&nbsp;</span></font><font face="Courier New, serif"><font size="2" style="font-size: 10pt"><font color="#000000"><font size="2" style="font-size: 11pt"><span lang="en-US">python
	-m pip install simpylc</span></font></font></font></font></p>
	<li><p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><font color="#000000">Perform
	one of the following alternatives:</font></p>
	<ol>
		<li><p style="margin-bottom: 0in; line-height: 100%"><font color="#000000"><span lang="en-US">Install
		FreeGlut as explained
		on&nbsp;</span></font><a href="http://freeglut.sourceforge.net/index.php#download"><span lang="en-US">http://freeglut.sourceforge.net/index.php#download</span></a></p>
		<li><p style="margin-bottom: 0in; line-height: 100%"><font color="#000000">Type:&nbsp;</font><font face="Courier New, serif"><font size="2" style="font-size: 10pt"><font color="#000000"><font size="2" style="font-size: 11pt">brew
		</font></font></font></font><span lang="en-US">install freeglut</span></p>
	</ol>
	<li><p style="margin-bottom: 0in; line-height: 100%"><font color="#000000"><span lang="en-US">Install
	the XQuartz X-window system from&nbsp;</span></font><a href="https://www.xquartz.org/"><span lang="en-US">https://www.xquartz.org</span></a></p>
	<li><p style="margin-bottom: 0.19in; line-height: 100%"><span lang="en-US">If
	during use the message </span><font face="Courier New, serif"><span lang="en-US">No
	matching pixelformats found</span></font><span lang="en-US"> is
	displayed</span><font color="#000000"><span lang="en-US"> </span></font><span lang="en-US">then
	type </span><span style="display: inline-block; border: none; padding: 0in"><font face="Courier New, serif"><span lang="en-US"><span style="background: #ffffff"><font color="#000000">export
	LIBGL_ALLOW_SOFTWARE=1 </span></span></font></font><span lang="en-US"><span style="background: #ffffff"><font color="#000000">prior
	to starting SimPyLC, or adapt this environment variable permanently.</span></span></span></font></p>
</ol>
<h1 lang="en-US" class="western"><br/>

</h1>
<h1 lang="en-US" class="western" style="page-break-before: always"><a name="_Toc508123209"></a>
GUI quick reference</h1>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<ul>
	<li><p lang="en-US" style="margin-bottom: 0.14in">[LEFT CLICK] on a
	field or [ENTER] gets you into edit mode.</p>
	<li><p lang="en-US" style="margin-bottom: 0.14in">[LEFT CLICK] or
	[ENTER] again gets you out of edit mode and into forced mode, values
	colored orange are frozen.</p>
	<li><p lang="en-US" style="margin-bottom: 0.14in">[RIGHT CLICK] or
	[ESC] gets you into released mode, values are thawed again.</p>
	<li><p lang="en-US" style="margin-bottom: 0.14in">[PGUP] and [PGDN]
	change the currently viewed control page.</p>
	<li><p lang="en-US" style="margin-bottom: 0.14in">[WHEEL PRESS] on a
	marker field makes it 1, release makes it 0 again, both without
	freezing it.</p>
	<li><p lang="en-US" style="margin-bottom: 0.14in">[WHEEL ROTATE]
	changes the value of a register field, without freezing it.</p>
</ul>
<h1 lang="en-US" class="western" style="page-break-before: always"><a name="_Toc508123210"></a>
Putting together a simulation</h1>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<p lang="en-US" style="margin-bottom: 0.14in">Two  example
simulations are part of the SimPyLC distribution.</p>
<p style="margin-bottom: 0.14in"><span lang="en-US"><u>The one to
start with is in the </u></span><span lang="en-US"><i><u>blinkingLight</u></i></span><span lang="en-US"><u>
directory</u></span><span lang="en-US">. To understand what is
happening, run the example in that directory from the command line:
</span><span lang="en-US"><i>python world.py</i></span><span lang="en-US">.
Look at the sourcecode in </span><span lang="en-US"><i>blinkingLight.py</i></span><span lang="en-US">
and at the sequence diagram of the running application to see causes
and effects. Also take a look at </span><span lang="en-US"><i>timing.py</i></span><span lang="en-US">
to see how the sequence diagram is defined and at </span><span lang="en-US"><i>world.py</i></span><span lang="en-US">
to see how the parts of the simulation are tied together.</span></p>
<p style="margin-bottom: 0.14in"><span lang="en-US"><u>The second
example is in the </u></span><span lang="en-US"><i><u>oneArmedRobot 
</u></i></span><span lang="en-US"><u>directory</u></span><span lang="en-US">,
and consists of the following files:</span></p>
<table width="100%" cellpadding="4" cellspacing="0">
	<col width="61*"/>

	<col width="195*"/>

	<tr valign="top">
		<td width="24%" style="border: none; padding: 0in"><p lang="en-US"><i>world.py</i></p>
		</td>
		<td width="76%" style="border: none; padding: 0in"><p lang="en-US">Defines
			the parts that make up the simulation</p>
		</td>
	</tr>
	<tr valign="top">
		<td width="24%" style="border: none; padding: 0in"><p lang="en-US"><i>robot.py</i></p>
		</td>
		<td width="76%" style="border: none; padding: 0in"><p lang="en-US">A
			SimPyLC module that simulates the physics of a production robot</p>
		</td>
	</tr>
	<tr valign="top">
		<td width="24%" style="border: none; padding: 0in"><p lang="en-US"><i>control.py</i></p>
		</td>
		<td width="76%" style="border: none; padding: 0in"><p lang="en-US">A
			SimPyLC module that contains the control software for the robot</p>
		</td>
	</tr>
	<tr valign="top">
		<td width="24%" style="border: none; padding: 0in"><p lang="en-US"><i>visualisation.py</i></p>
		</td>
		<td width="76%" style="border: none; padding: 0in"><p lang="en-US">Contains
			an OpenGL visualisation of the robot</p>
		</td>
	</tr>
	<tr valign="top">
		<td width="24%" style="border: none; padding: 0in"><p lang="en-US"><i>timing.py</i></p>
		</td>
		<td width="76%" style="border: none; padding: 0in"><p lang="en-US">Draws
			sequence diagrams of selected signals</p>
		</td>
	</tr>
</table>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<p style="margin-bottom: 0.14in"><span lang="en-US">Start the example
simulation from the command line in the same way as the first
example: </span><span lang="en-US"><i>python world.py</i></span><span lang="en-US">.
Play around with it. A control element gets in the input state by a
[left click] or by pressing </span><span lang="en-US"><i>[enter].</i></span><span lang="en-US">
Then you can input a value. </span><span lang="en-US"><i>[Left
click]</i></span><span lang="en-US">ing or pressing </span><span lang="en-US"><i>[enter]</i></span><span lang="en-US">
again will force the control element to retain the value you
specified. </span><span lang="en-US"><i>[Right click]</i></span><span lang="en-US">ing
or pressing </span><span lang="en-US"><i>[esc]</i></span><span lang="en-US">
will release the control element, allowing it to be overwritten.</span></p>
<p style="margin-bottom: 0.14in"><span lang="en-US">Start by reading
through </span><span lang="en-US"><i>robot.py </i></span><span lang="en-US">using
the circuit descriptions above, and try to find out what makes it
tick. Then shift your attention to </span><span lang="en-US"><i>control.py</i></span><span lang="en-US">
for a little more complexity. Pay special attention to the </span><font color="#984806"><span lang="en-US"><b>input</b></span></font><span lang="en-US">
methods of both the </span><font color="#984806"><span lang="en-US"><b>Robot</b></span></font><span lang="en-US">
and </span><font color="#984806"><span lang="en-US"><b>Control</b></span></font><span lang="en-US">
class, to gain insight in how these modules (both inherit from class
</span><font color="#984806"><span lang="en-US"><b>Module</b></span></font><span lang="en-US">)
exchange control signals.</span></p>
<p style="margin-bottom: 0.14in"><span lang="en-US">Then take a brief
look to into </span><span lang="en-US"><i>visualisation.py</i></span><span lang="en-US">
to find out how a so called hierarchical model works. Peek into the
file </span><span lang="en-US"><i>graphics.py</i></span><span lang="en-US">
to see how OpenGL is involved. Google for &quot;OpenGL Hierarchical
Modeling&quot; to find many explanations of how this works.</span></p>
<p style="margin-bottom: 0.14in"><span lang="en-US">Also take a look
at </span><span lang="en-US"><i>timing.py</i></span><span lang="en-US">
to see how the channels of the sequence diagram are configured.</span></p>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<h1 lang="en-US" class="western" style="page-break-before: always"><a name="_Toc508123211"></a>
Basic control elements</h1>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><font color="#984806"><b>class
Marker:</b></font></p>
<p lang="en-US" style="margin-left: 0.49in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b># Boolean expression evaluator</b></font></p>
<p lang="en-US" style="margin-left: 0.49in; margin-bottom: 0in; line-height: 100%">
<font color="#984806"><b>def __init__ (self, condition = False):</b></font></p>
<p lang="en-US" style="margin-left: 0.98in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b># Sets the boolean value of the marker to 
condition</b></font></p>
<p lang="en-US" style="margin-left: 0.49in; margin-bottom: 0in; line-height: 100%">
<font color="#984806"><b>def mark (self, trueValue, condition = True,
falseValue = None):</b></font></p>
<p lang="en-US" style="margin-left: 0.98in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b># Sets the boolean value of the marker to
trueValue if condition is True</b></font></p>
<p lang="en-US" style="margin-left: 0.98in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b># Sets the boolean value of the marker to
falseValue if:</b></font></p>
<p lang="en-US" style="margin-left: 0.98in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b>#	- condition is False</b></font></p>
<p lang="en-US" style="margin-left: 0.98in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b>#	and</b></font></p>
<p lang="en-US" style="margin-left: 0.98in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b>#	- parameter falseValue is present and not
None</b></font></p>
<p lang="en-US" style="margin-left: 0.98in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b># Leaves the boolean value of the marker
unaltered if:</b></font></p>
<p lang="en-US" style="margin-left: 0.98in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b>#	- condition is False</b></font></p>
<p lang="en-US" style="margin-left: 0.98in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b>#	and</b></font></p>
<p lang="en-US" style="margin-left: 0.98in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b>#	- parameter falseValue is absent or None</b></font></p>
<p lang="en-US" style="margin-left: 0.49in; margin-bottom: 0in; line-height: 100%">
<br/>

</p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><font color="#984806"><b>class
Oneshot:</b></font></p>
<p lang="en-US" style="margin-left: 0.49in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b># Edge detector</b></font></p>
<p lang="en-US" style="margin-left: 0.49in; margin-bottom: 0in; line-height: 100%">
<font color="#984806"><b>def __init__ (self, condition = False):</b></font></p>
<p lang="en-US" style="margin-left: 0.98in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b># Initializes the boolean value of the
oneshot to condition</b></font></p>
<p lang="en-US" style="margin-left: 0.49in; margin-bottom: 0in; line-height: 100%">
<font color="#984806"><b>def trigger (self, condition):</b></font></p>
<p lang="en-US" style="margin-left: 0.98in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b># Sets the boolean value of the oneshot to
True if:</b></font></p>
<p lang="en-US" style="margin-left: 0.98in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b>#	- condition is True</b></font></p>
<p lang="en-US" style="margin-left: 0.98in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b>#	and</b></font></p>
<p lang="en-US" style="margin-left: 0.98in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b>#	- condition was False previously</b></font></p>
<p lang="en-US" style="margin-left: 0.98in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b># Resets theboolean value of the oneshot to
False in all other cases</b></font></p>
<p lang="en-US" style="margin-left: 0.98in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b># So a oneshot can only remain True for at
most one sweep</b></font></p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><br/>

</p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><font color="#984806"><b>class
Latch:</b></font></p>
<p lang="en-US" style="margin-left: 0.49in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b># Boolean memory cell</b></font></p>
<p lang="en-US" style="margin-left: 0.49in; margin-bottom: 0in; line-height: 100%">
<font color="#984806"><b>def __init__ (self, condition = False):</b></font></p>
<p lang="en-US" style="margin-left: 0.98in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b># Sets the boolean value of the latch to
condition</b></font></p>
<p lang="en-US" style="margin-left: 0.49in; margin-bottom: 0in; line-height: 100%">
<font color="#984806"><b>def latch (self, condition):</b></font></p>
<p lang="en-US" style="margin-left: 0.98in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b># Sets the boolean value of the latch to
True if condition is True</b></font></p>
<p lang="en-US" style="margin-left: 0.98in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b># Leaves it unaltered if condition is False</b></font></p>
<p lang="en-US" style="margin-left: 0.49in; margin-bottom: 0in; line-height: 100%">
<font color="#984806"><b>def unlatch (self, condition):</b></font></p>
<p lang="en-US" style="margin-left: 0.98in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b># Sets the boolean value of the latch to 
False if condition is True</b></font></p>
<p lang="en-US" style="margin-left: 0.98in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b># Leaves it unaltered if condition is False</b></font></p>
<p lang="en-US" style="margin-left: 0.49in; margin-bottom: 0in; line-height: 100%">
<br/>

</p>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%; page-break-before: always">
<font color="#984806"><b>class Register :</b></font></p>
<p style="margin-bottom: 0in; line-height: 100%"><font color="#984806"><span lang="en-US"><b>	</b></span></font><font color="#00b050"><span lang="en-US"><b>#
Numerical expression evaluator</b></span></font></p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><font color="#984806"><b>	def
__init__ (self, value = 0):</b></font></p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><font color="#00b050"><b>		#
Sets the numerical value of the register to value</b></font></p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><font color="#984806"><b>	def
set (self, trueValue, condition = True, falseValue = None):</b></font></p>
<p lang="en-US" style="margin-left: 0.49in; text-indent: 0.49in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b># Sets the numerical value of the register
to trueValue if condition is True</b></font></p>
<p lang="en-US" style="margin-left: 0.49in; text-indent: 0.49in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b># Sets the numerical value of the register
to falseValue if:</b></font></p>
<p lang="en-US" style="margin-left: 0.49in; text-indent: 0.49in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b>#	- condition is False</b></font></p>
<p lang="en-US" style="margin-left: 0.49in; text-indent: 0.49in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b>#	and</b></font></p>
<p lang="en-US" style="margin-left: 0.49in; text-indent: 0.49in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b>#	- parameter falseValue is present and not
None</b></font></p>
<p lang="en-US" style="margin-left: 0.49in; text-indent: 0.49in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b># Leaves the numerical value of the register
unaltered if:</b></font></p>
<p lang="en-US" style="margin-left: 0.49in; text-indent: 0.49in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b>#	- condition is False</b></font></p>
<p lang="en-US" style="margin-left: 0.49in; text-indent: 0.49in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b>#	and</b></font></p>
<p lang="en-US" style="margin-left: 0.49in; text-indent: 0.49in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b>#	- parameter falseValue is absent or None</b></font></p>
<p lang="en-US" style="margin-left: 0.49in; text-indent: 0.49in; margin-bottom: 0in; line-height: 100%">
<br/>

</p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><font color="#984806"><b>class
Timer:</b></font></p>
<p lang="en-US" style="margin-left: 0.49in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b># Total elapsed timer</b></font></p>
<p lang="en-US" style="margin-left: 0.49in; margin-bottom: 0in; line-height: 100%">
<font color="#984806"><b>def __init__ (self):</b></font></p>
<p lang="en-US" style="margin-left: 0.98in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b># Resets the seconds value of timer to 0</b></font></p>
<p lang="en-US" style="margin-left: 0.49in; margin-bottom: 0in; line-height: 100%">
<font color="#984806"><b>def reset (self, condition):</b></font></p>
<p lang="en-US" style="margin-left: 0.98in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b># Resets the seconds value of timer to 0 if
condition is True</b></font></p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><br/>

</p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><font color="#984806"><b>class
Runner:</b></font></p>
<p lang="en-US" style="margin-left: 0.49in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b># Special singleton Marker allows freezing a
simulation  by halting the clock</b></font></p>
<p lang="en-US" style="margin-left: 0.49in; margin-bottom: 0in; line-height: 100%">
<font color="#984806"><b>def __init__ (self, condition = True):</b></font></p>
<p lang="en-US" style="margin-left: 0.98in; margin-bottom: 0in; line-height: 100%">
<font color="#00b050"><b># Sets the boolean value of the runner to
True</b></font></p>
<p lang="en-US" style="margin-bottom: 0in"><br/>

</p>
<h1 lang="en-US" class="western" style="page-break-before: always"><a name="_Toc508123212"></a>
The PLC programming paradigm</h1>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<p lang="en-US" style="margin-bottom: 0.14in">PLC software, whether
running on special hardware or on a PC, adheres to some very simple
rules that seem overly strict at first sight. However in practice it
has turned out that following these rules lead to stable, predictable
system behavior. So for one moment let's forget the richness of
modern programming languages and operating systems and delve into a
very different world: The world of real time control software.</p>
<p lang="en-US" style="margin-bottom: 0.14in">Central in each PLC
program is a loop that is executed forever. In a general purpose
programming language the code is something like:</p>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<p lang="en-US" style="margin-bottom: 0in"><font color="#984806"><b>while
True:</b></font></p>
<p style="margin-left: 0.49in; margin-bottom: 0in"><font color="#984806"><span lang="en-US"><b>readInputFromSensorsAndControls
()         </b></span></font><font color="#00b050"><span lang="en-US"><b>#
Controls can be switches, commands etc.</b></span></font></p>
<p lang="en-US" style="margin-left: 0.49in; margin-bottom: 0in"><font color="#984806"><b>calculateOutputFromInputAndPreviousState
()</b></font></p>
<p style="margin-left: 0.49in; margin-bottom: 0in"><font color="#984806"><span lang="en-US"><b>writeOutputToActuatorsAndIndicators
()</b></span></font><font color="#00b050"><span lang="en-US">   </span></font><font color="#00b050"><span lang="en-US"><b>#
Indic. can be lamps, meters, status reports etc.</b></span></font></p>
<p lang="en-US" style="margin-left: 0.49in; margin-bottom: 0in"><br/>

</p>
<p style="margin-bottom: 0.14in"><span lang="en-US">PLC's have their
own terminology. Going through the above loop once is called a </span><span lang="en-US"><b>sweep</b></span><span lang="en-US">.
The time it takes to perform one sweep is called the sweeptime. In
the simulator, the sweeptime is available in the variable
</span><font color="#984806"><span lang="en-US"><b>world.period</b></span></font><span lang="en-US">.
The sweeptime determines the reaction time of the PLC. It may range
from a few to a few dozen milliseconds.</span></p>
<ul>
	<li><p style="margin-bottom: 0.14in"><span lang="en-US">Within one
	sweep, at first all input from sensors, operator controls and
	external control systems is read. This is indicated by the function
	</span><font color="#984806"><span lang="en-US"><b>readInputFromSensorsAndControls
	()</b></span></font><span lang="en-US">. </span>
	</p>
	<li><p style="margin-bottom: 0.14in"><span lang="en-US">Next all
	output signals are computed from the inputs and from the previous
	control state. This is indicated by the function
	</span><font color="#984806"><span lang="en-US"><b>calculateOutputFromInputAndPreviousState
	()</b></span></font><span lang="en-US">.</span></p>
	<li><p style="margin-bottom: 0.14in"><span lang="en-US">Finally, in
	the function </span><font color="#984806"><span lang="en-US"><b>writeOutputToActuatorsAndIndicators
	()</b></span></font><span lang="en-US">, the outputs are transferred
	to the outside world, e.g. servo motors, electromagnets, indicator
	lamps to inform humans or signals and reports for external control
	systems.</span></p>
</ul>
<p lang="en-US" style="margin-bottom: 0.14in">After this, the whole
sequence starts all over again: the next sweep. In a real world PLC,
the sweeptime is guarded by a watch dog timer. If it exceeds a
maximum, the system is brought to a halt in a safe manner. 
</p>
<p style="margin-bottom: 0.14in"><span lang="en-US">What is crucial
to the way PLC programs operate, is that all inputs are read at the
start of every sweep. So what e.g. is bad style for a PLC program, is
to have a sensor report transient information. For instance as long
as the robot does not hit limit switch s1, this leads to a </span><span lang="en-US"><b>continuous</b></span><span lang="en-US">
input </span><font color="#984806"><span lang="en-US"><b>s1Enabled</b></span></font><span lang="en-US">
rather than having a brief spike </span><font color="#984806"><span lang="en-US"><b>s1Hit</b></span></font><span lang="en-US">
at the moment the robot hits the limit switch. The advantage is that
is case of sensor malfunction or software glitches, the system will
come to a halt, rather than run out of control.</span></p>
<p lang="en-US" style="margin-bottom: 0.14in">To get a better feeling
for the benefits of this approach, let's look for a moment at the oil
level indicator light in a car. The worst design is a lamp that only
briefly lights up if the car runs out of oil. The driver will almost
certainly miss this transient information. A little better is a lamp
that will remain burning as long as the oil level remains too low.
From the standpoint of system failure however, a green lamp that
burns as long as the oil level is ok, is preferable, for if the lamp
itself fails, the driver will halt the car, thereby avoiding the risk
of damaging the engine by lack of lubrication. Since a lamp switching
off draws less attention than a lamp switching on, a solution where a
green light indicates enough oil and a red or blinking light or no
light at all (lamp failure) indicates a problem, is probably the
optimum.</p>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<h1 lang="en-US" class="western" style="page-break-before: always"><a name="_Toc508123213"></a>
PLC programming rules</h1>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<p lang="en-US" style="margin-bottom: 0.14in">The first step in
programming safe controls is to follow a couple of rules. As said,
these rules seem very strict, even unworkable and draconic at first.
But let firsthand experience be your teacher here. Follow them
consequently in your designs and  it will quite soon become clear
what the benefits are. Here are the rules:</p>
<ol>
	<li><p style="margin-bottom: 0.14in"><span lang="en-US">No loops
	other than the main sweep. So no </span><font color="#984806"><span lang="en-US"><b>while</b></span></font><span lang="en-US">,
	</span><font color="#984806"><span lang="en-US"><b>for</b></span></font><span lang="en-US">,
	</span><font color="#984806"><span lang="en-US"><b>repeat</b></span></font><span lang="en-US">,
	</span><font color="#984806"><span lang="en-US"><b>goto</b></span></font><span lang="en-US">
	etc.</span></p>
	<li><p style="margin-bottom: 0.14in"><span lang="en-US">No
	conditional statements. So no </span><font color="#984806"><span lang="en-US"><b>if</b></span></font><span lang="en-US">,</span><span lang="en-US"><b>
	</b></span><font color="#984806"><span lang="en-US"><b>elif</b></span></font><span lang="en-US">,
	</span><font color="#984806"><span lang="en-US"><b>else</b></span></font><span lang="en-US">,
	</span><font color="#984806"><span lang="en-US"><b>switch</b></span></font><span lang="en-US">,
	</span><font color="#984806"><span lang="en-US"><b>case</b></span></font><span lang="en-US">
	etc.</span></p>
	<li><p lang="en-US" style="margin-bottom: 0.14in">No pause, delay,
	sleep or anything like that</p>
	<li><p lang="en-US" style="margin-bottom: 0.14in">Be brief and
	concise</p>
</ol>
<p lang="en-US" style="margin-bottom: 0.14in"><b>In short: No control
structures at all!</b></p>
<p lang="en-US" style="margin-bottom: 0.14in">How can anyone make any
real world computer program like this? Surely control structures have
not been a part of every mainstream language right from the advent of
computing for no purpose... All that you can do without them is
evaluate and assign expressions. How to control anything by doing
only that?</p>
<p style="margin-bottom: 0.14in"><span lang="en-US">Well, the answer
is that there certainly is a category of languages that lacks
imperative control structures, in fact it lacks imperative statements
at all. This category is the category of </span><span lang="en-US"><b>functional
languages</b></span><span lang="en-US">. Functional languages boil
down to stating functional dependencies between input and output.
Functional languages are generally considered to hold great promise
when it comes to system reliability. But they are also considered to
be strange beasts, only to be comprehended by mathematicians that
talk to their wives in formulae.</span></p>
<p lang="en-US" style="margin-bottom: 0.14in">It is the functional
programming paradigm that PLC controls borrow their reliability from.
The most reliable PLC control is a PLC control where the output of
one sweep is a mere function of its instantaneous input, not relying
on any state from previous  sweeps. This statelessness is what makes
functional programs reliable and easily testable.</p>
<p lang="en-US" style="margin-bottom: 0.14in">In practice, PLC
programs do retain state from previous sweeps in the form of
registers, latches and oneshots, to be discussed later. However, the
less state is retained, the more reliable the control, even when this
 means that some seemingly redundant computations are done over and
over again in every sweep.</p>
<p style="margin-bottom: 0.14in"><span lang="en-US">The golden bullet
of designing reliable control programs is to know when to retain
state and when not. This is a matter of common sense and experience.
The former boils down to a choice: get acquainted with the textbook
way of programming in any 3rd generation language (C, C++, Python,
C#, Java, JavaScript, Fortran, Basic, Pascal, Modula, Ada) using all
the bells and whistles that these ever growing languages offer. After
that, imagine yourself standing next to a 40 ton coal grab unloader,
swaying at full speed at four meter distance from your head,
controlled by a computer. And ask yourself: how much program
complexity do I dare to trust my life to. The latter, experience, is
what you hopefully will gain by building robot controls using the
simulator.</span></p>
<p lang="en-US" style="margin-bottom: 0.14in">The third point of the
PLC programming rules, be brief and concise, is probably the most
important one. One way to obtain reliable software is intervision.
Such intervision, called deskchecking or peer reviewing if software
is involved, relies on the observation that explaining something to
another person is a very good way to reach a thorough understanding
of it yourself. You and a colleague go through the program step by
step. Explain to your colleague what you have done and why, and
you'll discover your own mistakes. And maybe your colleague will
discover some too, but that's just a bonus.</p>
<p lang="en-US" style="margin-bottom: 0.14in">To be able to go
through a program in this way, it must not be too bulky. Reading
through ten pages of sourcecode and keeping track of the interactions
is doable. Reading through twohundred pages will make you lose track.
Encapsulation techniques like object oriented programming are one way
to tackle complexity. Another way is simplicity. PLC programs tend to
be simple, and, strange enough, they tend to be brief. This is
counterintuitive. Certainly being restricted to a small subset of
program structures will lead to lengthy sourcecode? In practice this
turns out not to be the case. Why this is so is the subject of the
next two paragraphs.</p>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<h1 lang="en-US" class="western" style="page-break-before: always"><a name="_Toc508123214"></a>
What is wrong with encapsulation and control structures?</h1>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<p lang="en-US" style="margin-bottom: 0.14in">What is wrong with
encapsulation and control structures? Well, nothing of course,
encapsulation is hiding local and volatile design decisions behind a
well defined stable interface. It is the cornerstone of object
oriented programming and is quite successful if applied at the right
occasions.</p>
<p lang="en-US" style="margin-bottom: 0.14in">PLC's use encapsulation
intensively. The &quot;electrical circuit&quot;-like elements that
make up a PLC program (timers, registers, latches, oneshots etc.) are
all instances of classes, hiding their internal complexity behind a
very simple and well defined interface.</p>
<p lang="en-US" style="margin-bottom: 0.14in">But this is system
software, which means: it is thoroughly tested part of the PLC
itself, not of the ever changing control programs you write for it.
So encapsulation does its work behind the scenes.</p>
<p style="margin-bottom: 0.14in"><span lang="en-US">Something similar
holds for control structures like loops (</span><font color="#984806"><span lang="en-US"><b>while</b></span></font><span lang="en-US">,
</span><font color="#984806"><span lang="en-US"><b>for</b></span></font><span lang="en-US">,
</span><font color="#984806"><span lang="en-US"><b>repeat</b></span></font><span lang="en-US">,
</span><font color="#984806"><span lang="en-US"><b>goto</b></span></font><span lang="en-US">)
and conditional statements (</span><font color="#984806"><span lang="en-US"><b>if</b></span></font><span lang="en-US">,</span><span lang="en-US"><b>
</b></span><font color="#984806"><span lang="en-US"><b>elif</b></span></font><span lang="en-US">,
</span><font color="#984806"><span lang="en-US"><b>else</b></span></font><span lang="en-US">,
</span><font color="#984806"><span lang="en-US"><b>switch</b></span></font><span lang="en-US">,
</span><font color="#984806"><span lang="en-US"><b>case</b></span></font><span lang="en-US">).
The whole PLC concept revolves around one central loop, the sweep.
And to facilitate efficient IO, even the dreaded multithreading and
interprocess communication are utilized by the PLC itself. And of
course the system software that is a fixed, non user programmable
part of any  PLC, uses conditional statements. But as said: this
complexity is restricted to exhaustively tested system software in
any real PLC (as opposed to a simulator for learning purposes).</span></p>
<p lang="en-US" style="margin-bottom: 0.14in">The control program
running on top of this system software should be simple, straight and
brief. Fortunately, switching from a typical object oriented
programming style to the straight and simple style that is the norm
for real time controls, lessens the amount of sourcecode. Program
size tends to shrink from hundreds of pages of sourcecode to tens of
pages. The fact that this is so, is not caused by any flaw of object
oriented programming, but by the rather unusual characteristics of
robot controls, as explained in the next paragraph.</p>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<h1 lang="en-US" class="western" style="page-break-before: always"><a name="_Toc508123215"></a>
But what makes controlling a robot system so different?</h1>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<p style="margin-bottom: 0.14in"><span lang="en-US">Good question!
Real time control programs </span><span lang="en-US"><b>are </b></span><span lang="en-US">different
from mainstream programming. In a nutshell, here's why. A robot
control generally has the following properties:</span></p>
<ol>
	<li><p lang="en-US" style="margin-bottom: 0.14in">The amount of
	sensor signals (inputs from the outside world) typically is four
	times the amount of actuator signals (outputs to motors, magnets,
	welding electrodes, paint sprayers etc.). So a control system e.g.
	needs input from forty sensors to control only ten actuators.</p>
	<li><p lang="en-US" style="margin-bottom: 0.14in">To determine any
	of the outputs, typically almost all sensor signals are needed,
	either directly or indirectly. Look at yourself as a robot. For even
	a routine task like determining when to put the fire low when
	roasting meat, you'll use sight, hearing, smell and tactile input.
	For automated control systems it turns out to be the same in
	practice.</p>
</ol>
<p lang="en-US" style="margin-bottom: 0.14in">Let's see what this
means for noble concepts like encapsulation on the application
(rather than internal PLC system) level. Since every output depends
upon tens or hundreds of inputs, the public interface of classes in
object oriented controls (or the parameter lists in function
structured controls) turns out to be excessively large.</p>
<p lang="en-US" style="margin-bottom: 0.14in">Another observation is
that while control program parts for e.g. the upper arm, the forearm
and the wrist of a robot control at first sight look similar, in
practice they differ in minute but essential ways. So at best they
can be modeled by related classes using inheritance. But the
differences are ad hoc and may change completely during the
productive life of the control system, if e.g. safety switches are
added or a new sequence of robot acts becomes necessary to
manufacture an altered or new product. There's a tendency for changes
like that to completely wreck even the most carefully designed
inheritance hierarchy.</p>
<p lang="en-US" style="margin-bottom: 0.14in">The only weapon here is
simplicity. Work straight towards the task at hand without additional
restrictions like stable interfaces, since they will make the program
grow manifold, to be prepared for an unknown future.</p>
<p lang="en-US" style="margin-bottom: 0.14in">At this point some
relativation and reservation is needed. Program design is striking
the right compromises. All the rules so forcefully advocated above
have exceptions. Pragmatism is to be preferred over dogmatism,
especially with control systems.  And there are control systems that
do not fit well with the rules stated above. Keep reading.</p>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<h1 lang="en-US" class="western" style="page-break-before: always"><a name="_Toc508123216"></a>
Control levels</h1>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<p lang="en-US" style="margin-bottom: 0.14in">In order to determine
what approach will work best, it's needed to be aware of the
following control hierarchy:</p>
<table width="619" cellpadding="7" cellspacing="0">
	<col width="142"/>

	<col width="143"/>

	<col width="290"/>

	<tr valign="top">
		<td width="142" style="border: 1px solid #000000; padding: 0in 0.08in"><p lang="en-US">
			4</p>
		</td>
		<td width="143" style="border: 1px solid #000000; padding: 0in 0.08in"><p lang="en-US">
			Logistic control level</p>
		</td>
		<td width="290" style="border: 1px solid #000000; padding: 0in 0.08in"><p lang="en-US">
			Planning sequences to achieve a final goal: Load all the boxes
			from the stockpile on the left upon the palette on the right.</p>
		</td>
	</tr>
	<tr valign="top">
		<td width="142" style="border: 1px solid #000000; padding: 0in 0.08in"><p lang="en-US">
			3</p>
		</td>
		<td width="143" style="border: 1px solid #000000; padding: 0in 0.08in"><p lang="en-US">
			Sequence control level</p>
		</td>
		<td width="290" style="border: 1px solid #000000; padding: 0in 0.08in"><p lang="en-US">
			Chaining atomary commands to achieve an intermediate goal. E.g.
			displacement: Grab that box and put it overthere.</p>
		</td>
	</tr>
	<tr valign="top">
		<td width="142" style="border: 1px solid #000000; padding: 0in 0.08in"><p lang="en-US">
			2</p>
		</td>
		<td width="143" style="border: 1px solid #000000; padding: 0in 0.08in"><p lang="en-US">
			Direct control level</p>
		</td>
		<td width="290" style="border: 1px solid #000000; padding: 0in 0.08in"><p lang="en-US">
			Execute atomary commands like: Grab that box. Or: Put it over
			there.</p>
		</td>
	</tr>
	<tr valign="top">
		<td width="142" style="border: 1px solid #000000; padding: 0in 0.08in"><p lang="en-US">
			1</p>
		</td>
		<td width="143" style="border: 1px solid #000000; padding: 0in 0.08in"><p lang="en-US">
			Hardwired locking level</p>
		</td>
		<td width="290" style="border: 1px solid #000000; padding: 0in 0.08in"><p lang="en-US">
			Maintain safety by means of hard wired negative (often tactile)
			sensors. No signal means: Stop .</p>
		</td>
	</tr>
	<tr valign="top">
		<td width="142" style="border: 1px solid #000000; padding: 0in 0.08in"><p lang="en-US">
			0</p>
		</td>
		<td width="143" style="border: 1px solid #000000; padding: 0in 0.08in"><p lang="en-US">
			Inherent safety level</p>
		</td>
		<td width="290" style="border: 1px solid #000000; padding: 0in 0.08in"><p lang="en-US">
			Physical prevention of accidents: Arm not long enough to reach
			operator. Concrete buffer at the end of the track.</p>
		</td>
	</tr>
</table>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<p lang="en-US" style="margin-bottom: 0.14in">It's the levels 2 and 3
that the PLC programming style treated in the previous paragraphs is
most suitable for. Level 4 is better tackled using mainstream object-
or data-oriented programming. Level 1 is the domain of special
purpose hard wired electrical circuits and a limited amount of simple
and robust sensors. Level 0 is the level where the quay turns the
ship.</p>
<p lang="en-US" style="margin-bottom: 0.14in">Apart from the above
hierarchy, there's a tendency for functionality to move from the
control itself into the sensors and actuators. High speed feedback
loops are part of the servo motors driving the robot's movements,
rather than of the central program. The same holds e.g. for numerical
integration of accelerometer data to obtain speed and position. As
far as these intelligent actuators and sensors are robust, the trend
towards decentralization is beneficial, since it replaces expensive
and vulnerable special purpose software by out-of-the-box components.
However it may be desirable for the central control to keep a
watchful eye on these intelligent components, since the central
control is the one able to combine all input information and draw
conclusions, e.g. about sensor failure.</p>
<p lang="en-US" style="margin-bottom: 0.14in">Keeping the possibility
of sensor failure in mind, it may seem like a good idea to have lots
of redundancy in the sensorical capabilities of the robot, but
there's a downside to this. If sensors differ of opinion, what should
the control do? Halt the system? But that often means halting
production. The more sensors are present, the more sensor failure
will occur. In some situations a minor chance on limited damage is to
be preferred over a robot that regularly blocks a whole production
line for no reason other than failure of a redundant sensor.</p>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<h1 lang="en-US" class="western" style="page-break-before: always"><a name="_Toc508123217"></a>
Putting a robot system into active operation</h1>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<p lang="en-US" style="margin-bottom: 0.14in">Imagine a production
line of a car manufacturer. The keyword here is: uptime. Every
unproductive quarter costs a car worth of money. So you carefully
design your control program and, even better, you test it in advance
by means of simulation, typically reducing the time to get the robot
up and running from weeks to hours. But still.</p>
<p lang="en-US" style="margin-bottom: 0.14in">Real world
circumstances differ from the information (requirements)  you got in
advance. The adjustment of the conveyor belt is more inexact than was
specified. Reflections and direct sunlight misguide your optical
sensors. Temperature changes of the environments lead to needless
emergency stops, as the control is fooled into thinking that the
welding transformer is overheated. And so on. It shouldn't be so, but
it is. Always.</p>
<p lang="en-US" style="margin-bottom: 0.14in">There are two ways of
dealing with this. One way is hiding behind hundred page contracts,
drawn up by your companies law department. Any differences from
specification? Tough luck for the customer. Claims won't apply, it's
all excluded by the legal guys. As an unfortunate side effect
however, there will be no more assignments from this customer. Tough
luck for your company. Because that's what industrial control
programming practice is like. Either live in the real, physical,
unpredictable, ever changing world in which your robot control has to
live, or don't.</p>
<p lang="en-US" style="margin-bottom: 0.14in">Fortunately most
companies are aware of the fact that customers are not merely a
nuisance. So their practical needs will have to be met. And those
needs include ad hoc change and minimal disruption of production.</p>
<p lang="en-US" style="margin-bottom: 0.14in">What this means for
robot control programs is the need for efficient debugging and
alteration. You will have to be able to experiment and repair on the
spot, under the real circumstances, interacting with real hardware
and other automated systems.</p>
<p lang="en-US" style="margin-bottom: 0.14in">To this end, every PLC
control allows for real time inspection and alteration of all control
objects (timers, latches, oneshots, registers etc.). Arbitrary values
can be input during active operation, all values can constantly be
monitored by the operator and, last but not least, values can be
forced permanently. This means that rather than acquiring an input
signal value from a sensor, or computing an intermediate value or
outputing a signal value to an actuator, these signals are coerced to
have a certain value. This makes rapid, real time, testing and
debugging feasible.</p>
<p lang="en-US" style="margin-bottom: 0.14in">That's  what all the
blinking lights and fluctuating numbers on a control rack are about,
not about trying to look like StarTrek, but to both know what's going
on and be able to influence it in real time.</p>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<h1 lang="en-US" class="western" style="page-break-before: always"><a name="_Toc508123218"></a>
The SimPyLC simulator</h1>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<p lang="en-US" style="margin-bottom: 0.14in">There are many PLC
simulators available for free. Most of them good looking and feature
rich. Why another simulator? The Sim in SimPyLC stands for
simulation, but it also stands for simple. SimPyLC is a simplified
version of its C++ counterpart SimPLC, written by the same author,
that has been  in use in the industry controlling installations
ranging from harbor cranes  to chemical production facilities for
over twenty years now. SimPyLC  is completely written in Python. What
this means is that there's so little sourcecode, that you can read
through every line of it, if you want. 
</p>
<p lang="en-US" style="margin-bottom: 0.14in">You can dissect it,
alter it to your needs and taste and understand every single line of
code. The amount of insight this will give cannot be matched be any
theoretical explanation of what such code should do. At first try to
write some simple controls using SimPyLC. Use the example code
(one-armed production robot) as tutorial material.</p>
<p lang="en-US" style="margin-bottom: 0.14in">Then go on with the
more complex assignments. And, if there's a need or an opportunity,
take a peek at the sourcecode of SimPyLC itself. So you'll know that
there's no magic involved. The goal is to gain the insight and
confidence that you could have written it yourself and that you
understand exactly how it behaves and why. This is how PLC's work.
And hopefully the assignments make clear why these simple and robust
control devices are ubiquitous in the world of industrial production
and logistics.</p>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<h1 lang="en-US" class="western" style="page-break-before: always"><a name="_Toc508123219"></a>
Example of an assignment linked to elementary physics</h1>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<p style="margin-bottom: 0.14in"><span lang="en-US">As a starting
point in learning to program real time controls, after you understand
the code of all simulation examples, you may try to optimize the
</span><span lang="en-US"><i>oneArmedRobot</i></span><span lang="en-US">
control. Especially the torso movement has a lot of overshoot. This
is because it is programmed without paying any attention to the
underlying physics.</span></p>
<p lang="en-US" style="margin-bottom: 0.14in">In general, movements
are governed by the following equations:</p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><font color="#000000"><font face="Courier New, serif"><font size="2" style="font-size: 10pt">s(t)
= s(0) + v(0) t + 1/2 a(0) t^2		[1]</font></font></font></p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><font color="#000000"><font face="Courier New, serif"><font size="2" style="font-size: 10pt">v(t)
= v(0) + a(0) t				[2]</font></font></font></p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><br/>

</p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><font color="#000000"><font face="Courier New, serif"><font size="2" style="font-size: 10pt">v(t)
= 0					[3]</font></font></font></p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><br/>

</p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><font color="#000000"><font face="Courier New, serif"><font size="2" style="font-size: 10pt">[2]
&amp; [3]	0 ==&gt; v(0) + a(0) t		[4]</font></font></font></p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><font color="#000000"><font face="Courier New, serif"><font size="2" style="font-size: 10pt">[4]	==&gt;	t
= - v(0) / a(0)		[5]</font></font></font></p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><br/>

</p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><font color="#000000"><font face="Courier New, serif"><font size="2" style="font-size: 10pt">s(t)
= 0					[6] </font></font></font>
</p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><br/>

</p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><font color="#000000"><font face="Courier New, serif"><font size="2" style="font-size: 10pt">[1]
&amp; [5] &amp; [6]	==&gt;</font></font></font></p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><font color="#000000"><font face="Courier New, serif"><font size="2" style="font-size: 10pt">0
= s(0) + v(0)(- v(0) / a(0) + 1/2 a(0) (v(0)^2 / a(0)^2)</font></font></font></p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><font color="#000000"><font face="Courier New, serif"><font size="2" style="font-size: 10pt">0
= s(0) - v(0)^2 / a(0) + 1/2 v(0)^2 / a(0)</font></font></font></p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><font color="#000000"><font face="Courier New, serif"><font size="2" style="font-size: 10pt">0
= s(0) + (- 1 + 1/2) v(0)^2 / a(0)</font></font></font></p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><font color="#000000"><font face="Courier New, serif"><font size="2" style="font-size: 10pt">0
= s(0) - 1/2 v(0)^2 / a(0)</font></font></font></p>
<p lang="en-US" style="margin-bottom: 0in; line-height: 100%"><font color="#000000"><font face="Courier New, serif"><font size="2" style="font-size: 10pt">s(0)
= 1/2 v(0)^2 / a(0)</font></font></font></p>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<p lang="en-US" style="margin-bottom: 0.14in">Where:</p>
<ul>
	<li><p style="margin-bottom: 0.14in"><font face="Courier New, serif"><span lang="en-US">t</span></font><span lang="en-US">
	is time</span></p>
	<li><p style="margin-bottom: 0.14in"><font face="Courier New, serif"><span lang="en-US">s</span></font><span lang="en-US">
	is position or angle</span></p>
	<li><p style="margin-bottom: 0.14in"><font face="Courier New, serif"><span lang="en-US">v</span></font><span lang="en-US">
	is velocity or angular velocity</span></p>
	<li><p style="margin-bottom: 0.14in"><font face="Courier New, serif"><span lang="en-US">a</span></font><span lang="en-US">
	is acceleration or angular acceleration</span></p>
</ul>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<p style="margin-bottom: 0.14in"><font face="Courier New, serif"><span lang="en-US">s(0)</span></font><span lang="en-US">
denotes the braking distance. A fast control will:</span></p>
<ul>
	<li><p lang="en-US" style="margin-bottom: 0.14in">Accelerate towards
	the target maximally if further away from the target than the
	braking distance.</p>
	<li><p lang="en-US" style="margin-bottom: 0.14in">Accelerate away
	from the target (decelerate towards the target) maximally if closer
	to the target than the braking distance</p>
</ul>
<p style="margin-bottom: 0.14in"><span lang="en-US">Try to implement
such a bang-bang control in the </span><span lang="en-US"><i>oneArmedRobot</i></span><span lang="en-US">
example. Although this boils down to changing just a few lines of
code, it is not as easy as it may seem. You'll have to pay good 
attention to direction. If you've done this properly, you'll find
that no visible overshoot remains and positioning becomes very fast.
This is the way e.g. gantry cranes are positioned. The bang-bang
effect is damped by the power electronics and inertness of the
mechanics in practice if the PLC sweeptime is short enough.</span></p>
<h1 lang="en-US" class="western" style="page-break-before: always"><a name="_Toc508123220"></a>
Code generation for the Arduino</h1>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<p lang="en-US" style="margin-bottom: 0.14in">To enable controlling
real hardware, C code generation for the Arduino processor board has
been added. This is a recent feature and has not yet been tested
thoroughly. Still, in an educational situation, it is an interesting
possibility. Code can be designed and tested using the simulator.
Once it's functioning well, it can be uploaded to the Arduino.</p>
<p style="margin-bottom: 0.14in"><span lang="en-US">Apart from the
code generated from your simulation modules,  you'll need some I/O
code, as can be seen in the file </span><span lang="en-US"><i>native.cpp</i></span><span lang="en-US">
that is part of e.g. the </span><span lang="en-US"><i>arduinoLed 
</i></span><span lang="en-US">example. As can be seen there, it
contains the basic C code that is part of every sketch, along with
I/O definition and handling. Also in the </span><span lang="en-US"><i>loop
()</i></span><span lang="en-US"> function, between input and output,
a call to the generated function </span><span lang="en-US"><i>cycle
()</i></span><span lang="en-US"> must be made. Anothor example of
such a </span><span lang="en-US"><i>native.cpp</i></span><span lang="en-US">
file can be found in the </span><span lang="en-US"><i>arduinoTrafficLights</i></span><span lang="en-US">
example.</span></p>
<p lang="en-US" style="margin-bottom: 0.14in">After having done all
this, add the modulenames for which one wants to generate code to the
command line.</p>
<p lang="en-US" style="margin-left: 0.49in; margin-bottom: 0.14in"><i>python
world.py robot</i></p>
<p lang="en-US" style="margin-bottom: 0.14in">If you want to generate
code for all modules, use:</p>
<p lang="en-US" style="margin-left: 0.49in; margin-bottom: 0.14in"><i>python
world.py *</i></p>
<p lang="en-US" style="margin-bottom: 0.14in">To avoid name clashes a
prefix can be added to all generated identifiers, e.g.</p>
<p lang="en-US" style="margin-left: 0.49in; margin-bottom: 0.14in"><i>python
world.py * prefix=PLC</i></p>
<p style="margin-bottom: 0.14in"><span lang="en-US">will prefix all
generated identifiers with </span><span lang="en-US"><i>PLC_</i></span><span lang="en-US">.
 Note that in the case of generating code for multiple modules,
module prefixes will be inserted as well. These should also be
present in </span><span lang="en-US"><i>native.cpp</i></span><span lang="en-US">.
Don't be intimidated by the seemingly complex prefix stuff. In most
cases generating code for only one module and using  no prefixes at
all will do fine. Just look at the generated code if you need to know
how prefixing works.</span></p>
<p style="margin-bottom: 0.14in"><span lang="en-US">In all cases the
name of the generated </span><span lang="en-US"><i>.ino</i></span><span lang="en-US">
file will be </span><span lang="en-US"><i>&lt;simulationDirectoryName&gt;.ino</i></span><span lang="en-US">.
To run the generated code on the Arduino, load this file into the
Arduino IDE and then upload it to your board.</span></p>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<h2 lang="en-US" class="western" style="page-break-before: always"><a name="_Toc508123221"></a>
The arduinoLed example</h2>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<p style="margin-bottom: 0.14in"><span lang="en-US">The </span><span lang="en-US"><i>arduinoLed</i></span><span lang="en-US">
example simulation operates the onboard Arduino light emitting 
diode. The </span><span lang="en-US"><i>native.cpp</i></span><span lang="en-US">
file in this case has the following contents:</span></p>
<p lang="en-US" style="margin-bottom: 0in"><font color="#632423"><b>void
setup () {</b></font></p>
<p lang="en-US" style="margin-left: 0.49in; margin-bottom: 0in"><font color="#632423"><b>pinMode
 (13, OUTPUT);</b></font></p>
<p lang="en-US" style="margin-bottom: 0in"><font color="#632423"><b>}</b></font></p>
<p lang="en-US" style="margin-bottom: 0in"><br/>

</p>
<p lang="en-US" style="margin-bottom: 0in"><font color="#632423"><b>void
loop () {</b></font></p>
<p lang="en-US" style="margin-left: 0.49in; margin-bottom: 0in"><font color="#632423"><b>cycle
();</b></font></p>
<p lang="en-US" style="margin-left: 0.49in; margin-bottom: 0in"><font color="#632423"><b>digitalWrite
 (13, led);  </b></font>
</p>
<p lang="en-US" style="margin-bottom: 0in"><font color="#632423"><b>}</b></font></p>
<p lang="en-US" style="margin-left: 1.48in; margin-bottom: 0in"><br/>

</p>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<h2 lang="en-US" class="western" style="page-break-before: always"><a name="_Toc508123222"></a>
The arduinoTraficLight example</h2>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<p style="margin-bottom: 0.14in"><font color="#000000"><span lang="en-US">The
</span></font><font color="#000000"><span lang="en-US"><i>arduinoTrafficLight</i></span></font><font color="#000000"><span lang="en-US">
example requires a bit more hardware, but not too much. The subject
is a four legged crossing with a red and a green light at each leg.
The hardware used was an Arduino Due, but should also run on an
Arduino Uno if PWM is used and the port addresses are adapted in
</span></font><font color="#000000"><span lang="en-US"><i>native.cpp.</i></span></font></p>
<p align="center" style="margin-bottom: 0.14in; page-break-after: avoid">
<img src="simpylc_howto_html_e7caeb63f4772e5b.jpg" name="Afbeelding 0" align="bottom" width="477" height="267" border="0"/>
</p>
<p align="center" style="margin-bottom: 0.14in; line-height: 100%"><font color="#4f81bd"><font size="2" style="font-size: 9pt"><b><span lang="en-US">Figure
</span><span style="background: #c0c0c0">1</span><span lang="en-US">.
Hardware used to test the traffic light example.</span></b></font></font></p>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<p lang="en-US" style="margin-bottom: 0.14in"><font color="#000000">The
traffic lights have four modes of operation:</font></p>
<ol>
	<li><p style="margin-bottom: 0in"><font color="#000000"><span lang="en-US"><i>regular
	</i></span></font><font color="#000000"><span lang="en-US"> - The
	north and south leg lights show the same color, as do the east and
	west legs. If the lights for a certain leg pair has been green for
	some time, they will start to blink to signal that they will turn
	red before long.</span></font></p>
</ol>
<p lang="en-US" style="margin-bottom: 0in"><br/>

</p>
<ol start="2">
	<li><p style="margin-bottom: 0in"><font color="#000000"><span lang="en-US"><i>cycle</i></span></font><font color="#000000"><span lang="en-US">
	- One leg at a time gets green light, rotating clockwise. Before
	turning red, the green light will blink for a while.</span></font></p>
</ol>
<p lang="en-US" style="margin-bottom: 0in"><br/>

</p>
<ol start="3">
	<li><p style="margin-bottom: 0in"><font color="#000000"><span lang="en-US"><i>night</i></span></font><font color="#000000"><span lang="en-US">
	- All red lights blink, all green lights are off.</span></font></p>
</ol>
<p lang="en-US" style="margin-bottom: 0in"><br/>

</p>
<ol start="4">
	<li><p style="margin-bottom: 0in"><font color="#000000"><span lang="en-US"><i>off</i></span></font><font color="#000000"><span lang="en-US">
	- All lights are switched of permanently.</span></font></p>
</ol>
<p lang="en-US" style="margin-bottom: 0in"><br/>

</p>
<p lang="en-US" style="margin-bottom: 0in"><font color="#000000">Switching
between modes happens by pressing a pushbutton. As an extra there's a
central lamp post (big yellow led) that can be dimmed or brightened
by pressing and holding another pushbutton. Each time the button is
released  a switch is made between dimming and brightening.</font></p>
<p lang="en-US" style="margin-bottom: 0in"><br/>

</p>
<p lang="en-US" style="margin-bottom: 0in"><br/>

</p>
<p style="margin-bottom: 0in"><font color="#000000"><span lang="en-US">Writing
non-trivial controls like the </span></font><font color="#000000"><span lang="en-US"><i>oneArmedRobot</i></span></font><font color="#000000"><span lang="en-US">
using SimPyLC is </span></font><font color="#000000"><span lang="en-US"><b>much</b></span></font><font color="#000000"><span lang="en-US">
simpler than programming the Arduino in C directly. The test
facilities of SimPyLC contribute a lot to this, as does the presence
of circuit element types like Oneshot and Timer.</span></font></p>
<p lang="en-US" style="margin-bottom: 0in"><br/>

</p>
<p lang="en-US" style="margin-bottom: 0in"><font color="#000000">After
e.g. writing and testing the traffic light control in the simulator,
it ran flawlessly in the Arduino at first attempt. This is typical
for the use of simulation, also for installations much more
complicated than a traffic light control. In fact the author of this
document has met cases where after months of commissioning, a control
was completely rewritten and debugged in the simulator without even a
look at the existing code, tested in a day and commissioned in one
hour and a half, no modification needed. A control is either open to
understanding or it isn't. In the latter case throwing it away and
starting with a fresh slate will save time and accidents.</font></p>
<p lang="en-US" style="margin-bottom: 0in"><br/>

</p>
<p style="margin-bottom: 0in"><font color="#000000"><span lang="en-US">Take
your time to really grab the PLC coding style as exemplified in
</span></font><font color="#000000"><span lang="en-US"><i>oneArmedRobot</i></span></font><font color="#000000"><span lang="en-US">,
using simulation and timing charts to debug your control even before
the hardware is available and you'll soon be writing complex controls
with a minimum of effort.</span></font></p>
<p lang="en-US" style="margin-bottom: 0in"><br/>

</p>
<p lang="en-US" style="margin-bottom: 0in"><br/>

</p>
<p align="center" style="margin-bottom: 0in; page-break-after: avoid">
<img src="simpylc_howto_html_3e10b5e6f3942502.png" name="Afbeelding 5" align="bottom" width="604" height="358" border="0"/>
</p>
<p align="center" style="margin-bottom: 0.14in; line-height: 100%"><font color="#4f81bd"><font size="2" style="font-size: 9pt"><b><span lang="en-US">Figure
</span><span style="background: #c0c0c0">2</span><span lang="en-US">.
Timing chart of the traffic light example in regular mode.</span></b></font></font></p>
<p align="center" style="margin-bottom: 0in; page-break-after: avoid">
<img src="simpylc_howto_html_a315e6036523d313.png" name="Afbeelding 1" align="bottom" width="562" height="666" border="0"/>
</p>
<p align="center" style="margin-bottom: 0.14in; line-height: 100%"><font color="#4f81bd"><font size="2" style="font-size: 9pt"><b><span lang="en-US">Figure
</span><span style="background: #c0c0c0">3</span><span lang="en-US">.
Control panel of the traffic light example.</span></b></font></font></p>
<p align="center" style="margin-bottom: 0.14in; page-break-after: avoid">
<img src="simpylc_howto_html_a4c17ad894312d4a.png" name="Image1" align="bottom" width="605" height="431" border="0"/>
</p>
<p align="center" style="margin-bottom: 0.14in; line-height: 100%"><font color="#4f81bd"><font size="2" style="font-size: 9pt"><b><span lang="en-US">Figure
</span><span style="background: #c0c0c0">4</span><span lang="en-US">.
Visualisation of the traffic light example.</span></b></font></font></p>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<h2 lang="en-US" class="western" style="page-break-before: always"><a name="_Toc508123223"></a>
The arduinoStove example</h2>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<p style="margin-bottom: 0.14in"><span lang="en-US">The </span><span lang="en-US"><i>arduinoStove</i></span><span lang="en-US">
example mimics an electric stove with four boiling plates, a cooking
alarm clock with buzzer and a child lock. A four digit numerical
display is used to indicate the temperature of the plates, the time
remaining before alarm and the status of the child lock. Also for
each plate a LED is present, its brightness increasing with
temperature.</span></p>
<p lang="en-US" style="margin-bottom: 0.14in">Once power is switched
on, use the plate select button to select a plate and then the up and
down buttons to adjust its temperature. The dot of the digit of the
selected plate lights up. Pressing the child lock button for more
than five seconds will lock c.q. unlock the child lock. If the child
lock is active, pressing any other button will generate an alarm,
resulting in a buzzer sounding with varying pitch. Pressing the alarm
select button allows for adjustment of the alarm time with the up and
down buttons. The longer these buttons are pressed, the more speedy
the adjustment changes.</p>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<p align="center" style="margin-bottom: 0.14in; page-break-after: avoid">
<img src="simpylc_howto_html_1c8dcbe47259e487.jpg" name="Afbeelding 4" align="bottom" width="390" height="245" border="0"/>
</p>
<p align="center" style="margin-bottom: 0.14in; line-height: 100%"><font color="#4f81bd"><font size="2" style="font-size: 9pt"><b><span lang="en-US">Figure
</span><span style="background: #c0c0c0">5</span><span lang="en-US">.
Hardware used to test the stove example.</span></b></font></font></p>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<p style="margin-bottom: 0.14in"><span lang="en-US">A visualisation
has been added. To make the simulation more interesting, the four
digit display is multiplexed. Since its multiplexing frequency
interferes with the window refresh rate, it will blink irregularly in
the simulator.  The buzzer is visualized by a flashlight. To properly
view its flashes in the simulation, lower its </span><span lang="en-US"><i>buzzerBaseFreq</i></span><span lang="en-US">
to e.g. 4 Hz.</span></p>
<p align="center" style="margin-bottom: 0.14in; page-break-after: avoid">
<img src="simpylc_howto_html_458e042be43a39b0.png" name="Afbeelding 7" align="bottom" width="403" height="278" border="0"/>
</p>
<p align="center" style="margin-bottom: 0.14in; line-height: 100%"><font color="#4f81bd"><font size="2" style="font-size: 9pt"><b><span lang="en-US">Figure
</span><span style="background: #c0c0c0">6</span><span lang="en-US">.
Visualisation of the stove example. Only one digit lights up in this
snapshot, since the digits are multiplexed.</span></b></font></font></p>
<p lang="en-US" style="margin-bottom: 0.14in">To make the whole thing
work with an Arduino One, you'll need two shift registers and a
couple of transistors. Since this example requires quite some
hardware and soldering, it is not the most obvious example to start
with. It has been added because it resembles an assignment that my
students have to work on.</p>
<p align="center" style="margin-bottom: 0.14in; page-break-after: avoid">
<img src="simpylc_howto_html_44599602cf64f1a1.png" name="Afbeelding 10" align="bottom" width="604" height="452" border="0"/>
</p>
<p align="center" style="margin-bottom: 0.14in; line-height: 100%"><font color="#4f81bd"><font size="2" style="font-size: 9pt"><b><span lang="en-US">Figure
</span><span style="background: #c0c0c0">7</span><span lang="en-US">.
Control panel of the stove example.</span></b></font></font></p>
<p align="center" style="margin-bottom: 0.14in; page-break-after: avoid">
<img src="simpylc_howto_html_51315a6b59676b06.png" name="Afbeelding 11" align="bottom" width="605" height="289" border="0"/>
</p>
<p align="center" style="margin-bottom: 0.14in; line-height: 100%"><font color="#4f81bd"><font size="2" style="font-size: 9pt"><b><span lang="en-US">Figure
</span><span style="background: #c0c0c0">8</span><span lang="en-US">.
Timing chart of the stove example.</span></b></font></font></p>
<p style="margin-bottom: 0in"><font color="#000000"><span lang="en-US">It
is interesting to take a good look at </span></font><font color="#000000"><span lang="en-US"><i>native.cpp
</i></span></font><font color="#000000"><span lang="en-US">in this
case, I/O being not completely trivial due to the multiplexed control
of the 7 segment digits.</span></font></p>
<p lang="en-US" style="margin-bottom: 0in"><br/>

</p>
<p style="margin-bottom: 0in"><font color="#000000"><span lang="en-US">In
general SimPyLC poses no restrictions to what can be done in the
</span></font><font color="#000000"><span lang="en-US"><i>native.cpp</i></span></font><font color="#000000"><span lang="en-US">
and in any additional C or C++ modules. However, the more simulation
is used, the more confident you can be that your software is OK
before letting it control any hardware.</span></font></p>
<p lang="en-US" style="margin-bottom: 0in"><br/>

</p>
<p lang="en-US" style="margin-bottom: 0in"><font color="#000000">While
with these toy examples getting the combination of hardware and
software to work by trial and error and mere stamina is no big deal,
when controlling multimillion dollar hardware in a situation where
every delay costs money, simulation has huge benefits. In the
stressful, densely populated late hours chaos of putting such systems
into active operation, I welcomed every indication that my software
was functioning correctly. Of course simulation was only part of the
equation. Because...</font></p>
<p lang="en-US" style="margin-bottom: 0in"><br/>

</p>
<p style="margin-bottom: 0.14in"><font color="#000000"><span lang="en-US"><b>The
simulator/code generator itself can </b></span></font><font color="#000000"><span lang="en-US"><u><b>and
will</b></u></span></font><font color="#000000"><span lang="en-US"><b>
contain errors. </b></span></font><font color="#000000"><span lang="en-US"><u><b>In
accordance with the license it can ONLY be used as an extra check, a
great timesaver, but by no means a primary vehicle to achieve safety
and security.</b></u></span></font><font color="#000000"><span lang="en-US"><b>
If everything seems to be OK in the simulation, the next thing to do
is desk checking, peer review, general intervision and systematic,
professional, safe factory and on-site  testing </b></span></font><font color="#000000"><span lang="en-US"><u><b>of
the final target code</b></u></span></font><font color="#000000"><span lang="en-US"><b>
that will in fact control the system. Safe in the case of software
malfunction that is. Maybe you'll catch 95%  of the errors using the
simulator, saving months. But you'll have to catch the remaining 5%
for sure before relying on your control in any way. After any change,
complete regression testing </b></span></font><font color="#000000"><span lang="en-US"><u><b>of
the final target code</b></u></span></font><font color="#000000"><span lang="en-US"><b>
is required.</b></span></font></p>
<p lang="en-US" style="margin-bottom: 0.14in"><font color="#7030a0"><font face="Comic Sans MS, serif"><font size="4" style="font-size: 14pt">A
short story. When a new fighter plane  got introduced in the
Netherlands, somewhere around the turn of the millennium, a test
pilot flew it to the southern hemisphere. As it passed the equator on
autopilot it suddenly turned upside down. The pilot took over on
manual control and no harm was done. Questions were asked to the
avionics software engineer, who looked up from his game console
somewhat disturbed since it was his lunch break: O, uh, yeah, tangent
is a periodical function, that's true, so something with a minus sign
I guess... He's now working in the game industry full time, where he
can do no harm.</font></font></font></p>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<h1 lang="en-US" class="western" style="page-break-before: always"><a name="_Toc508123224"></a>
Some timing hints and pitfalls</h1>
<h2 lang="en-US" class="western"><a name="_Toc508123225"></a>Integration
and differentiation</h2>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<p style="margin-bottom: 0.14in"><span lang="en-US">The sweeptime of
the simulator has a lower bound of ca 20 ms to avoid consuming all
processor resources on a multitasking PC that also has other jobs to
do. On the Arduino, the sweeptime will be much shorter. It may seem
attractive to insert a large </span><span lang="en-US"><i>delay</i></span><span lang="en-US">
into the </span><span lang="en-US"><i>loop</i></span><span lang="en-US">
of the Arduino to force a more or less constant sweeptime at a
varying processor load,  but this is NOT the right way to fix timing.
You'll kill the reaction time of your control without necessity.</span></p>
<p lang="en-US" style="margin-bottom: 0.14in">Also never integrate
anything by just adding a fixed quantity per sweep and do not
differentiate anything by just computing the difference over two
subsequent sweeps. In this way the behaviour of your control is would
not be realtime, but depend on the processor load.</p>
<p style="margin-bottom: 0.14in"> <span lang="en-US">Lastly, never
use a timer to obtain a fixed delta t over multiple sweeps. This will
make your control slow.  Use the varying sweeptime (</span><span lang="en-US"><i>world.period</i></span><span lang="en-US">)
as your delta t instead.</span></p>
<p lang="en-US" style="margin-bottom: 0.14in">So e.g.</p>
<p style="margin-bottom: 0.14in"><font color="#984806"><span lang="en-US"><b>accelleration.set
  (speed - oldSpeed) / world.period)		</b></span></font><font color="#00b050"><span lang="en-US"><b>#
Differentiation</b></span></font></p>
<p style="margin-bottom: 0.14in"><font color="#984806"><span lang="en-US"><b>location.set
(location + speed * world.period)			</b></span></font><font color="#00b050"><span lang="en-US"><b>#
Integration</b></span></font></p>
<p lang="en-US" style="margin-bottom: 0.14in"><font color="#984806"><b>oldSpeed.set
(speed)</b></font></p>
<p style="margin-bottom: 0.14in"><span lang="en-US">You may insert a
small </span><span lang="en-US"><i>delayMicroseconds</i></span><span lang="en-US">
in  the main loop in </span><span lang="en-US"><i>native.cpp</i></span><span lang="en-US">
 if the measured sweeptime becomes 0 incidentally, but in most cases
this is not necessary. Sweeptime measurement has an accuracy in the
order of magnitude of microseconds.</span></p>
<p style="margin-bottom: 0.14in"><font color="#000000"><span lang="en-US">Although
more  complicated integration and differentiation schemes may be
used, the ones above are accurate enough in many practical situations
and keep latency to a minimum.</span></font><span lang="en-US"> </span>
</p>
<p lang="en-US" style="margin-bottom: 0.14in">N.B. TIMERS WILL WRAP
AROUND IN 50 DAYS OR SO. SO RESET YOUR TIMERS EARLIER THAN THAT. IF
YOU NEED TO KEEP TRACK OF LONGER INTERVALS, E.G. RESET  THE TIMER
EACH DAY AND COUNT THE NUMBER OF DAYS</p>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<h2 lang="en-US" class="western"><a name="_Toc508123226"></a>Edge
triggering for buttons and timers</h2>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<p lang="en-US" style="margin-bottom: 0.14in">Whenever a pushbutton
is used to increment a counter, go to a next step etc., you have to
use a oneshot to avoid incrementing or stepping multiple times at
only one button press. Failing to recognize this is a common source
of problems. 
</p>
<p lang="en-US" style="margin-bottom: 0.14in">Less clear is the
necessity to use a oneshot if you want a timer to trigger certain
events. Suppose you want to  increment a counter every 3 seconds. The
simplest thing would be to use a timer, reset it to 0 after 3 seconds
and increment the counter whenever the timer is 0. On the simulator
this would work fine. However, SimPyLC timers running on the Arduino
have a resolution of 1 ms, which is more than the sweeptime. This
means that a timer can remain 0 for multiple sweeps, e.g.
incrementing your counter several times. Using a oneshot to edge
trigger on your counter becoming 0 will solve this problem.</p>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<h1 lang="en-US" class="western" style="page-break-before: always"><a name="_Toc508123227"></a>
Making a hierarchical visualistation</h1>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<h2 lang="en-US" class="western"><a name="_Toc508123228"></a>Principle</h2>
<p lang="en-US" style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<p lang="en-US" align="center" style="margin-bottom: 0in">--//--</p>
<p lang="en-US" style="margin-bottom: 0.08in; line-height: 100%"><br/>
<br/>

</p>
<p style="margin-bottom: 0.14in"><br/>
<br/>

</p>
<div title="footer"><p align="center" style="margin-top: 0.45in; margin-bottom: 0in; line-height: 100%">
	<span style="background: #c0c0c0"><sdfield type=PAGE subtype=RANDOM format=PAGE>33</sdfield></span></p>
	<p style="margin-bottom: 0in; line-height: 100%"><br/>

	</p>
</div>
</body>
</html>
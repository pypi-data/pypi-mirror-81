define(["@jupyter-widgets/base"],(function(e){return function(e){var t={};function i(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(s,r,function(t){return e[t]}.bind(null,r));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=5)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(6);t.MODULE_VERSION=s.version},function(t,i){t.exports=e},function(e,t,i){"use strict";var s,r=function(){return void 0===s&&(s=Boolean(window&&document&&document.all&&!window.atob)),s},a=function(){var e={};return function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}e[t]=i}return e[t]}}(),l=[];function o(e){for(var t=-1,i=0;i<l.length;i++)if(l[i].identifier===e){t=i;break}return t}function n(e,t){for(var i={},s=[],r=0;r<e.length;r++){var a=e[r],n=t.base?a[0]+t.base:a[0],c=i[n]||0,h="".concat(n," ").concat(c);i[n]=c+1;var d=o(h),_={css:a[1],media:a[2],sourceMap:a[3]};-1!==d?(l[d].references++,l[d].updater(_)):l.push({identifier:h,updater:g(_,t),references:1}),s.push(h)}return s}function c(e){var t=document.createElement("style"),s=e.attributes||{};if(void 0===s.nonce){var r=i.nc;r&&(s.nonce=r)}if(Object.keys(s).forEach((function(e){t.setAttribute(e,s[e])})),"function"==typeof e.insert)e.insert(t);else{var l=a(e.insert||"head");if(!l)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");l.appendChild(t)}return t}var h,d=(h=[],function(e,t){return h[e]=t,h.filter(Boolean).join("\n")});function _(e,t,i,s){var r=i?"":s.media?"@media ".concat(s.media," {").concat(s.css,"}"):s.css;if(e.styleSheet)e.styleSheet.cssText=d(t,r);else{var a=document.createTextNode(r),l=e.childNodes;l[t]&&e.removeChild(l[t]),l.length?e.insertBefore(a,l[t]):e.appendChild(a)}}function u(e,t,i){var s=i.css,r=i.media,a=i.sourceMap;if(r?e.setAttribute("media",r):e.removeAttribute("media"),a&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),e.styleSheet)e.styleSheet.cssText=s;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(s))}}var p=null,m=0;function g(e,t){var i,s,r;if(t.singleton){var a=m++;i=p||(p=c(t)),s=_.bind(null,i,a,!1),r=_.bind(null,i,a,!0)}else i=c(t),s=u.bind(null,i,t),r=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(i)};return s(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;s(e=t)}else r()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=r());var i=n(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var s=0;s<i.length;s++){var r=o(i[s]);l[r].references--}for(var a=n(e,t),c=0;c<i.length;c++){var h=o(i[c]);0===l[h].references&&(l[h].updater(),l.splice(h,1))}i=a}}}},function(e,t,i){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i=function(e,t){var i=e[1]||"",s=e[3];if(!s)return i;if(t&&"function"==typeof btoa){var r=(l=s,o=btoa(unescape(encodeURIComponent(JSON.stringify(l)))),n="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(o),"/*# ".concat(n," */")),a=s.sources.map((function(e){return"/*# sourceURL=".concat(s.sourceRoot||"").concat(e," */")}));return[i].concat(a).concat([r]).join("\n")}var l,o,n;return[i].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(i,"}"):i})).join("")},t.i=function(e,i,s){"string"==typeof e&&(e=[[null,e,""]]);var r={};if(s)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(r[l]=!0)}for(var o=0;o<e.length;o++){var n=[].concat(e[o]);s&&r[n[0]]||(i&&(n[2]?n[2]="".concat(i," and ").concat(n[2]):n[2]=i),t.push(n))}},t}},function(e,t,i){var s=i(2),r=i(13);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);var a={insert:"head",singleton:!1};s(r,a);e.exports=r.locals||{}},function(e,t,i){"use strict";function s(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),s(i(0)),s(i(7))},function(e){e.exports=JSON.parse('{"name":"ipyregulartable","version":"0.1.0","description":"A Custom Jupyter Widget Library","keywords":["jupyter","jupyterlab","jupyterlab-extension","widgets"],"files":["lib/**/*.js","dist/*.js","css/*.css"],"homepage":"https://github.com/timkpaine/ipyregulartable","bugs":{"url":"https://github.com/timkpaine/ipyregulartable/issues"},"license":"Apache-2.0","author":{"name":"Tim Paine","email":"t.paine154@gmail.com"},"main":"lib/index.js","types":"./lib/index.d.ts","repository":{"type":"git","url":"https://github.com/timkpaine/ipyregulartable"},"scripts":{"build":"npm run build:lib && npm run build:nbextension && npm run build:labextension","build:labextension":"npm run clean:labextension && mkdirp ../ipyregulartable/labextension && cd ../ipyregulartable/labextension && npm pack ../../js","build:lib":"tsc","build:nbextension":"webpack -p","build:all":"npm run build:labextension && npm run build:nbextension","clean":"npm run clean:lib && npm run clean:nbextension","clean:lib":"rimraf lib","clean:labextension":"rimraf ../ipyregulartable/labextension","clean:nbextension":"rimraf ../ipyregulartable/nbextension/static/index.js","fix":"eslint -c .eslintrc.js --ext .ts --fix src/ tests/","lint":"eslint -c .eslintrc.js --ext .ts src/ tests/","prepack":"npm run build:lib","test":"jest --coverage --collectCoverageFrom=src/*.{ts}","watch":"npm-run-all -p watch:*","watch:lib":"tsc -w","watch:nbextension":"webpack --watch"},"dependencies":{"@jupyter-widgets/base":"^3.0.0","regular-table":"^0.1.5"},"devDependencies":{"@babel/preset-env":"^7.8.6","@lumino/application":"^1.6.0","@lumino/widgets":"^1.6.0","@types/expect.js":"^0.3.29","@types/jest":"^26.0.14","@types/mocha":"^5.2.5","@types/node":"^13.7.7","@types/webpack-env":"^1.13.6","@typescript-eslint/eslint-plugin":"^2.33.0","@typescript-eslint/eslint-plugin-tslint":"^2.33.0","@typescript-eslint/parser":"^2.33.0","acorn":"^6.4.1","babel-jest":"^25.1.0","css-loader":"^3.2.0","eslint":"^7.0.0","eslint-plugin-import":"^2.20.2","eslint-plugin-jsdoc":"^25.4.2","eslint-plugin-prefer-arrow":"^1.2.1","eslint-plugin-unicorn":"^20.0.0","expect.js":"^0.3.1","fs-extra":"^7.0.0","isomorphic-fetch":"^2.2.1","jest":"^25.1.0","jest-transform-css":"^2.0.0","karma":"^3.0.0","karma-chrome-launcher":"^2.2.0","karma-firefox-launcher":"^1.1.0","karma-ie-launcher":"^1.0.0","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.5","karma-typescript":"^3.0.13","mkdirp":"^0.5.1","mocha":"^5.2.0","npm-run-all":"^4.1.3","rimraf":"^2.6.2","source-map-loader":"^0.2.4","style-loader":"^1.0.0","ts-jest":"^25.2.1","ts-loader":"^5.2.1","tslint":"^6.0.0","typescript":"~3.7.0","webpack":"^4.20.2","webpack-cli":"^3.1.2"},"resolutions":{"acorn":"^6.4.1","kind-of":"^6.0.3","minimist":"^0.2.1"},"jupyterlab":{"extension":"lib/plugin"}}')},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i(8);t.RegularTableModel=s.RegularTableModel;var r=i(9);t.RegularTableView=r.RegularTableView,i(4)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(1),r=i(0);class a extends s.DOMWidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:a.modelName,_model_module:a.modelModule,_model_module_version:a.modelModuleVersion,_view_name:a.viewName,_view_module:a.viewModule,_view_module_version:a.viewModuleVersion,height:200,_data:{},_editable:!1})}}t.RegularTableModel=a,a.serializers=Object.assign({},s.DOMWidgetModel.serializers),a.modelName="RegularTableModel",a.modelModule="ipyregulartable",a.modelModuleVersion=r.MODULE_VERSION,a.viewName="RegularTableView",a.viewModule="ipyregulartable",a.viewModuleVersion=r.MODULE_VERSION},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(1);i(10),i(11),i(4);class r extends s.DOMWidgetView{constructor(){super(...arguments),this.resolve=void 0,this.reject=void 0}render(){this.model.on("msg:custom",this._handle_msg,this),this.el.classList.add("ipyregulartable"),this.el.style.height=this.model.get("height")+"px",this.model.on("change:height",this._handle_height,this),this.model.on("change:_editable",this._handle_editable,this),this.displayed.then(()=>{this._render(),this.table.draw()})}_handle_data(){void 0!==this.resolve&&this.model.get("_data")?(this.resolve(this.model.get("_data")),this.resolve=void 0,this.reject=void 0):(this.reject(),this.resolve=void 0,this.reject=void 0)}_handle_editable(){void 0!==this.isEditable&&this.isEditable(this.model.get("_editable"))}_handle_height(){this.el.style.height=this.model.get("height")+"px"}_handle_msg(e){"draw"===e.type?this._handle_draw():"data"===e.type&&this._handle_data()}_handle_draw(){this.table.draw()}_render(){this.table=document.createElement("regular-table"),this.el.appendChild(this.table),this.table.setDataListener((e,t,i,s)=>new Promise((r,a)=>{void 0!==this.resolve&&(this.reject(),this.resolve=void 0,this.reject=void 0),this.resolve=r,this.reject=a,this.send({event:"getDataSlice",value:[e,t,i,s]})})),this.table.addEventListener("click",e=>{const t=this.table.getMeta(e.target);t&&this.send({event:"click",value:[t.x,t.y]})}),this.table.addEventListener("click",e=>{const t=this.table.getMeta(e.target);if(t)return new Promise(i=>{this.send({event:"getEditable",value:[t.x,t.y]}),this.isEditable=(t=e.target)=>{!0===this.model.get("_editable")&&t.setAttribute("contenteditable","true"),i()}})})}}t.RegularTableView=r},function(e,t){const i=new WeakMap,s=navigator.userAgent.toLowerCase().indexOf("firefox")>-1?5e6:1e7;function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function a(e,t,i,s,r){var a={};return Object.keys(s).forEach((function(e){a[e]=s[e]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=i.slice().reverse().reduce((function(i,s){return s(e,t,i)||i}),a),r&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(r):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}class l{constructor(e,t,i){this._column_sizes=e,this._container=t,this.table=i,this.cells=[],this.rows=[]}num_rows(){return this.cells.length}_set_metadata(e,t){i.set(e,t)}_get_or_create_metadata(e){if(void 0===e)return{};if(i.has(e))return i.get(e);{const t={};return i.set(e,t),t}}_replace_cell(e,t,i){const{tr:s,row_container:r}=this._get_row(t);let a=r[i];return a&&(s.removeChild(a),r.splice(i,1,void 0)),a}_fetch_cell(e,t){if(e<0||t<0)return;const{row_container:i}=this._get_row(e);return i[t]}_get_cell(e="TD",t,i){const{tr:s,row_container:r}=this._get_row(t);let a=r[i];if(a||(i<r.length?(a=r[i]=document.createElement(e),s.insertBefore(a,r.slice(i+1).find(e=>e))):(a=r[i]=document.createElement(e),s.appendChild(a))),a.tagName!==e){const r=document.createElement(e);s.replaceChild(r,a),this.cells[t].splice(i,1,r),a=r}return a}_get_row(e){let t=this.rows[e];t||(t=this.rows[e]=document.createElement("tr"),this.table.appendChild(t));let i=this.cells[e];return i||(i=this.cells[e]=[]),{tr:t,row_container:i}}_clean_columns(e){for(let t=0;t<this.rows.length;t++){const i=this.rows[t],s=this.cells[t];this.cells[t]=s.slice(0,e[t]||e);const r=this.cells[t].filter(e=>void 0!==e).length;for(;i.children[r];)i.removeChild(i.children[r])}}_clean_rows(e){for(;this.table.children[e];)this.table.removeChild(this.table.children[e]);this.rows=this.rows.slice(0,e),this.cells=this.cells.slice(0,e)}}let o=0,n=0,c=performance.now();const h=(e,...t)=>e.map((e,i)=>[e,t[i]]).flat().filter(e=>!!e).join("");function d(e,t,i){const s=Symbol("private lock"),r=i.value;return i.value=async function(...e){if(this[s]&&(await this[s],this[s]))return void await this[s];let t;this[s]=(()=>{let e;const t=new Promise(t=>{e=t});return t.resolve=e,t})();try{t=await r.call(this,...e)}catch(e){console.error(e)}finally{const e=this[s];return this[s]=void 0,e.resolve(),t}},i}class _ extends l{constructor(...e){super(...e),r(this,"_group_header_cache",[]),r(this,"_offset_cache",[])}_draw_group_th(e,t,i){const s=this._get_cell("TH",t,e[t]);return e[t]+=1,s.className="",s.removeAttribute("colspan"),s.style.minWidth="0",s.innerHTML=h` ${i} <span class="pd-column-resize"></span> `,s}_draw_group(e,t,i){const s=this._get_or_create_metadata(i);return s.column_header=e,s.value=t,s.value=t,i.className="",s}_draw_th(e,t,i,s,r){const a=this._get_or_create_metadata(i);if(a.column_header=e,a.value=t,a.size_key=r.length?r[0]:r,!(r.length>1)){const e=this._column_sizes.override[a.size_key],t=this._column_sizes.auto[a.size_key];e?(i.classList.toggle("pd-cell-clip",t>e),i.style.minWidth=e+"px",i.style.maxWidth=e+"px"):t?(i.classList.remove("pd-cell-clip"),i.style.maxWidth="",i.style.minWidth=t+"px"):(i.style.maxWidth="",i.style.maxWidth="")}return a}get_column_header(e){return this._get_cell("TH",this.rows.length-1,e)}draw(e,t,i,s,r,a,l){const o=null==t?void 0:t.length;if(0===o)return{};let n,c,h;for(let p=0;p<o;p++){if(h=t[p]?t[p]:"",this._offset_cache[p]=this._offset_cache[p]||0,p<o-1){var d,_,u;(null===(d=this._group_header_cache)||void 0===d||null===(_=d[p])||void 0===_||null===(u=_[0])||void 0===u?void 0:u.value)===h?(n=this._group_header_cache[p][1],this._group_header_cache[p][2]+=1,1===i&&(this._group_header_cache[p][0].row_header_x=r),n.setAttribute("colspan",this._group_header_cache[p][2])):(n=this._draw_group_th(this._offset_cache,p,h),c=this._draw_group(t,h,n),this._group_header_cache[p]=[c,n,1])}else{n=this._draw_group_th(this._offset_cache,p,h),c=this._draw_th(e||t,h,n,s,r);for(const[e]of this._group_header_cache)e.size_key=c.size_key;n.removeAttribute("colspan"),n.dataset.sizeKey=c.size_key}c&&(c.x=s,c.column_header_y=p,c.x0=a,c._virtual_x=l,1===i&&(c.row_header_x=r))}return this._clean_rows(this._offset_cache.length),{th:n,metadata:c}}clean(){this._clean_columns(this._offset_cache),this._offset_cache=[],this._group_header_cache=[]}}class u extends l{_draw_td(e,t,i,s,{column_name:r},{ridx_offset:a},l){const o=this._get_cell(e,t,s),n=this._get_or_create_metadata(o);n.y=t+a,n.size_key=l,"TD"===e&&(n.column_header=r);const c=this._column_sizes.override[n.size_key];if(c){const e=this._column_sizes.auto[n.size_key];o.classList.toggle("pd-cell-clip",e>c),o.style.minWidth=c+"px",o.style.maxWidth=c+"px"}else o.classList.remove("pd-cell-clip"),o.style.minWidth="",o.style.maxWidth="";return i instanceof HTMLElement?(o.textContent="",o.appendChild(i)):o.textContent=i,n.value=i,{td:o,metadata:n}}draw(e,t,i,s=!1,r,a,l,o){const{cidx:n,column_data:c,row_headers:h}=t;let d,{row_height:_}=i;const u=[],p=[];let m=0;const g=[];for(let f=0;f<(s?i.row_headers_length:1);f++){m=0;for(const v of c){var b;const c=null==h?void 0:h[m];let w;if(s){const e=v[f],s=this._fetch_cell(m-(u[f]||1),n+f),r=this._get_or_create_metadata(s),l=this._fetch_cell(m,n+f-(g[m]||1)),o=this._get_or_create_metadata(l);!l||o.value!==e&&void 0!==e||l.hasAttribute("rowspan")?s&&r.value===e&&!s.hasAttribute("colspan")?(u[f]=u[f]?u[f]+1:2,s.setAttribute("rowspan",u[f]),this._replace_cell(void 0,m,n+f)):(w=this._draw_td("TH",m,e,n+f,t,i,f),w.td.style.display="",w.td.removeAttribute("rowspan"),w.td.removeAttribute("colspan"),w.metadata.row_header=v,w.metadata.row_header_x=f,w.metadata.x0=a,w.metadata.y0=i.ridx_offset,w.metadata.y1=i.y1,w.metadata._virtual_x=f,u[f]=1,g[m]=1,p[f]=w):(g[m]=g[m]?g[m]+1:2,l.setAttribute("colspan",g[m]),this._replace_cell(void 0,m,n+f)),m++}else w=this._draw_td("TD",m++,v,n,t,i,l),w.metadata.x=r,w.metadata.x0=a,w.metadata.x1=i.x1,w.metadata.row_header=c||{test:2},w.metadata.y0=i.ridx_offset,w.metadata.y1=i.y1,w.metadata.dx=r-a,w.metadata.dy=w.metadata.y-w.metadata.y0,w.metadata._virtual_x=o,p[0]=w;if(d=w?w.metadata:d,_=_||(null===(b=w)||void 0===b?void 0:b.td.offsetHeight),m*_>e)break}}return this._clean_rows(m),{tds:p,ridx:m,metadata:d,row_height:_}}clean({ridx:e,cidx:t}){this._clean_rows(e),this._clean_columns(t)}}class p{constructor(e,t,i){this.clear(i);const[s]=i.children,[r,a]=s.children;this.table=s,this._column_sizes=t,this.header=new _(t,e,r),this.body=new u(t,e,a),this.fragment=document.createDocumentFragment()}num_columns(){var e;return this.header._get_row(Math.max(0,(null===(e=this.header.rows)||void 0===e?void 0:e.length)-1||0)).row_container.length}clear(e){e.innerHTML=h` <table cellspacing="0"> <thead></thead> <tbody></tbody> </table> `}autosize_cells(e){for(;e.length>0;){const[t,i]=e.pop();let s;const r=getComputedStyle(t);"border-box"!==r.boxSizing?(s=t.clientWidth,s-=parseFloat(r.paddingLeft),s-=parseFloat(r.paddingRight)):s=t.offsetWidth,this._column_sizes.row_height=this._column_sizes.row_height||t.offsetHeight,this._column_sizes.indices[i.size_key]=s;const a=this._column_sizes.override.hasOwnProperty(i.size_key);s&&!a&&(this._column_sizes.auto[i.size_key]=s),"0px"===t.style.minWidth&&(t.style.minWidth=s+"px")}}async draw(e,t,i,s,r,a){var l,o,n,c;const{width:h,height:d}=e,{view:_,config:u}=t;let{data:p,row_headers:m,column_headers:g}=await _(r.start_col,r.start_row,r.end_col,r.end_row);const{start_row:b=0,start_col:f=0,end_col:v=0,end_row:w=0}=r;m&&(this._row_headers_length=m.reduce((e,t)=>Math.max(e,t.length),0),m=m.map(e=>(e.length=this._row_headers_length,e))),t.config.column_pivots=Array.from(Array((null==g||null===(l=g[0])||void 0===l?void 0:l.length)-1||0).keys()),t.config.row_pivots=Array.from(Array((null===(o=m)||void 0===o||null===(n=o[0])||void 0===n?void 0:n.length)||0).keys());const y={viewport_width:0,selected_id:i,ridx_offset:b,x0:f,x1:v,y1:w,row_height:this._column_sizes.row_height,row_headers_length:this._row_headers_length};let x,z=0,k=[],M=!0;if((null===(c=m)||void 0===c?void 0:c.length)>0){const e=u.row_pivots.join(","),i={column_name:e,cidx:0,column_data:m,row_headers:m,first_col:M},r=z+f;x=this.body.draw(d,i,{...y,x0:0},!0,void 0,void 0,r,z);const a=[];for(let i=0;i<t.config.row_pivots.length;i++)a.push(this.header.draw(e,Array(t.config.column_pivots.length+1).fill(""),1,void 0,i,f,i));if(M=!1,y.viewport_width+=a.reduce((e,{th:t},i)=>e+(this._column_sizes.indices[i]||t.offsetWidth),0),y.row_height=y.row_height||x.row_height,z=m[0].length,!s)for(let e=0;e<t.config.row_pivots.length;e++){const{td:t,metadata:i}=x.tds[e]||{},{th:s,metadata:r}=a[e];k.push([s||t,r||i])}}try{let e=0;const t=a-r.start_col;for(;e<t;){if(!p[e]){let t=Math.max(r.end_col,0);r.start_col=t,r.end_col=t+1;const i=await _(r.start_col,r.start_row,r.end_col,r.end_row);var j;p[e]=i.data[0],g&&(g[e]=null===(j=i.column_headers)||void 0===j?void 0:j[0])}const t=(null==g?void 0:g[e])||"",i={column_name:t,cidx:z,column_data:p[e],row_headers:m,first_col:M},a=e+f,l=z+f,o=this.header.draw(void 0,t,void 0,a,l,f,z);if(x=this.body.draw(d,i,y,!1,a,f,l,z),M=!1,y.viewport_width+=this._column_sizes.indices[z+f]||x.tds.reduce((e,t)=>{var i;return e+(null===(i=t.td)||void 0===i?void 0:i.offsetWidth)},0)||o.th.offsetWidth,y.row_height=y.row_height||x.row_height,z++,e++,!s)for(const{td:e,metadata:t}of x.tds)k.push([o.th||e,o.metadata||t]);if(y.viewport_width>h)break}return k}finally{var L;this.body.clean({ridx:(null===(L=x)||void 0===L?void 0:L.ridx)||0,cidx:z}),this.header.clean()}}}var m;function g(){return Reflect.construct(HTMLElement,[],this.__proto__.constructor)}Object.setPrototypeOf(g.prototype,HTMLElement.prototype),Object.setPrototypeOf(g,HTMLElement);let b=(a((m=class extends g{create_shadow_dom(){this.attachShadow({mode:"open"});const e="<slot></slot>";this.shadowRoot.innerHTML=h` <style> ${":host{bottom:0;overflow:scroll}:host,div.pd-virtual-panel{position:absolute;top:0;left:0;right:0}div.pd-virtual-panel{pointer-events:none}div.pd-scroll-table-clip{position:sticky;top:0;left:0;width:100%;height:100%}div.pd-tree-container{display:flex;align-items:center;height:100%}slot{position:absolute;overflow:hidden}"} </style> <div class="pd-virtual-panel"> ${this._virtual_scrolling_disabled?e:""} </div> <div class="pd-scroll-table-clip"> ${this._virtual_scrolling_disabled?"":e} </div> `;const t=document.createElement("div");t.setAttribute("tabindex","0");const[,i,s]=this.shadowRoot.children;this._sticky_container=t,this._table_clip=s;const r=document.createElement("div");r.setAttribute("style","position:absolute;z-index:-1;opacity:0;pointer-event:none;"),this.appendChild(r),this._table_staging=r,this._virtual_panel=i}_calculate_viewport(e,t,i){const{start_row:s,end_row:r}=this._calculate_row_range(e,i),{start_col:a,end_col:l}=this._calculate_column_range(t);return this._nrows=e,{start_col:a,end_col:l,start_row:s,end_row:r}}_calculate_row_range(e,t){const{height:i}=this._container_size,s=this._column_sizes.row_height||19,r=this._view_cache.config.column_pivots.length+1,a=Math.max(1,this._virtual_panel.offsetHeight-this.clientHeight),l=this.scrollTop/a,o=i/s,n=t?e:this._nrows||0,c=Math.max(0,n+(r-o));let h=Math.ceil(c*l);return{start_row:h,end_row:Math.min(Math.ceil(h+o),e)}}_calculate_column_range(e){const t=Math.max(1,this._virtual_panel.offsetWidth-this._container_size.width),i=this.scrollLeft/t,s=this._max_scroll_column(e)+.5;let r=Math.floor(s*i);return{start_col:r,end_col:r+(this.table_model.num_columns()||Math.min(e,Math.ceil(this._container_size.width/60)))+1}}_max_scroll_column(e){let t=0;if(this._view_cache.config.row_pivots.length>0)for(const e of this._column_sizes.indices.slice(0,this._view_cache.config.row_pivots.length))t+=e;let i=e;for(;t<this._container_size.width&&i>=0;)i--,t+=this._column_sizes.indices[i]||60;return Math.min(e-1,i+1)}_validate_viewport({start_col:e,end_col:t,start_row:i,end_row:s}){const r=this._start_col!==e,a=this._start_row!==i||this._end_row!==s||this._end_col!==t;return this._start_col=e,this._end_col=t,this._start_row=i,this._end_row=s,{invalid_column:r,invalid_row:a}}_swap_in(e){this.dispatchEvent(new CustomEvent("regular-table-before-update",{bubbles:!0,detail:this})),this._virtual_scrolling_disabled||(e?(this._sticky_container===this.table_model.table.parentElement&&this._sticky_container.replaceChild(this.table_model.table.cloneNode(!0),this.table_model.table),this._table_staging.appendChild(this.table_model.table)):this._sticky_container!==this.table_model.table.parentElement&&this._sticky_container.replaceChild(this.table_model.table,this._sticky_container.children[0]))}async _swap_out(e){!this._virtual_scrolling_disabled&&e&&this._sticky_container.replaceChild(this.table_model.table,this._sticky_container.children[0]);for(const e of this._style_callbacks.values())await e({detail:this})}_update_virtual_panel_width(e,t){if(e)if(this._virtual_scrolling_disabled)this._virtual_panel.style.width=this._column_sizes.indices.reduce((e,t)=>e+t,0)+"px";else{const e=Math.max(1,this._virtual_panel.offsetWidth-this._container_size.width),i=this.scrollLeft/e,s=this._max_scroll_column(t);let r=0,a=0;for(;r<s;)a+=this._column_sizes.indices[r]||60,r++;const l=this._container_size.width+a;this._virtual_panel.style.width=l+"px",this.scrollLeft=i*a}}_update_virtual_panel_height(e){const{row_height:t=19}=this._column_sizes,i=this.table_model.header.cells.length*t;let r;if(this._virtual_scrolling_disabled)r=e*t+i;else{const a=this.clientHeight/(this._table_clip.offsetHeight-i);r=Math.min(s,e*t*a)}this._virtual_panel.style.height=r+"px"}async draw(e={}){const{reset_scroll_position:t=!1,preserve_width:i=!1,invalid_viewport:s=!0,swap:r=!1}=e;t&&this.reset_scroll(),this._invalid_schema=r||this._invalid_schema;const{num_columns:a,num_rows:l}=await this._view_cache.view(0,0,0,0);this._virtual_scrolling_disabled?this._container_size={width:1/0,height:1/0}:(this._invalid_schema||s)&&(this._container_size={width:this._table_clip.clientWidth,height:this._table_clip.clientHeight});const o=this._calculate_viewport(l,a,t),{invalid_row:n,invalid_column:c}=this._validate_viewport(o);if(this._update_virtual_panel_height(l),this._invalid_schema||n||c||s){this._swap_in(r);const e=await this.table_model.draw(this._container_size,this._view_cache,this._selected_id,i,o,a);await this._swap_out(r),this.table_model.autosize_cells(e),i||this._update_virtual_panel_width(this._invalid_schema||c||s,a),this._invalid_schema=!1}}}).prototype,"draw",[d],Object.getOwnPropertyDescriptor(m.prototype,"draw"),m.prototype),m);var f;let v=(a((f=class extends b{register_listeners(){this.addEventListener("mousedown",this._on_click.bind(this)),this.addEventListener("dblclick",this._on_dblclick.bind(this)),this.addEventListener("scroll",this._on_scroll.bind(this),{passive:!1}),this._register_glitch_scroll_listeners()}async _on_scroll(e){e.stopPropagation(),e.returnValue=!1,await this.draw({invalid_viewport:!1}),this.dispatchEvent(new CustomEvent("regular-table-scroll"))}_register_glitch_scroll_listeners(){this.addEventListener("mousewheel",this._on_mousewheel.bind(this),{passive:!1}),this.addEventListener("touchstart",this._on_touchstart.bind(this),{passive:!1}),this.addEventListener("touchmove",this._on_touchmove.bind(this),{passive:!1})}_on_mousewheel(e){if(this._virtual_scrolling_disabled)return;const{clientWidth:t,clientHeight:i,scrollTop:s,scrollLeft:r,scrollHeight:a}=this;if(e.deltaY>0&&s+i<a||e.deltaY<0&&s>0||0===e.deltaY){e.preventDefault(),e.returnValue=!1;const a=Math.max(1,this._virtual_panel.offsetHeight-i),l=Math.max(1,this._virtual_panel.offsetWidth-t);this.scrollTop=Math.min(a,s+e.deltaY),this.scrollLeft=Math.min(l,r+e.deltaX),this._on_scroll(e)}}_on_touchmove(e){if(this._virtual_scrolling_disabled)return;e.preventDefault(),e.returnValue=!1;const{clientWidth:t,clientHeight:i,scrollTop:s,scrollLeft:r}=this,a=Math.max(1,this._virtual_panel.offsetHeight-i),l=Math.max(1,this._virtual_panel.offsetWidth-t);this.scrollTop=Math.min(a,s+(this._memo_touch_startY-e.touches[0].screenY)),this.scrollLeft=Math.min(l,r+(this._memo_touch_startX-e.touches[0].screenX)),this._on_scroll(e)}_on_touchstart(e){this._memo_touch_startY=e.touches[0].screenY,this._memo_touch_startX=e.touches[0].screenX}async _on_dblclick(e){let t=e.target;for(;"TD"!==t.tagName&&"TH"!==t.tagName;)if(t=t.parentElement,!this._sticky_container.contains(t))return;const s=e.target.classList.contains("pd-column-resize"),r=i.get(t);if(s){await new Promise(setTimeout),delete this._column_sizes.override[r.size_key],delete this._column_sizes.auto[r.size_key],delete this._column_sizes.indices[r.size_key],t.style.minWidth="",t.style.maxWidth="";for(const e of this.table_model.body.cells){const t=e[r._virtual_x];t&&(t.style.minWidth="",t.style.maxWidth="",t.classList.remove("pd-cell-clip"))}await this.draw()}}async _on_click(e){if(0!==e.button)return;let t=e.target;for(;"TD"!==t.tagName&&"TH"!==t.tagName;)if(t=t.parentElement,!this._sticky_container.contains(t))return;const s=e.target.classList.contains("pd-column-resize"),r=i.get(t);s&&this._on_resize_column(e,t,r)}_on_resize_column(e,t,i){const s=e.pageX;t=this.table_model.header.get_column_header(i._virtual_x);const r=this._column_sizes.indices[i.size_key],a=e=>this._on_resize_column_move(e,t,s,r,i),l=async()=>{document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",l);const e=this._column_sizes.override[i.size_key];this._column_sizes.indices[i.size_key]=e,await this.draw()};document.addEventListener("mousemove",a),document.addEventListener("mouseup",l)}async _on_resize_column_move(e,t,i,s,r){await new Promise(setTimeout);const a=e.pageX-i,l=Math.max(1,s+a);if(this._column_sizes.override[r.size_key]=l,a<0)await this.draw({preserve_width:!0});else{t.style.minWidth=l+"px",t.style.maxWidth=l+"px";const e=this._column_sizes.auto[r.size_key];for(const t of this.table_model.body.cells){const i=t[r._virtual_x];i&&(i.style.maxWidth=i.style.minWidth=l+"px",i.classList.toggle("pd-cell-clip",e>l))}}}}).prototype,"_on_resize_column_move",[d],Object.getOwnPropertyDescriptor(f.prototype,"_on_resize_column_move"),f.prototype),f);window.customElements.define("regular-table",class extends v{connectedCallback(){this._initialized||(this.create_shadow_dom(),this.register_listeners(),this.setAttribute("tabindex","0"),this._column_sizes={auto:{},override:{},indices:[]},this._style_callbacks=new Map,this.table_model=new p(this._table_clip,this._column_sizes,this._sticky_container),this!==this._sticky_container.parentElement&&(this.appendChild(this._sticky_container),this.appendChild(this._table_staging)),this._initialized=!0)}_reset_viewport(){this._start_row=void 0,this._end_row=void 0,this._start_col=void 0,this._end_col=void 0}_reset_scroll(){this._column_sizes.indices=[],this.scrollTop=0,this.scrollLeft=0,this._reset_viewport()}_resetAutoSize(){this._column_sizes.auto={},this._column_sizes.override={},this._column_sizes.indices=[];for(const e of this.table_model.header.cells[this.table_model.header.cells.length-1])e.style.minWidth="",e.style.maxWidth=""}clear(){this.table_model=new p(this._table_clip,this._column_sizes,this._sticky_container)}addStyleListener(e){const t=this._style_callbacks.size;return this._style_callbacks.set(t,e),t}getMeta(e){if(void 0!==e){if(e instanceof HTMLElement)return i.get(e);if(e.row_header_x>=0){if(e.row_header_x<this._view_cache.config.row_pivots.length){var t;const i=null===(t=this.table_model.body.cells[e.y])||void 0===t?void 0:t[e.row_header_x];return this.getMeta(i)}}else{var s;if(!(e.column_header_y>=0))return this.getMeta(null===(s=this.table_model.body.cells[e.dy])||void 0===s?void 0:s[e.dx+this.table_model._row_headers_length]);if(e.column_header_y<this._view_cache.config.column_pivots.length){var r;const t=null===(r=this.table_model.body.cells[e.column_header_y])||void 0===r?void 0:r[e.y];return this.getMeta(t)}}}}getDrawFPS(){return function(){const e=performance.now(),t=e-c,i=o,s=1e3*n/t,r=n;return o=0,n=0,c=e,{avg:i,real_fps:s,virtual_fps:1e3/i,num_frames:r,elapsed:t}}()}async scrollToCell(e,t,i,s){const r=this._virtual_panel.offsetHeight/s;this.scrollTop=r*t,this.scrollLeft=e/(this._max_scroll_column(i)||i)*(this.scrollWidth-this.clientWidth),await this.draw()}setDataListener(e){this._invalid_schema=!0,this._view_cache={view:e,config:{row_pivots:[],column_pivots:[]},schema:{}}}})},function(e,t,i){var s=i(2),r=i(12);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);var a={insert:"head",singleton:!1};s(r,a);e.exports=r.locals||{}},function(e,t,i){(t=i(3)(!1)).push([e.i,"@import url(https://fonts.googleapis.com/css?family=Open+Sans);"]),t.push([e.i,"@import url(https://fonts.googleapis.com/css?family=Material+Icons);"]),t.push([e.i,"@import url(https://fonts.googleapis.com/css?family=Roboto+Mono);"]),t.push([e.i,"regular-table{padding:12px 0 0 12px;scrollbar-color:transparent transparent;scrollbar-width:thin;outline:none}regular-table:hover{scrollbar-color:rgba(0,0,0,.3) transparent}regular-table{font-family:Open Sans}regular-table div[tabindex]{outline:none}regular-table>div{position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden}regular-table th{text-align:center}regular-table thead tr:not(:last-child) th{overflow:hidden;max-width:0}regular-table tbody .pd-float,regular-table thead tr:last-child .pd-float{text-align:right}regular-table tbody .pd-integer,regular-table thead .pd-integer{text-align:right}regular-table tbody th{text-align:left}regular-table span.pd-tree-container{display:flex;align-items:center;height:100%}regular-table tbody .pd-date,regular-table tbody .pd-datetime,regular-table tbody .pd-string,regular-table thead .pd-date,regular-table thead .pd-datetime,regular-table thead .pd-string{text-align:left}regular-table thead tr:last-child th{border-bottom:1px solid #ddd}regular-table th{position:relative}regular-table tr th span.pd-tree-group{margin-left:5px;margin-right:15px;border-left:1px solid #eee;height:100%}regular-table td,regular-table th{white-space:nowrap;font-size:12px;padding:0 5px;height:19px}regular-table tr:hover td{background:#eee;opacity:1}regular-table tr:hover{color:#333}regular-table table *{box-sizing:border-box}regular-table table{position:absolute;overflow:hidden;color:#666;outline:none}regular-table span.pd-row-header-icon{color:#aaa;padding-right:4px;font-family:Material Icons}regular-table span.pd-column-header-icon{font-size:10px;padding-left:3px;display:inline-block;width:10px;font-family:Material Icons}regular-table span.pd-row-header-icon:hover{color:#1a7da1;text-shadow:0 0 3px #1a7da1}regular-table .pd-selected td{background-color:#eee}regular-table .pd-cell-clip{overflow:hidden;text-overflow:ellipsis}regular-table td span.pd-group-name,regular-table th span.pd-group-name{margin-right:-5px;padding-right:5px;padding-left:8px;flex:1;height:100%}regular-table th span.pd-group-name{text-align:left}regular-table td th span.pd-group-leaf,regular-table th span.pd-group-leaf{margin-left:16px;height:100%}regular-table .pd-column-resize{height:100%;width:10px;position:absolute;top:0;right:0;cursor:col-resize}regular-table::-webkit-scrollbar,regular-table::-webkit-scrollbar-corner{background-color:transparent;height:12px;width:12px}regular-table::-webkit-scrollbar-thumb{background-clip:content-box;background-color:transparent;border-radius:5px}regular-table::-webkit-scrollbar-thumb:horizontal{border-bottom:2px solid transparent;border-top:2px solid transparent}regular-table::-webkit-scrollbar-thumb:vertical{border-left:2px solid transparent;border-right:2px solid transparent}regular-table:hover::-webkit-scrollbar-thumb{background-color:rgba(0,0,0,.15)}regular-table::-webkit-scrollbar-thumb:hover{background-color:rgba(0,0,0,.3)}",""]),e.exports=t},function(e,t,i){(t=i(3)(!1)).push([e.i,"div.ipyregulartable {\n  min-height: 200px;\n  /* resize: both; */\n}\n",""]),e.exports=t}])}));
//# sourceMappingURL=index.js.map
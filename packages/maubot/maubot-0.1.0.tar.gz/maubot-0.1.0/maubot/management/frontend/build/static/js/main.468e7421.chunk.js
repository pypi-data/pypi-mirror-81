(this["webpackJsonpmaubot-manager"]=this["webpackJsonpmaubot-manager"]||[]).push([[0],{102:function(e,t,a){e.exports=a(223)},107:function(e,t,a){},223:function(e,t,a){"use strict";a.r(t);var s=a(0),n=a.n(s),r=a(19),i=a.n(r),l=(a(107),a(5)),o=a(6);var c=({component:e,render:t,authed:a,to:s="/login",...r})=>n.a.createElement(o.b,Object.assign({},r,{render:r=>!0===a?e?n.a.createElement(e,r):t():n.a.createElement(o.a,{to:{pathname:s}})}));var h=e=>n.a.createElement("div",Object.assign({},e,{className:"spinner "+(e.className||"")}),n.a.createElement("svg",{viewBox:"25 25 50 50"},n.a.createElement("circle",{cx:"50",cy:"50",r:"20",fill:"none",strokeWidth:"2",strokeMiterlimit:"10"})));let d="/_matrix/maubot/v1";function m(e="application/json"){return{"Content-Type":e,Authorization:"Bearer "+localStorage.accessToken}}async function p(e,t){const a=await fetch(`${d}/${e}/${t}`,{headers:m(),method:"DELETE"});return 204===a.status?{success:!0}:await a.json()}async function u(e,t,a,s){const n=await fetch(`${d}/${e}/${a||t.id}${s||""}`,{headers:m(),body:JSON.stringify(t),method:"PUT"});return await n.json()}async function g(e){const t=await fetch(`${d}${e}`,{headers:m()});return await t.json()}let v=null;const E=async()=>{v=await g("/features")};let y=void 0;var b={login:async function(e,t){const a=await fetch(d+"/auth/login",{method:"POST",body:JSON.stringify({username:e,password:t})});return await a.json()},ping:async function(){const e=await fetch(d+"/auth/ping",{method:"POST",headers:m()}),t=await e.json();if(t.username)return v=t.features,t.username;if("auth_token_missing"===t.errcode||"auth_token_invalid"===t.errcode)return v||await E(),null;throw t},setBasePath:function(e){d=e},getFeatures:()=>v,remoteGetFeatures:E,openLogSocket:async function(){const e=`${"https:"===window.location.protocol?"wss:":"ws:"}//${window.location.host}${d}/logs`,t={socket:null,connected:!1,authenticated:!1,onLog:e=>{},onHistory:e=>{},fails:-1},a=()=>{t.socket.send(localStorage.accessToken),t.connected=!0},s=e=>{const a=JSON.parse(e.data);void 0!==a.auth_success?a.auth_success?(console.info("Websocket connection authentication successful"),t.authenticated=!0,t.fails=-1):console.info("Websocket connection authentication failed"):a.history?t.onHistory(a.history):t.onLog(a)},n=r=>{r&&(4e3===r.code?console.error("Websocket connection failed: access token invalid or not provided"):1012===r.code&&console.info("Websocket connection closed: server is restarting")),t.connected=!1,t.socket=null,t.fails++;setTimeout(()=>{t.socket=new WebSocket(e),t.socket.onopen=a,t.socket.onmessage=s,t.socket.onclose=n},Math.min(5*t.fails*1e3,3e4))};return n(),t},debugOpenFile:async function(e,t){const a=await fetch(d+"/debug/open",{headers:m(),body:JSON.stringify({path:e,line:t}),method:"POST"});return await a.json()},debugOpenFileEnabled:()=>y,updateDebugOpenFileEnabled:async()=>{const e=await g("/debug/open");y=e.enabled||!1},getInstances:()=>g("/instances"),getInstance:e=>g("/instance/"+e),putInstance:(e,t)=>u("instance",e,t),deleteInstance:e=>p("instance",e),getInstanceDatabase:e=>g(`/instance/${e}/database`),queryInstanceDatabase:async(e,t)=>{const a=await fetch(`${d}/instance/${e}/database/query`,{headers:m(),body:JSON.stringify({query:t}),method:"POST"});return await a.json()},getPlugins:()=>g("/plugins"),getPlugin:e=>g("/plugin/"+e),uploadPlugin:async function(e,t){let a;return a=t?await fetch(`${d}/plugin/${t}`,{headers:m("application/zip"),body:e,method:"PUT"}):await fetch(d+"/plugins/upload",{headers:m("application/zip"),body:e,method:"POST"}),await a.json()},deletePlugin:e=>p("plugin",e),getClients:()=>g("/clients"),getClient:e=>g("/clients/"+e),uploadAvatar:async function(e,t,a){const s=await fetch(`${d}/proxy/${e}/_matrix/media/r0/upload`,{headers:m(a),body:t,method:"POST"});return await s.json()},getAvatarURL:function({id:e,avatar_url:t}){return(t=t||"").startsWith("mxc://")&&(t=t.substr("mxc://".length)),`${d}/proxy/${e}/_matrix/media/r0/download/${t}?access_token=${localStorage.accessToken}`},putClient:e=>u("client",e),deleteClient:e=>p("client",e),clearClientCache:async function(e){const t=await fetch(`${d}/client/${e}/clearcache`,{headers:m(),method:"POST"});return await t.json()},getClientAuthServers:()=>g("/client/auth/servers"),doClientAuth:async function(e,t,a,s){const n=await fetch(`${d}/client/auth/${e}/${t}`,{headers:m(),body:JSON.stringify({username:a,password:s}),method:"POST"});return await n.json()}};function f(){return(f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e}).apply(this,arguments)}var w=n.a.createElement("path",{fill:"#000000",d:"M17,13H13V17H11V13H7V11H11V7H13V11H17M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"});const N=({svgRef:e,title:t,...a})=>n.a.createElement("svg",f({width:24,height:24,viewBox:"0 0 24 24",ref:e},a),t?n.a.createElement("title",null,t):null,w),C=n.a.forwardRef((e,t)=>n.a.createElement(N,f({svgRef:t},e)));a.p;var S=a(97),O=a.n(S);a(117),a(118);function k(){return(k=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e}).apply(this,arguments)}var x=n.a.createElement("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}),L=n.a.createElement("path",{d:"M0 0h24v24H0z",fill:"none"});const R=({svgRef:e,title:t,...a})=>n.a.createElement("svg",k({width:24,height:24,viewBox:"0 0 24 24",ref:e},a),t?n.a.createElement("title",null,t):null,x,L),_=n.a.forwardRef((e,t)=>n.a.createElement(R,k({svgRef:t},e)));a.p;function A(){return(A=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e}).apply(this,arguments)}var j=n.a.createElement("path",{fill:"#000000",d:"M12,2A2,2 0 0,1 14,4C14,4.74 13.6,5.39 13,5.73V7H14A7,7 0 0,1 21,14H22A1,1 0 0,1 23,15V18A1,1 0 0,1 22,19H21V20A2,2 0 0,1 19,22H5A2,2 0 0,1 3,20V19H2A1,1 0 0,1 1,18V15A1,1 0 0,1 2,14H3A7,7 0 0,1 10,7H11V5.73C10.4,5.39 10,4.74 10,4A2,2 0 0,1 12,2M7.5,13A2.5,2.5 0 0,0 5,15.5A2.5,2.5 0 0,0 7.5,18A2.5,2.5 0 0,0 10,15.5A2.5,2.5 0 0,0 7.5,13M16.5,13A2.5,2.5 0 0,0 14,15.5A2.5,2.5 0 0,0 16.5,18A2.5,2.5 0 0,0 19,15.5A2.5,2.5 0 0,0 16.5,13Z"});const P=({svgRef:e,title:t,...a})=>n.a.createElement("svg",A({width:24,height:24,viewBox:"0 0 24 24",ref:e},a),t?n.a.createElement("title",null,t):null,j),T=n.a.forwardRef((e,t)=>n.a.createElement(P,A({svgRef:t},e)));a.p;var F=a(100),M=a(98);class $ extends s.Component{constructor(e){super(e),this.toggle=()=>{this.props.onToggle?this.props.onToggle(!this.state.active):this.setState({active:!this.state.active})},this.toggleKeyboard=e=>(" "===e.key||"Enter"===e.key)&&this.toggle(),this.state={active:e.active}}componentWillReceiveProps(e){this.setState({active:e.active})}render(){return n.a.createElement("div",{className:"switch","data-active":this.state.active,onClick:this.toggle,tabIndex:"0",onKeyPress:this.toggleKeyboard,id:this.props.id},n.a.createElement("div",{className:"box"},n.a.createElement("span",{className:"text"},n.a.createElement("span",{className:"on"},this.props.onText||"On"),n.a.createElement("span",{className:"off"},this.props.offText||"Off"))))}}var I=$;const D=({children:e,wrapperClass:t})=>t?n.a.createElement("div",{className:t},n.a.createElement("div",{className:"preference-table"},e)):n.a.createElement("div",{className:"preference-table"},e),B=({name:e,fullWidth:t=!1,labelFor:a,changed:s=!1,children:r})=>n.a.createElement("div",{className:`entry ${t?"full-width":""} ${s?"changed":""}`},n.a.createElement("label",{htmlFor:a},e),n.a.createElement("div",{className:"value"},r)),V=({rowName:e,value:t,origValue:a,fullWidth:s=!1,...r})=>n.a.createElement(B,{name:e,fullWidth:s,labelFor:e,changed:void 0!==a&&t!==a},n.a.createElement("input",Object.assign({},r,{value:t,id:e}))),H=({rowName:e,active:t,origActive:a,fullWidth:s=!1,...r})=>n.a.createElement(B,{name:e,fullWidth:s,labelFor:e,changed:void 0!==a&&t!==a},n.a.createElement(I,Object.assign({},r,{active:t,id:e}))),W=({rowName:e,value:t,origValue:a,fullWidth:s=!1,creatable:r=!1,...i})=>n.a.createElement(B,{name:e,fullWidth:s,labelFor:e,changed:void 0!==a&&t.id!==a},r?n.a.createElement(M.a,Object.assign({className:"select"},i,{id:e,value:t})):n.a.createElement(F.a,Object.assign({className:"select"},i,{id:e,value:t})));var U=D;class q extends s.Component{constructor(e){super(e),this.delete=async()=>{if(!window.confirm(`Are you sure you want to delete ${this.state.id}?`))return;this.setState({deleting:!0});const e=await this.deleteFunc(this.state.id);e.success?(this.props.history.push("/"),this.props.onDelete()):this.setState({deleting:!1,error:e.error})},this.inputChange=e=>{e.target.name&&this.setState({[e.target.name]:e.target.value})},this.renderInstances=()=>!this.isNew&&n.a.createElement("div",{className:"instances"},n.a.createElement("h3",null,this.hasInstances?"Instances":"No instances :("),this.state.instances.map(e=>n.a.createElement(l.b,{className:"instance",key:e.id,to:"/instance/"+e.id},e.id))),this.renderLogButton=e=>!this.isNew&&b.getFeatures().log&&n.a.createElement("div",{className:"buttons"},n.a.createElement("button",{className:"open-log",onClick:()=>this.props.openLog(e)},"View logs")),this.state=Object.assign(this.initialState,e.entry)}componentWillReceiveProps(e){const t=Object.assign(this.initialState,e.entry);for(const a of this.entryKeys)this.props.entry[a]===e.entry[a]&&(t[a]=this.state[a]);this.setState(t)}get entryKeys(){return[]}get initialState(){return{}}get hasInstances(){return this.state.instances&&this.state.instances.length>0}get isNew(){return!this.props.entry.id}async readFile(e){return new Promise((t,a)=>{const s=new FileReader;s.readAsArrayBuffer(e),s.onload=e=>t(e.target.result),s.onerror=e=>a(e)})}}var z=q,Q=a(37);function K(){return(K=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e}).apply(this,arguments)}var J=n.a.createElement("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"}),X=n.a.createElement("path",{d:"M0 0h24v24H0z",fill:"none"});const G=({svgRef:e,title:t,...a})=>n.a.createElement("svg",K({width:24,height:24,viewBox:"0 0 24 24",ref:e},a),t?n.a.createElement("title",null,t):null,J,X),Z=n.a.forwardRef((e,t)=>n.a.createElement(G,K({svgRef:t},e)));a.p;function Y(){return(Y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e}).apply(this,arguments)}var ee=n.a.createElement("path",{d:"M7 10l5 5 5-5z"}),te=n.a.createElement("path",{d:"M0 0h24v24H0z",fill:"none"});const ae=({svgRef:e,title:t,...a})=>n.a.createElement("svg",Y({width:24,height:24,viewBox:"0 0 24 24",ref:e},a),t?n.a.createElement("title",null,t):null,ee,te),se=n.a.forwardRef((e,t)=>n.a.createElement(ae,Y({svgRef:t},e)));a.p;function ne(){return(ne=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e}).apply(this,arguments)}var re=n.a.createElement("path",{d:"M7 14l5-5 5 5z"}),ie=n.a.createElement("path",{d:"M0 0h24v24H0z",fill:"none"});const le=({svgRef:e,title:t,...a})=>n.a.createElement("svg",ne({width:24,height:24,viewBox:"0 0 24 24",ref:e},a),t?n.a.createElement("title",null,t):null,re,ie),oe=n.a.forwardRef((e,t)=>n.a.createElement(le,ne({svgRef:t},e)));a.p;Map.prototype.map=function(e){const t=[];for(const[a,s]of this)t.push(e(s,a,this));return t};class ce extends s.Component{constructor(e){super(e),this.reloadContent=async(e=!0)=>{this.setState({loading:!0});const t=await b.queryInstanceDatabase(this.props.instanceID,this.state.query);this.setState({loading:!1}),e&&this.setState({prevQuery:null,rowCount:null,insertedPrimaryKey:null,error:null}),t.ok?t.rows?this.setState({header:t.columns,content:t.rows}):(this.setState({prevQuery:t.query,rowCount:t.rowcount,insertedPrimaryKey:t.insertedPrimaryKey}),this.buildSQLQuery(this.state.selectedTable,!1)):this.setState({error:t.error})},this.deleteRow=async(e,t)=>{const a=this.state.content[t.row],s=this.state.header,n=[];for(const[l,o]of Object.entries(s)){const e=a[l];n.push(`${o}='${this.sqlEscape(e.toString())}'`)}const r=`DELETE FROM "${this.state.selectedTable}" WHERE ${n.join(" AND ")}`,i=await b.queryInstanceDatabase(this.props.instanceID,r);this.setState({prevQuery:`DELETE FROM "${this.state.selectedTable}" ...`,rowCount:i.rowcount}),await this.reloadContent(!1)},this.editCell=async(e,t)=>{console.log("Edit",t)},this.collectContextMeta=e=>({row:e.row,col:e.col}),this.sqlEscape=e=>e.replace(/[\0\x08\x09\x1a\n\r"'\\%]/g,e=>{switch(e){case"\0":return"\\0";case"\b":return"\\b";case"\t":return"\\t";case"\x1a":return"\\z";case"\n":return"\\n";case"\r":return"\\r";case'"':case"'":case"\\":case"%":return"\\"+e;default:return e}}),this.renderTable=()=>n.a.createElement("div",{className:"table"},this.state.header?n.a.createElement(n.a.Fragment,null,n.a.createElement("table",null,n.a.createElement("thead",null,n.a.createElement("tr",null,this.state.header.map(e=>n.a.createElement("td",{key:e},n.a.createElement("span",{onClick:()=>this.toggleSort(e),title:this.getColumnType(e)},n.a.createElement("strong",null,e),this.getColumnInfo(e),this.getSortIcon(e)))))),n.a.createElement("tbody",null,this.state.content.map((e,t)=>n.a.createElement("tr",{key:t},e.map((e,a)=>n.a.createElement(Q.b,{key:a,id:"database_table_menu",renderTag:"td",row:t,col:a,collect:this.collectContextMeta},e)))))),n.a.createElement(Q.a,{id:"database_table_menu"},n.a.createElement(Q.c,{onClick:this.deleteRow},"Delete row"),n.a.createElement(Q.c,{disabled:!0,onClick:this.editCell},"Edit cell"))):this.state.loading?n.a.createElement(h,null):null),this.state={tables:null,header:null,content:null,query:"",selectedTable:null,error:null,prevQuery:null,rowCount:null,insertedPrimaryKey:null},this.order=new Map}async componentWillMount(){const e=new Map(Object.entries(await b.getInstanceDatabase(this.props.instanceID)));for(const[t,a]of e){a.name=t,a.columns=new Map(Object.entries(a.columns));for(const[e,t]of a.columns)t.name=e,t.sort=null}this.setState({tables:e}),this.checkLocationTable()}componentDidUpdate(e){this.props.location!==e.location&&(this.order=new Map,this.setState({header:null,content:null}),this.checkLocationTable())}checkLocationTable(){const e=`/instance/${this.props.instanceID}/database/`;if(this.props.location.pathname.startsWith(e)){const t=this.props.location.pathname.substr(e.length);this.setState({selectedTable:t}),this.buildSQLQuery(t)}}getSortQueryParams(e){const t=[];for(const[a,s]of Array.from(this.order.entries()).reverse())t.push(`order=${a}:${s}`);return t}buildSQLQuery(e=this.state.selectedTable,t=!0){let a=`SELECT * FROM "${e}"`;if(this.order.size>0){a+=" ORDER BY "+Array.from(this.order.entries()).reverse().map(([e,t])=>`${e} ${t}`).join(", ")}a+=" LIMIT 100",this.setState({query:a},()=>this.reloadContent(t))}toggleSort(e){const t=this.order.get(e)||"auto";switch(this.order.delete(e),t){case"auto":this.order.set(e,"DESC");break;case"DESC":this.order.set(e,"ASC")}this.buildSQLQuery()}getSortIcon(e){switch(this.order.get(e)){case"DESC":return n.a.createElement(se,null);case"ASC":return n.a.createElement(oe,null);default:return null}}getColumnInfo(e){const t=this.state.tables.get(this.state.selectedTable);if(!t)return null;const a=t.columns.get(e);return a?a.primary?n.a.createElement("span",{className:"meta"},"\xa0(pk)"):a.unique?n.a.createElement("span",{className:"meta"},"\xa0(u)"):null:null}getColumnType(e){const t=this.state.tables.get(this.state.selectedTable);if(!t)return null;const a=t.columns.get(e);return a?a.type:null}renderContent(){return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"tables"},this.state.tables.map((e,t)=>n.a.createElement(l.c,{key:t,to:`/instance/${this.props.instanceID}/database/${t}`},t))),n.a.createElement("div",{className:"query"},n.a.createElement("input",{type:"text",value:this.state.query,name:"query",onChange:e=>this.setState({query:e.target.value})}),n.a.createElement("button",{type:"submit",onClick:this.reloadContent},"Query")),this.state.error&&n.a.createElement("div",{className:"error"},this.state.error),this.state.prevQuery&&n.a.createElement("div",{className:"prev-query"},n.a.createElement("p",null,"Executed ",n.a.createElement("span",{className:"query"},this.state.prevQuery)," - affected ",n.a.createElement("strong",null,this.state.rowCount," rows"),"."),this.state.insertedPrimaryKey&&n.a.createElement("p",{className:"inserted-primary-key"},"Inserted primary key: ",this.state.insertedPrimaryKey)),this.renderTable())}render(){return n.a.createElement("div",{className:"instance-database"},n.a.createElement("div",{className:"topbar"},n.a.createElement(l.b,{className:"topbar",to:"/instance/"+this.props.instanceID},n.a.createElement(Z,null),"Back")),this.state.tables?this.renderContent():n.a.createElement(h,{className:"maubot-loading"}))}}var he=Object(o.g)(ce);class de extends z{constructor(e){super(e),this.clientSelectEntry=e=>e&&{id:e.id,value:e.id,label:n.a.createElement("div",{className:"select-client"},this.getAvatarMXC(e)?n.a.createElement("img",{className:"avatar",src:this.getAvatarURL(e),alt:""}):n.a.createElement(T,{className:"avatar"}),n.a.createElement("span",{className:"displayname"},("disable"===e.displayname?e.remote_displayname:e.displayname)||e.id))},this.save=async()=>{this.setState({saving:!0});const e=await b.putInstance(this.instanceInState,this.props.entry?this.props.entry.id:void 0);e.id?(this.isNew?this.props.history.push("/instance/"+e.id):(e.id!==this.props.entry.id&&this.props.history.replace("/instance/"+e.id),this.setState({saving:!1,error:""})),this.props.onChange(e)):this.setState({saving:!1,error:e.error})},this.renderDatabase=()=>n.a.createElement(he,{instanceID:this.props.entry.id}),this.renderMain=()=>n.a.createElement("div",{className:"instance"},n.a.createElement(U,null,n.a.createElement(V,{rowName:"ID",type:"text",name:"id",value:this.state.id,placeholder:"fancybotinstance",onChange:this.inputChange,disabled:!this.isNew,fullWidth:!0,className:"id"}),n.a.createElement(H,{rowName:"Enabled",active:this.state.enabled,origActive:this.props.entry.enabled,onToggle:e=>this.setState({enabled:e})}),n.a.createElement(H,{rowName:"Running",active:this.state.started,origActive:this.props.entry.started,onToggle:e=>this.setState({started:e})}),b.getFeatures().client?n.a.createElement(W,{rowName:"Primary user",options:this.clientOptions,isSearchable:!1,value:this.selectedClientEntry,origValue:this.props.entry.primary_user,onChange:({id:e})=>this.setState({primary_user:e})}):n.a.createElement(V,{rowName:"Primary user",type:"text",name:"primary_user",value:this.state.primary_user,placeholder:"@user:example.com",onChange:this.inputChange}),b.getFeatures().plugin?n.a.createElement(W,{rowName:"Type",options:this.typeOptions,isSearchable:!1,value:this.selectedPluginEntry,origValue:this.props.entry.type,onChange:({id:e})=>this.setState({type:e})}):n.a.createElement(V,{rowName:"Type",type:"text",name:"type",value:this.state.type,placeholder:"xyz.maubot.example",onChange:this.inputChange})),!this.isNew&&Boolean(this.props.entry.base_config)&&n.a.createElement(O.a,{mode:"yaml",theme:"github",onChange:e=>this.setState({config:e}),name:"config",value:this.state.config,editorProps:{fontSize:"10pt",$blockScrolling:!0}}),n.a.createElement("div",{className:"buttons"},!this.isNew&&n.a.createElement("button",{className:"delete",onClick:this.delete,disabled:this.loading},this.state.deleting?n.a.createElement(h,null):"Delete"),n.a.createElement("button",{className:"save "+(this.isValid?"":"disabled-bg"),onClick:this.save,disabled:this.loading||!this.isValid},this.state.saving?n.a.createElement(h,null):this.isNew?"Create":"Save")),!this.isNew&&n.a.createElement("div",{className:"buttons"},this.props.entry.database&&n.a.createElement(l.b,{className:"button open-database",to:`/instance/${this.state.id}/database`},"View database"),b.getFeatures().log&&n.a.createElement("button",{className:"open-log",onClick:()=>this.props.openLog("instance."+this.state.id)},"View logs")),n.a.createElement("div",{className:"error"},this.state.error)),this.deleteFunc=b.deleteInstance,this.updateClientOptions()}get entryKeys(){return["id","primary_user","enabled","started","type","config"]}get initialState(){return{id:"",primary_user:"",enabled:!0,started:!0,type:"",config:"",saving:!1,deleting:!1,error:""}}get instanceInState(){const e=Object.assign({},this.state);return delete e.saving,delete e.deleting,delete e.error,e}componentWillReceiveProps(e){super.componentWillReceiveProps(e),this.updateClientOptions()}getAvatarMXC(e){return"disable"===e.avatar_url?e.remote_avatar_url:e.avatar_url}getAvatarURL(e){return b.getAvatarURL({id:e.id,avatar_url:this.getAvatarMXC(e)})}updateClientOptions(){this.clientOptions=Object.values(this.props.ctx.clients).map(this.clientSelectEntry)}get selectedClientEntry(){return this.state.primary_user?this.clientSelectEntry(this.props.ctx.clients[this.state.primary_user]):{}}get selectedPluginEntry(){return{id:this.state.type,value:this.state.type,label:this.state.type}}get typeOptions(){return Object.values(this.props.ctx.plugins).map(e=>e&&{id:e.id,value:e.id,label:e.id})}get loading(){return this.state.deleting||this.state.saving}get isValid(){return this.state.id&&this.state.primary_user&&this.state.type}render(){return n.a.createElement(o.d,null,n.a.createElement(o.b,{path:"/instance/:id/database",render:this.renderDatabase}),n.a.createElement(o.b,{render:this.renderMain}))}}de.ListEntry=({entry:e})=>n.a.createElement(l.c,{className:"instance entry",to:"/instance/"+e.id},n.a.createElement("span",{className:"id"},e.id),n.a.createElement(_,{className:"chevron"}));var me=Object(o.g)(de);function pe(){return(pe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e}).apply(this,arguments)}var ue=n.a.createElement("path",{fill:"#000000",d:"M9,16V10H5L12,3L19,10H15V16H9M5,20V18H19V20H5Z"});const ge=({svgRef:e,title:t,...a})=>n.a.createElement("svg",pe({width:24,height:24,viewBox:"0 0 24 24",ref:e},a),t?n.a.createElement("title",null,t):null,ue),ve=n.a.forwardRef((e,t)=>n.a.createElement(ge,pe({svgRef:t},e)));a.p;class Ee extends z{constructor(e){super(e),this.homeserverEntry=([e,t])=>t&&{id:t,value:t,label:e||t},this.avatarUpload=async e=>{const t=e.target.files[0];this.setState({uploadingAvatar:!0});const a=await this.readFile(t),s=await b.uploadAvatar(this.state.id,a,t.type);this.setState({uploadingAvatar:!1,avatar_url:s.content_uri})},this.save=async()=>{this.setState({saving:!0});const e=await b.putClient(this.clientInState);e.id?(this.isNew?this.props.history.push("/client/"+e.id):this.setState({saving:!1,error:""}),this.props.onChange(e)):this.setState({saving:!1,error:e.error})},this.startOrStop=async()=>{this.setState({startingOrStopping:!0});const e=await b.putClient({id:this.props.entry.id,started:!this.props.entry.started});e.id?(this.props.onChange(e),this.setState({startingOrStopping:!1,error:""})):this.setState({startingOrStopping:!1,error:e.error})},this.clearCache=async()=>{this.setState({clearingCache:!0});const e=await b.clearClientCache(this.props.entry.id);e.success?this.setState({clearingCache:!1,error:""}):this.setState({clearingCache:!1,error:e.error})},this.renderStartedContainer=()=>{let e;return e=this.props.entry.started?this.props.entry.sync_ok?"Started":"Erroring":this.props.entry.enabled?"Stopped":"Disabled",n.a.createElement("div",{className:"started-container"},n.a.createElement("span",{className:`started ${this.props.entry.started}\n                             ${this.props.entry.sync_ok?"sync_ok":"sync_error"}\n                             ${this.props.entry.enabled?"":"disabled"}`}),n.a.createElement("span",{className:"text"},e))},this.renderSidebar=()=>!this.isNew&&n.a.createElement("div",{className:"sidebar"},n.a.createElement("div",{className:`avatar-container ${this.avatarMXC?"":"no-avatar"}\n                        ${this.state.uploadingAvatar?"uploading":""}`},this.avatarMXC&&n.a.createElement("img",{className:"avatar",src:this.avatarURL,alt:"Avatar"}),n.a.createElement(ve,{className:"upload"}),n.a.createElement("input",{className:"file-selector",type:"file",accept:"image/png, image/jpeg",onChange:this.avatarUpload,disabled:this.state.uploadingAvatar,onDragEnter:e=>e.target.parentElement.classList.add("drag"),onDragLeave:e=>e.target.parentElement.classList.remove("drag")}),this.state.uploadingAvatar&&n.a.createElement(h,null)),this.renderStartedContainer(),(this.props.entry.started||this.props.entry.enabled)&&n.a.createElement(n.a.Fragment,null,n.a.createElement("button",{className:"save",onClick:this.startOrStop,disabled:this.loading},this.state.startingOrStopping?n.a.createElement(h,null):this.props.entry.started?"Stop":"Start"),n.a.createElement("button",{className:"clearcache",onClick:this.clearCache,disabled:this.loading},this.state.clearingCache?n.a.createElement(h,null):"Clear cache"))),this.renderPreferences=()=>n.a.createElement(D,null,n.a.createElement(V,{rowName:"User ID",type:"text",disabled:!this.isNew,fullWidth:!0,name:this.isNew?"id":"",className:"id",value:this.state.id,origValue:this.props.entry.id,placeholder:"@fancybot:example.com",onChange:this.inputChange}),b.getFeatures().client_auth?n.a.createElement(W,{rowName:"Homeserver",options:this.homeserverOptions,isSearchable:!0,value:this.selectedHomeserver,origValue:this.props.entry.homeserver,onChange:({value:e})=>this.setState({homeserver:e}),creatable:!0,isValidNewOption:this.isValidHomeserver}):n.a.createElement(V,{rowName:"Homeserver",type:"text",name:"homeserver",value:this.state.homeserver,origValue:this.props.entry.homeserver,placeholder:"https://example.com",onChange:this.inputChange}),n.a.createElement(V,{rowName:"Access token",type:"text",name:"access_token",value:this.state.access_token,origValue:this.props.entry.access_token,placeholder:"MDAxYWxvY2F0aW9uIG1hdHJpeC5sb2NhbAowMDEzaWRlbnRpZmllc",onChange:this.inputChange}),n.a.createElement(V,{rowName:"Display name",type:"text",name:"displayname",value:this.state.displayname,origValue:this.props.entry.displayname,placeholder:"My fancy bot",onChange:this.inputChange}),n.a.createElement(V,{rowName:"Avatar URL",type:"text",name:"avatar_url",value:this.state.avatar_url,origValue:this.props.entry.avatar_url,placeholder:"mxc://example.com/mbmwyoTvPhEQPiCskcUsppko",onChange:this.inputChange}),n.a.createElement(H,{rowName:"Sync",active:this.state.sync,origActive:this.props.entry.sync,onToggle:e=>this.setState({sync:e})}),n.a.createElement(H,{rowName:"Autojoin",active:this.state.autojoin,origActive:this.props.entry.autojoin,onToggle:e=>this.setState({autojoin:e})}),n.a.createElement(H,{rowName:"Enabled",active:this.state.enabled,origActive:this.props.entry.enabled,onToggle:e=>this.setState({enabled:e,started:e&&this.state.started})}),n.a.createElement(H,{rowName:"Online",active:this.state.online,origActive:this.props.entry.online,onToggle:e=>this.setState({online:e})})),this.renderPrefButtons=()=>n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"buttons"},!this.isNew&&n.a.createElement("button",{className:"delete "+(this.hasInstances?"disabled-bg":""),onClick:this.delete,disabled:this.loading||this.hasInstances,title:this.hasInstances?"Can't delete client that is in use":""},this.state.deleting?n.a.createElement(h,null):"Delete"),n.a.createElement("button",{className:"save",onClick:this.save,disabled:this.loading},this.state.saving?n.a.createElement(h,null):this.isNew?"Create":"Save")),this.renderLogButton(this.state.id),n.a.createElement("div",{className:"error"},this.state.error)),this.deleteFunc=b.deleteClient,this.homeserverOptions={}}get entryKeys(){return["id","displayname","homeserver","avatar_url","access_token","sync","autojoin","online","enabled","started"]}get initialState(){return{id:"",displayname:"",homeserver:"",avatar_url:"",access_token:"",sync:!0,autojoin:!0,enabled:!0,online:!0,started:!1,instances:[],uploadingAvatar:!1,saving:!1,deleting:!1,startingOrStopping:!1,clearingCache:!1,error:""}}get clientInState(){const e=Object.assign({},this.state);return delete e.uploadingAvatar,delete e.saving,delete e.deleting,delete e.startingOrStopping,delete e.clearingCache,delete e.error,delete e.instances,e}get selectedHomeserver(){return this.state.homeserver?this.homeserverEntry([this.props.ctx.homeserversByURL[this.state.homeserver],this.state.homeserver]):{}}componentWillReceiveProps(e){super.componentWillReceiveProps(e),this.updateHomeserverOptions()}updateHomeserverOptions(){this.homeserverOptions=Object.entries(this.props.ctx.homeserversByName).map(this.homeserverEntry)}isValidHomeserver(e){try{return Boolean(new URL(e))}catch(t){return!1}}get loading(){return this.state.saving||this.state.startingOrStopping||this.clearingCache||this.state.deleting}get avatarMXC(){return"disable"===this.state.avatar_url?this.props.entry.remote_avatar_url:this.state.avatar_url}get avatarURL(){return b.getAvatarURL({id:this.state.id,avatar_url:this.avatarMXC})}render(){return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"client"},this.renderSidebar(),n.a.createElement("div",{className:"info"},this.renderPreferences(),this.renderPrefButtons(),this.renderInstances())))}}Ee.ListEntry=({entry:e})=>{const t=["client","entry"];e.enabled?e.started||t.push("stopped"):t.push("disabled");const a="disable"===e.avatar_url?e.remote_avatar_url:e.avatar_url,s=a&&b.getAvatarURL({id:e.id,avatar_url:a}),r=("disable"===e.displayname?e.remote_displayname:e.displayname)||e.id;return n.a.createElement(l.c,{className:t.join(" "),to:"/client/"+e.id},s?n.a.createElement("img",{className:"avatar",src:s,alt:""}):n.a.createElement(T,{className:"avatar"}),n.a.createElement("span",{className:"displayname"},r),n.a.createElement(_,{className:"chevron"}))};var ye=Object(o.g)(Ee);class be extends z{constructor(e){super(e),this.upload=async e=>{const t=e.target.files[0];this.setState({uploadingAvatar:!0});const a=await this.readFile(t),s=await b.uploadPlugin(a,this.state.id);s.id?(this.isNew?this.props.history.push("/plugin/"+s.id):this.setState({saving:!1,error:""}),this.props.onChange(s)):this.setState({saving:!1,error:s.error})},this.deleteFunc=b.deletePlugin}get initialState(){return{id:"",version:"",instances:[],uploading:!1,deleting:!1,error:""}}render(){return n.a.createElement("div",{className:"plugin"},!this.isNew&&n.a.createElement(U,null,n.a.createElement(V,{rowName:"ID",type:"text",value:this.state.id,disabled:!0,className:"id"}),n.a.createElement(V,{rowName:"Version",type:"text",value:this.state.version,disabled:!0})),b.getFeatures().plugin_upload&&n.a.createElement("div",{className:"upload-box "+(this.state.uploading?"uploading":"")},n.a.createElement(ve,{className:"upload"}),n.a.createElement("input",{className:"file-selector",type:"file",accept:"application/zip+mbp",onChange:this.upload,disabled:this.state.uploading||this.state.deleting,onDragEnter:e=>e.target.parentElement.classList.add("drag"),onDragLeave:e=>e.target.parentElement.classList.remove("drag")}),this.state.uploading&&n.a.createElement(h,null)),!this.isNew&&n.a.createElement("div",{className:"buttons"},n.a.createElement("button",{className:"delete "+(this.hasInstances?"disabled-bg":""),onClick:this.delete,disabled:this.loading||this.hasInstances,title:this.hasInstances?"Can't delete plugin that is in use":""},this.state.deleting?n.a.createElement(h,null):"Delete")),this.renderLogButton("loader.zip"),n.a.createElement("div",{className:"error"},this.state.error),this.renderInstances())}}be.ListEntry=({entry:e})=>n.a.createElement(l.c,{className:"plugin entry",to:"/plugin/"+e.id},n.a.createElement("span",{className:"id"},e.id),n.a.createElement(_,{className:"chevron"}));var fe=Object(o.g)(be);class we extends s.Component{render(){return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"home"},"See sidebar to get started"),n.a.createElement("div",{className:"buttons"}))}}var Ne=we,Ce=a(101),Se=a.n(Ce);class Oe extends s.Component{constructor(e){super(e),this.open=()=>this.setState({open:!0}),this.close=()=>this.setState({open:!1}),this.isOpen=()=>this.state.open,this.state={open:!1},this.wrapper={clientWidth:9001}}render(){return this.state.open&&n.a.createElement("div",{className:"modal-wrapper-wrapper",ref:e=>this.wrapper=e,onClick:()=>this.wrapper.clientWidth>720&&this.close()},n.a.createElement("div",{className:"modal-wrapper",onClick:e=>e.stopPropagation()},n.a.createElement("button",{className:"close",onClick:this.close},"Close"),n.a.createElement("div",{className:"modal"},n.a.createElement(Oe.Context.Provider,{value:this},this.props.children))))}}Oe.Context=Object(s.createContext)(null);var ke=Oe;class xe extends s.PureComponent{renderName(){const e=this.props.line;if(e.nameLink){const t=this.context;return n.a.createElement(l.b,{to:e.nameLink,onClick:t.close},e.name)}return e.name}renderContent(){if(this.props.line.matrix_http_request){const e=this.props.line.matrix_http_request;return n.a.createElement(n.a.Fragment,null,e.method," ",e.path,n.a.createElement("div",{className:"content"},Object.entries(e.content).length>0&&n.a.createElement(Se.a,{data:{content:e.content},hideRoot:!0})))}return this.props.line.msg}onClickOpen(e,t){return()=>(b.debugOpenFileEnabled()&&b.debugOpenFile(e,t),!1)}renderTimeTitle(){return this.props.line.time.toDateString()}renderTime(){return n.a.createElement("a",{className:"time",title:this.renderTimeTitle(),href:`file:///${this.props.line.pathname}:${this.props.line.lineno}`,onClick:this.onClickOpen(this.props.line.pathname,this.props.line.lineno)},this.props.line.time.toLocaleTimeString("en-GB"))}renderLevelName(){return n.a.createElement("span",{className:"level"},this.props.line.levelname)}get unfocused(){return this.props.focus&&this.props.line.name!==this.props.focus?"unfocused":""}renderRow(e){return n.a.createElement("div",{className:`row ${this.props.line.levelname.toLowerCase()} ${this.unfocused}`},this.renderTime(),this.renderLevelName(),n.a.createElement("span",{className:"logger"},this.renderName()),n.a.createElement("span",{className:"text"},e))}renderExceptionInfo(){if(!b.debugOpenFileEnabled())return this.props.line.exc_info;const e=[];let t=this.props.line.exc_info.replace(/File "(.+)", line ([0-9]+), in (.+)/g,(t,a,s,r)=>(e.push(n.a.createElement("a",{href:`file:///${a}:${s}`,onClick:this.onClickOpen(a,s)},'File "',a,'", line ',s,", in ",r)),"||EDGE||"));e.reverse();const a=[];let s=0;for(const r of t.split("||EDGE||"))a.push(n.a.createElement(n.a.Fragment,{key:s++},r,e.pop()));return a}render(){return n.a.createElement(n.a.Fragment,null,this.renderRow(this.renderContent()),this.props.line.exc_info&&this.renderRow(this.renderExceptionInfo()))}}xe.contextType=ke.Context;class Le extends s.PureComponent{constructor(e){super(e),this.linesRef=n.a.createRef(),this.linesBottomRef=n.a.createRef()}getSnapshotBeforeUpdate(){return!(!this.linesRef.current||!this.linesBottomRef.current)&&Le.isVisible(this.linesRef.current,this.linesBottomRef.current)}componentDidUpdate(e,t,a){a&&Le.scrollParentToChild(this.linesRef.current,this.linesBottomRef.current)}componentDidMount(){this.linesRef.current&&this.linesBottomRef.current&&Le.scrollParentToChild(this.linesRef.current,this.linesBottomRef.current)}static scrollParentToChild(e,t){const a=e.getBoundingClientRect(),s=t.getBoundingClientRect();Le.isVisible(e,t)||e.scrollBy({top:s.top+e.scrollTop-a.top})}static isVisible(e,t){const a=e.getBoundingClientRect(),s=t.getBoundingClientRect();return s.top>=a.top&&s.top<=a.top+e.clientHeight}render(){return n.a.createElement("div",{className:"log",ref:this.linesRef},n.a.createElement("div",{className:"lines"},this.props.lines.map(e=>n.a.createElement(xe,{key:e.id,line:e,focus:this.props.focus}))),n.a.createElement("div",{ref:this.linesBottomRef}))}}var Re=Le;class _e extends s.Component{constructor(e){super(e),this.openLog=e=>{this.setState({logFocus:"string"===typeof e?e:null}),this.logModal.open()},this.renderNotFound=(e="path")=>n.a.createElement("div",{className:"not-found"},"Oops! I'm afraid that ",e," couldn't be found."),this.renderDisabled=(e="path")=>n.a.createElement("div",{className:"not-found"},"The ",e," API has been disabled in the maubot config."),this.state={instances:{},clients:{},plugins:{},homeserversByName:{},homeserversByURL:{},sidebarOpen:!1,modalOpen:!1,logFocus:null,logLines:[]},this.logModal={open:()=>{},isOpen:()=>!1},window.maubot=this}componentDidUpdate(e){this.props.location!==e.location&&this.setState({sidebarOpen:!1})}async componentWillMount(){const[e,t,a,s]=await Promise.all([b.getInstances(),b.getClients(),b.getPlugins(),b.getClientAuthServers(),b.updateDebugOpenFileEnabled()]),n={};if(b.getFeatures().instance)for(const c of e)n[c.id]=c;const r={};if(b.getFeatures().client)for(const c of t)r[c.id]=c;const i={};if(b.getFeatures().plugin)for(const c of a)i[c.id]=c;const l=s,o={};if(b.getFeatures().client_auth)for(const[c,h]of Object.entries(s))o[h]=c;this.setState({instances:n,clients:r,plugins:i,homeserversByName:l,homeserversByURL:o}),await this.enableLogs()}async enableLogs(){if(!b.getFeatures().log)return;const e=await b.openLogSocket(),t=e=>{e.time=new Date(e.time),e.name.startsWith("maubot.")&&(e.name=e.name.substr("maubot.".length)),e.name.startsWith("client.")?(e.name=e.name.substr("client.".length),e.nameLink="/client/"+e.name):e.name.startsWith("instance.")&&(e.nameLink="/instance/"+e.name.substr("instance.".length))};e.onHistory=e=>{for(const a of e)t(a);this.setState({logLines:e})},e.onLog=e=>{t(e),this.setState({logLines:this.state.logLines.concat(e)})}}renderList(e,t){return this.state[e]&&Object.values(this.state[e]).map(e=>n.a.createElement(t,{key:e.id,entry:e}))}delete(e,t){const a=Object.assign({},this.state[e]);delete a[t],this.setState({[e]:a})}add(e,t,a){const s=Object.assign({},this.state[e]);a&&a!==t.id&&delete s[a],s[t.id]=t,this.setState({[e]:s})}renderView(e,t,a){const s=e.slice(0,-1);if(!b.getFeatures()[s])return this.renderDisabled(s);const r=this.state[e][a];return r?n.a.createElement(t,{entry:r,onDelete:()=>this.delete(e,a),onChange:t=>this.add(e,t,a),openLog:this.openLog,ctx:this.state}):this.renderNotFound(s)}renderMain(){return n.a.createElement("div",{className:"dashboard "+(this.state.sidebarOpen?"sidebar-open":"")},n.a.createElement(l.b,{to:"/",className:"title"},n.a.createElement("img",{src:"favicon.png",alt:""}),"Maubot Manager"),n.a.createElement("div",{className:"user"},n.a.createElement("span",null,localStorage.username)),n.a.createElement("nav",{className:"sidebar"},n.a.createElement("div",{className:"buttons"},b.getFeatures().log&&n.a.createElement("button",{className:"open-log",onClick:this.openLog},n.a.createElement("span",null,"View logs"))),b.getFeatures().instance&&n.a.createElement("div",{className:"instances list"},n.a.createElement("div",{className:"title"},n.a.createElement("h2",null,"Instances"),n.a.createElement(l.b,{to:"/new/instance"},n.a.createElement(C,null))),this.renderList("instances",me.ListEntry)),b.getFeatures().client&&n.a.createElement("div",{className:"clients list"},n.a.createElement("div",{className:"title"},n.a.createElement("h2",null,"Clients"),n.a.createElement(l.b,{to:"/new/client"},n.a.createElement(C,null))),this.renderList("clients",ye.ListEntry)),b.getFeatures().plugin&&n.a.createElement("div",{className:"plugins list"},n.a.createElement("div",{className:"title"},n.a.createElement("h2",null,"Plugins"),b.getFeatures().plugin_upload&&n.a.createElement(l.b,{to:"/new/plugin"},n.a.createElement(C,null))),this.renderList("plugins",fe.ListEntry))),n.a.createElement("div",{className:"topbar",onClick:e=>this.setState({sidebarOpen:!this.state.sidebarOpen})},n.a.createElement("div",{className:"hamburger "+(this.state.sidebarOpen?"active":"")},n.a.createElement("span",null),n.a.createElement("span",null),n.a.createElement("span",null))),n.a.createElement("main",{className:"view"},n.a.createElement(o.d,null,n.a.createElement(o.b,{path:"/",exact:!0,render:()=>n.a.createElement(Ne,{openLog:this.openLog})}),n.a.createElement(o.b,{path:"/new/instance",render:()=>n.a.createElement(me,{onChange:e=>this.add("instances",e),entry:{},ctx:this.state})}),n.a.createElement(o.b,{path:"/new/client",render:()=>n.a.createElement(ye,{onChange:e=>this.add("clients",e),entry:{},ctx:this.state})}),n.a.createElement(o.b,{path:"/new/plugin",render:()=>n.a.createElement(fe,{onChange:e=>this.add("plugins",e),entry:{},ctx:this.state})}),n.a.createElement(o.b,{path:"/instance/:id",render:({match:e})=>this.renderView("instances",me,e.params.id)}),n.a.createElement(o.b,{path:"/client/:id",render:({match:e})=>this.renderView("clients",ye,e.params.id)}),n.a.createElement(o.b,{path:"/plugin/:id",render:({match:e})=>this.renderView("plugins",fe,e.params.id)}),n.a.createElement(o.b,{render:()=>this.renderNotFound()}))))}renderModal(){return n.a.createElement(ke,{ref:e=>this.logModal=e},n.a.createElement(Re,{lines:this.state.logLines,focus:this.state.logFocus}))}render(){return n.a.createElement(n.a.Fragment,null,this.renderMain(),this.renderModal())}}var Ae=Object(o.g)(_e);class je extends s.Component{constructor(e,t){super(e,t),this.inputChanged=e=>this.setState({[e.target.name]:e.target.value}),this.login=async e=>{e.preventDefault(),this.setState({loading:!0});const t=await b.login(this.state.username,this.state.password);t.token?await this.props.onLogin(t.token):t.error?this.setState({error:t.error,loading:!1}):(this.setState({error:"Unknown error",loading:!1}),console.log("Unknown error:",t))},this.state={username:"",password:"",loading:!1,error:""}}render(){return b.getFeatures().login?n.a.createElement("div",{className:"login-wrapper"},n.a.createElement("form",{className:"login "+(this.state.error&&"errored"),onSubmit:this.login},n.a.createElement("h1",null,"Maubot Manager"),n.a.createElement("input",{type:"text",placeholder:"Username",value:this.state.username,name:"username",onChange:this.inputChanged}),n.a.createElement("input",{type:"password",placeholder:"Password",value:this.state.password,name:"password",onChange:this.inputChanged}),n.a.createElement("button",{onClick:this.login,type:"submit"},this.state.loading?n.a.createElement(h,null):"Log in"),this.state.error&&n.a.createElement("div",{className:"error"},this.state.error))):n.a.createElement("div",{className:"login-wrapper"},n.a.createElement("div",{className:"login errored"},n.a.createElement("h1",null,"Maubot Manager"),n.a.createElement("div",{className:"error"},"Login has been disabled in the maubot config.")))}}var Pe=je;class Te extends s.Component{constructor(e){super(e),this.login=async e=>{localStorage.accessToken=e,await this.ping()},this.state={pinged:!1,authed:!1}}async componentWillMount(){await this.getBasePath(),localStorage.accessToken?await this.ping():await b.remoteGetFeatures(),this.setState({pinged:!0})}async getBasePath(){try{const e=await fetch("./paths.json",{headers:{"Content-Type":"application/json"}}),t=(await e.json()).api_path;b.setBasePath(""+t)}catch(e){console.error("Failed to get API path:",e)}}async ping(){try{const e=await b.ping();e?(localStorage.username=e,this.setState({authed:!0})):delete localStorage.accessToken}catch(e){console.error(e)}}render(){return this.state.pinged?n.a.createElement(l.a,null,n.a.createElement("div",{className:"maubot-wrapper "+(this.state.authed?"authenticated":"")},n.a.createElement(o.d,null,n.a.createElement(c,{path:"/login",render:()=>n.a.createElement(Pe,{onLogin:this.login}),authed:!this.state.authed,to:"/"}),n.a.createElement(c,{path:"/",component:Ae,authed:this.state.authed})))):n.a.createElement(h,{className:"maubot-loading"})}}var Fe=Te;i.a.render(n.a.createElement(Fe,null),document.getElementById("root"))}},[[102,1,2]]]);
//# sourceMappingURL=main.468e7421.chunk.js.map